<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluesky_queueserver_api.zmq.REManagerAPI.lock &mdash; Bluesky Queue Server API 0.0.9.post25+g3a162de documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="bluesky_queueserver_api.zmq.REManagerAPI.lock_environment" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_environment.html" />
    <link rel="prev" title="bluesky_queueserver_api.zmq.REManagerAPI.history_clear" href="bluesky_queueserver_api.zmq.REManagerAPI.history_clear.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Bluesky Queue Server API
          </a>
              <div class="version">
                0.0.9.post25+g3a162de
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api-reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-reference.html#generation-of-queue-items">Generation of Queue Items</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference.html#miscellaneous-api">Miscellaneous API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api-reference.html#synchronous-communication-with-0mq-server">Synchronous Communication with 0MQ Server</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.html">bluesky_queueserver_api.zmq.REManagerAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.close.html">bluesky_queueserver_api.zmq.REManagerAPI.close</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#configuration-of-remanagerapi">Configuration of REManagerAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#low-level-api">Low-Level API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-controlling-re-manager">API for controlling RE Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-controlling-re-environment">API for controlling RE Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-monitoring-available-resources">API for Monitoring Available Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-management-of-re-queue">API for management of RE Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-controlling-re-history">API for Controlling RE History</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../api-reference.html#api-for-locking-re-manager">API for Locking RE Manager</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">bluesky_queueserver_api.zmq.REManagerAPI.lock</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_environment.html">bluesky_queueserver_api.zmq.REManagerAPI.lock_environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_queue.html">bluesky_queueserver_api.zmq.REManagerAPI.lock_queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_all.html">bluesky_queueserver_api.zmq.REManagerAPI.lock_all</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.unlock.html">bluesky_queueserver_api.zmq.REManagerAPI.unlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_info.html">bluesky_queueserver_api.zmq.REManagerAPI.lock_info</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.lock_key.html">bluesky_queueserver_api.zmq.REManagerAPI.lock_key</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.enable_locked_api.html">bluesky_queueserver_api.zmq.REManagerAPI.enable_locked_api</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.get_default_lock_key.html">bluesky_queueserver_api.zmq.REManagerAPI.get_default_lock_key</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.set_default_lock_key.html">bluesky_queueserver_api.zmq.REManagerAPI.set_default_lock_key</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluesky_queueserver_api.zmq.REManagerAPI.default_lock_key_path.html">bluesky_queueserver_api.zmq.REManagerAPI.default_lock_key_path</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-executing-tasks">API for Executing Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-controlling-run-engine">API for controlling Run Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-controlling-ipython-kernel">API for controlling IPython kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api-reference.html#api-for-monitoring-console-output-of-re-manager">API for monitoring console output of RE manager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference.html#asynchronous-communication-with-0mq-server">Asynchronous Communication with 0MQ Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference.html#synchronous-communication-with-http-server">Synchronous Communication with HTTP Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference.html#asynchronous-communication-with-http-server">ASynchronous Communication with HTTP Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bluesky Queue Server API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api-reference.html">API Reference</a></li>
      <li class="breadcrumb-item active">bluesky_queueserver_api.zmq.REManagerAPI.lock</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/bluesky_queueserver_api.zmq.REManagerAPI.lock.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bluesky-queueserver-api-zmq-remanagerapi-lock">
<h1>bluesky_queueserver_api.zmq.REManagerAPI.lock<a class="headerlink" href="#bluesky-queueserver-api-zmq-remanagerapi-lock" title="Permalink to this heading">¶</a></h1>
<dl class="py method">
<dt class="sig sig-object py" id="bluesky_queueserver_api.zmq.REManagerAPI.lock">
<span class="sig-prename descclassname"><span class="pre">REManagerAPI.</span></span><span class="sig-name descname"><span class="pre">lock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lock_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">environment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">note</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluesky_queueserver_api.zmq.REManagerAPI.lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Lock RE Manager with a lock key. The lock may prevent other users (or clients) from modifying
the environment, starting plans or tasks or editing the queue. The API is intented to
supports the scenarios when a beamline scientist needs to lock RE Manager with
a unique code before entering the hutch to change samples or make adjustments and then
safely run a series of calibration or testing plans without interference from automated
agents or remote users. A remote operators may still control locked RE Manager if
the beamline scientist provides them with the lock key.</p>
<p>The lock is not intended for access control. The read-only API are not affected by the lock,
therefore all monitoring client applications are expected to remain functional after
the lock is applied. The lock  does not influence internal operation of the manager,
e.g. the running queue will continue running and has to be explicitly stopped if needed.
Restarting RE Manager does not remove the lock. The locked manager must be unlocked
with <code class="docutils literal notranslate"><span class="pre">REManagerAPI.unlock()</span></code> API using the valid lock key (normal operation), an optional
emergency lock key (in case the lock key is lost) or <code class="docutils literal notranslate"><span class="pre">qserver-clear-lock</span></code> CLI tool (last
resort, requires restarting RE Manager).</p>
<p>The lock can be set using current lock key (set using <code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_key</span></code> property)
or passed to the API directly using the <code class="docutils literal notranslate"><span class="pre">lock_key</span></code> parameter. The key passed as a parameter
always overrides the current lock key. The operator may still execute locked API using a valid
lock key. If access to locked API is enabled (<code class="docutils literal notranslate"><span class="pre">REManagerAPI.enable_locked_api</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>),
then the current lock key is automatically passed with each lockable API. The key passed
with <code class="docutils literal notranslate"><span class="pre">lock_api</span></code> parameter overrides the current key and is always passed with the API
call. This mechanism allows to set the key only once (<code class="docutils literal notranslate"><span class="pre">RM.lock_key=&quot;some-lock-key&quot;</span></code>)
and use it to lock and unlock the manager and access the locked API if needed.
The <code class="docutils literal notranslate"><span class="pre">lock_key</span></code> API parameter is used in applications where setting a global lock key
is not desirable (e.g. in the implementation of multi-user HTTP Server).</p>
<p>The API parameters allow to choose between locking the <strong>environment</strong>, the <strong>queue</strong> or both.
The <strong>environment</strong> is locked by setting <code class="docutils literal notranslate"><span class="pre">environment=True</span></code> or calling <code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_environment()</span></code>
and affects the following API:</p>
<ul class="simple">
<li><p>REManagerAPI.environment_open()</p></li>
<li><p>REManagerAPI.environment_close()</p></li>
<li><p>REManagerAPI.environment_destroy()</p></li>
<li><p>REManagerAPI.environment_update()</p></li>
<li><p>REManagerAPI.queue_start()</p></li>
<li><p>REManagerAPI.queue_stop()</p></li>
<li><p>REManagerAPI.queue_stop_cancel()</p></li>
<li><p>REManagerAPI.item_execute()</p></li>
<li><p>REManagerAPI.re_pause()</p></li>
<li><p>REManagerAPI.re_resume()</p></li>
<li><p>REManagerAPI.re_stop()</p></li>
<li><p>REManagerAPI.re_abort()</p></li>
<li><p>REManagerAPI.re_halt()</p></li>
<li><p>REManagerAPI.kernel_interrupt()</p></li>
<li><p>REManagerAPI.script_upload()</p></li>
<li><p>REManagerAPI.function_execute()</p></li>
</ul>
<p>The <strong>queue</strong> is locked by setting <code class="docutils literal notranslate"><span class="pre">queue=True</span></code> or calling <code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_queue()</span></code> and
affects the following API:</p>
<ul class="simple">
<li><p>REManagerAPI.queue_mode_set()</p></li>
<li><p>REManagerAPI.queue_autostart()</p></li>
<li><p>REManagerAPI.item_add()</p></li>
<li><p>REManagerAPI.item_add_batch()</p></li>
<li><p>REManagerAPI.item_update()</p></li>
<li><p>REManagerAPI.item_remove()</p></li>
<li><p>REManagerAPI.item_remove_batch()</p></li>
<li><p>REManagerAPI.item_move()</p></li>
<li><p>REManagerAPI.item_move_batch()</p></li>
<li><p>REManagerAPI.queue_clear()</p></li>
<li><p>REManagerAPI.history_clear()</p></li>
<li><p>REManagerAPI.permissions_reload()</p></li>
<li><p>REManagerAPI.permissions_set()</p></li>
</ul>
<p>The <strong>environment</strong> and the <strong>queue</strong> may be locked by setting <code class="docutils literal notranslate"><span class="pre">environment=True</span></code>, <code class="docutils literal notranslate"><span class="pre">queue=True</span></code>
or calling <code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_all()</span></code> and affects the API from both groups.</p>
<p>The additional parameters include the name of the user (<code class="docutils literal notranslate"><span class="pre">user</span></code>) who is locking
RE Manager and an optional note (message) passed to other users (<code class="docutils literal notranslate"><span class="pre">note</span></code>), which explains
the reason why the manager is locked. The user name and the note is returned by
<code class="docutils literal notranslate"><span class="pre">lock_info</span></code> API and included in the <em>‘Invalid lock key’</em> error messages.</p>
<p>The API may be called if RE Manager is already locked to change the lock options or the note.
In this case, the lock key passed with the request must match the key used to lock the manager.
There is no API that allows to change the lock without unlocking the manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lock_key: str (optional)</strong></dt><dd><p>The lock key is an arbitrary non-empty string. Users/clients are expected to keep
the key used to lock RE Manager and use it to unlock the manager or make API requests.
If the lock key is lost by accident, then RE Manager may be unlocked using the
emergency lock key. If <code class="docutils literal notranslate"><span class="pre">lock_key</span></code> is not set, then the current key
(<code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_key</span></code> property) is used. If neither keys are set, then
<code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> (<em>lock key is not set</em>) is raised.</p>
</dd>
<dt><strong>environment: boolean (optional)</strong></dt><dd><p>Enable lock for the API that control RE Worker environment. The request fails
if both <strong>environment</strong> and <strong>queue</strong> are missing or <em>False</em>. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt><strong>queue: boolean (optinal)</strong></dt><dd><p>Enable lock for the API that control the queue. The request fails
if both <strong>environment</strong> and <strong>queue</strong> are missing or <em>False</em>. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt><strong>user: str (optional)</strong></dt><dd><p>Name of the user who submits the request. The user name is returned as part of
<em>lock_info</em> and included in error messages. If the parameter is missing or <code class="docutils literal notranslate"><span class="pre">None</span></code>,
then <code class="docutils literal notranslate"><span class="pre">REManagerAPI.user</span></code> is passed with the API call. Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
<dt><strong>note: str or None (optional)</strong></dt><dd><p>A text message to other users that explains the reason why RE Manager is locked.
The note is returned as part of <em>lock_info</em> and included in error messages.
If the value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then no message submitted. Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>response: dict</dt><dd><p>Dictionary keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">success</span></code>: <em>boolean</em> - success of the request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg</span></code>: <em>str</em> - error message in case the request is rejected by RE Manager
or operation failed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lock_info</span></code>: <em>dict</em> - dictionary containing the information on the status of the lock.
The dictionary is also returned by <code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_info()</span></code> and includes
the following fields:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">environment</span></code>: <em>boolean</em> - indicates if the RE Worker environment is locked.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queue</span></code>: <em>boolean</em> - indicates if the queue is locked.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: <em>str</em> or <em>None</em> - the name of the user who locked RE Manager,
<code class="docutils literal notranslate"><span class="pre">None</span></code> if the lock is not set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">note</span></code>: <em>str</em> or <em>None</em> - the text note left by the user who locked RE Manager,
<code class="docutils literal notranslate"><span class="pre">None</span></code> if the lock is not set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: <em>float</em> or <em>None</em> - timestamp (time when RE Manager was locked),
<code class="docutils literal notranslate"><span class="pre">None</span></code> if the lock is not set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_str</span></code>: <em>str</em> - human-readable representation of the timestamp,
empty string if the lock is not set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emergency_lock_key_is_set</span></code>: <em>boolean</em> - indicates if the optional emergency
lock key is set.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lock_info_uid</span></code>: <em>str</em>
UID of <em>lock_info</em>. The UID is also returned in RE Manager status and could be
monitored to detect updates of <em>lock_info</em>.</p></li>
</ul>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>RequestTimeoutError, RequestFailedError, HTTPRequestError, HTTPClientError, HTTPServerError</dt><dd><p>All exceptions raised by <code class="docutils literal notranslate"><span class="pre">send_request</span></code> API.</p>
</dd>
<dt>RuntimeError</dt><dd><p>The lock key (<code class="docutils literal notranslate"><span class="pre">lock_key</span></code> parameter) is not passed and the current lock key
(<code class="docutils literal notranslate"><span class="pre">REManagerAPI.lock_key</span></code>) is not set.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Setting and using current lock key (sync and async API).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set current lock key. The key may be any string.</span>
<span class="c1">#   The default lock key persists between sessions.</span>
<span class="n">RM</span><span class="o">.</span><span class="n">lock_key</span> <span class="o">=</span> <span class="n">RM</span><span class="o">.</span><span class="n">get_default_lock_key</span><span class="p">()</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;Some informative message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock(environment=True, note=&quot;Some informative message ...&quot;)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">RM</span><span class="o">.</span><span class="n">lock_info</span><span class="p">()</span>
<span class="c1"># response = await RM.lock_info()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;lock_info&quot;</span><span class="p">])</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_queue</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="s2">&quot;Another message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_queue(note=&quot;Another message ...&quot;)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_environment</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="s2">&quot;Different message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_environment(note=&quot;Different message ...&quot;)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_all</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="s2">&quot;Any useful message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_environment(note=&quot;Any useful message ...&quot;)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">RM</span><span class="o">.</span><span class="n">environment_open</span><span class="p">()</span>  <span class="c1"># API call fails because the environment is locked.</span>
    <span class="c1"># await RM.environment_open()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API call failed: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If locked API are enabled, then the current lock key is sent with each API request.</span>
<span class="n">RM</span><span class="o">.</span><span class="n">enable_locked_api</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">RM</span><span class="o">.</span><span class="n">environment_open</span><span class="p">()</span>  <span class="c1"># API call is expected to succeed.</span>
<span class="c1"># await RM.environment_open()</span>

<span class="n">RM</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
<span class="c1"># await RM.unlock()</span>
</pre></div>
</div>
<p>Explicitly passing the lock key as a parameter (sync and async API).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select the lock key. The key may be any string.</span>
<span class="c1">#   The default lock key persists between sessions.</span>
<span class="n">lock_key</span> <span class="o">=</span> <span class="s2">&quot;some-arbitrary-string-key&quot;</span>
<span class="c1"># lock_key = RM.get_default_lock_key()</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;Some informative message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock(lock_key=lock_key, environment=True, note=&quot;Some informative message ...&quot;)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">RM</span><span class="o">.</span><span class="n">lock_info</span><span class="p">()</span>
<span class="c1"># response = await RM.lock_info()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;lock_info&quot;</span><span class="p">])</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_queue</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;Another message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_queue(lock_key=lock_key, note=&quot;Another message ...&quot;)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_environment</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;Different message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_environment(lock_key=lock_key, note=&quot;Different message ...&quot;)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">lock_all</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;Any useful message ...&quot;</span><span class="p">)</span>
<span class="c1"># await RM.lock_environment(lock_key=lock_key, note=&quot;Any useful message ...&quot;)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">RM</span><span class="o">.</span><span class="n">environment_open</span><span class="p">()</span>  <span class="c1"># API call fails because the environment is locked.</span>
    <span class="c1"># await RM.environment_open()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API call failed: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">environment_open</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">)</span>  <span class="c1"># API call is expected to succeed.</span>
<span class="c1"># await RM.environment_open(lock_key=lock_key)</span>

<span class="n">RM</span><span class="o">.</span><span class="n">unlock</span><span class="p">(</span><span class="n">lock_key</span><span class="o">=</span><span class="n">lock_key</span><span class="p">)</span>
<span class="c1"># await RM.unlock(lock_key=lock_key)</span>
</pre></div>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bluesky_queueserver_api.zmq.REManagerAPI.history_clear.html" class="btn btn-neutral float-left" title="bluesky_queueserver_api.zmq.REManagerAPI.history_clear" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bluesky_queueserver_api.zmq.REManagerAPI.lock_environment.html" class="btn btn-neutral float-right" title="bluesky_queueserver_api.zmq.REManagerAPI.lock_environment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>