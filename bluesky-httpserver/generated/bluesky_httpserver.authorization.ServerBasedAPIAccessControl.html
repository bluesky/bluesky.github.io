<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluesky_httpserver.authorization.ServerBasedAPIAccessControl &mdash; Bluesky HTTP Server 0.0.11.post7+g6f16a34 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="bluesky_httpserver.authorization.DefaultResourceAccessControl" href="bluesky_httpserver.authorization.DefaultResourceAccessControl.html" />
    <link rel="prev" title="bluesky_httpserver.authorization.DictionaryAPIAccessControl" href="bluesky_httpserver.authorization.DictionaryAPIAccessControl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Bluesky HTTP Server
          </a>
              <div class="version">
                0.0.11.post7+g6f16a34
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Starting and Using the Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control_re_manager.html">Controlling Run Engine Manager</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Server Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#configuration-using-environment-variables">Configuration Using Environment Variables</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../configuration.html#configuration-files">Configuration Files</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#communication-with-run-engine-manager">Communication With Run Engine Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#custom-routers">Custom Routers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#authentication">Authentication</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../configuration.html#authorization-api-access">Authorization: API Access</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../configuration.html#basic-api-access-policy">Basic API Access Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration.html#dictionary-api-access-policy">Dictionary API Access Policy</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../configuration.html#access-policy-based-on-external-access-control-server">Access Policy Based on External Access Control Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#authorization-resource-access">Authorization: Resource Access</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver">Bluesky Queue Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver-api">Bluesky Queue Server API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-widgets">Bluesky Widgets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">Bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">Ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">Data Broker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bluesky HTTP Server</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../configuration.html">Server Configuration</a></li>
      <li class="breadcrumb-item active">bluesky_httpserver.authorization.ServerBasedAPIAccessControl</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/bluesky_httpserver.authorization.ServerBasedAPIAccessControl.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bluesky-httpserver-authorization-serverbasedapiaccesscontrol">
<h1>bluesky_httpserver.authorization.ServerBasedAPIAccessControl<a class="headerlink" href="#bluesky-httpserver-authorization-serverbasedapiaccesscontrol" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky_httpserver.authorization.ServerBasedAPIAccessControl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky_httpserver.authorization.</span></span><span class="sig-name descname"><span class="pre">ServerBasedAPIAccessControl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'localhost'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">600</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiration_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/bluesky_httpserver/authorization/api_access.html#ServerBasedAPIAccessControl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky_httpserver.authorization.ServerBasedAPIAccessControl" title="Permalink to this definition">¶</a></dt>
<dd><p>Access policy based on external Access Control Server. The user access data is
periodically requested from the server using REST API. The access control server is
expected to expose <code class="docutils literal notranslate"><span class="pre">/instrument/{instrument}/qserver/access</span></code> API,
where <code class="docutils literal notranslate"><span class="pre">instrument</span></code> is the lowercase name of the instrument passed to the class constructor.
The API is expected to return a dictionary which maps roles (‘admin’, ‘expert’, ‘advanced’, ‘user’,
‘observer’) to dictionaries with information on users that are assigned the role, for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;admin&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@gmail.com&quot;</span><span class="p">},</span>
        <span class="s2">&quot;tom&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">},</span>
    <span class="s2">&quot;expert&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@gmail.com&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;advanced&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;jdoe&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;jdoe@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;observer&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>User information consists of the username (dictionary key, which makes it mandatory) and
optional <code class="docutils literal notranslate"><span class="pre">'email'</span></code> and <code class="docutils literal notranslate"><span class="pre">'displayed_name'</span></code>. Additional user information is ignored.</p>
<p>Access information is requested from the server at startup and periodically updated
during operation with the period <code class="docutils literal notranslate"><span class="pre">update_period</span> <span class="pre">+/-20%</span></code>. If the server is not accessible,
the user access rights do not change until access information expires. The expiration
period is set using the parameter <code class="docutils literal notranslate"><span class="pre">expiration_period</span></code>. If the access information
expires and an attempt to update it fails, all users lose access to the HTTP server.</p>
<p>The scopes for the roles can be modified by passing the parameter dictionary with
the parameter <code class="docutils literal notranslate"><span class="pre">roles</span></code>. The dictionary is handled by the constructor of
<code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code>. See the class documentation for more details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>instrument: str</strong></dt><dd><p>Instrument ID, such as ‘SRX’ or ‘TES’. This is the required parameter.</p>
</dd>
<dt><strong>roles: dict or None, optional</strong></dt><dd><p>The dictionary that defines new and/or modifies existing roles. The dictionary
is passed to the <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> constructor. Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
<dt><strong>server: str, optional</strong></dt><dd><p>Access Control server address, such as <code class="docutils literal notranslate"><span class="pre">'accesscontrol.server.com'</span></code> or
<code class="docutils literal notranslate"><span class="pre">'110.43.6.45'</span></code>. The default address is <code class="docutils literal notranslate"><span class="pre">localhost</span></code>.</p>
</dd>
<dt><strong>port: int, optional</strong></dt><dd><p>Access Control server port. The default port is <cite>8000</cite>.</p>
</dd>
<dt><strong>update_period: int, optional</strong></dt><dd><p>Average period in seconds between consecutive requests for updated access data.
The actual period is randomized (uniform distribution in the range +/-20% of
the update period). Default: 600.</p>
</dd>
<dt><strong>expiration_period: int or None, optional</strong></dt><dd><p>Expiration period for the current access data. If a request to the API server
fails and the data is expired, then users lose access. Longer expiration period
allows users to continue operation if the API server is temporarily unavailable.
If the value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the period is set to <code class="docutils literal notranslate"><span class="pre">1.5</span> <span class="pre">*</span> <span class="pre">update_period</span></code>.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
<dt><strong>http_timeout: int, optional</strong></dt><dd><p>Timeout for requests to the API server.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="bluesky_httpserver.authorization.ServerBasedAPIAccessControl.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'localhost'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">600</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiration_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/bluesky_httpserver/authorization/api_access.html#ServerBasedAPIAccessControl.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky_httpserver.authorization.ServerBasedAPIAccessControl.__init__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p class="rubric">Methods</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#bluesky_httpserver.authorization.ServerBasedAPIAccessControl.__init__" title="bluesky_httpserver.authorization.ServerBasedAPIAccessControl.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>(*[, instrument, roles, server, ...])</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_displayed_user_name</span></code>(username)</p></td>
<td><p>Returns the displayed user name for the user. The displayed user name is assembled from <code class="docutils literal notranslate"><span class="pre">username</span></code>, full 'displayed' user name and user's email. The formatting depends on the available data, i.e. if no additional data is available, then <code class="docutils literal notranslate"><span class="pre">username</span></code> is returned. If the user is not found, then <code class="docutils literal notranslate"><span class="pre">username</span></code> is returned. The following output is possible for the user <em>'jdoe'</em>::.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_info</span></code>(username)</p></td>
<td><p>Returns complete user information, including a set of roles, set of scopes and displayed user name.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_roles</span></code>(username)</p></td>
<td><p>Returns a set of roles assigned to the user.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_scopes</span></code>(username)</p></td>
<td><p>Returns a set of scopes assigned to the user.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">is_user_known</span></code>(username)</p></td>
<td><p>Performs quick check whether the user is known.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">update_access_info</span></code>()</p></td>
<td><p>Send a single request to the API server and update locally stored access control info.</p></td>
</tr>
</tbody>
</table>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bluesky_httpserver.authorization.DictionaryAPIAccessControl.html" class="btn btn-neutral float-left" title="bluesky_httpserver.authorization.DictionaryAPIAccessControl" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bluesky_httpserver.authorization.DefaultResourceAccessControl.html" class="btn btn-neutral float-right" title="bluesky_httpserver.authorization.DefaultResourceAccessControl" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>