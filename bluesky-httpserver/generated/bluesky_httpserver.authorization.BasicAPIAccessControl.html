<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluesky_httpserver.authorization.BasicAPIAccessControl &mdash; Bluesky HTTP Server 0.0.10 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="bluesky_httpserver.authorization.DictionaryAPIAccessControl" href="bluesky_httpserver.authorization.DictionaryAPIAccessControl.html" />
    <link rel="prev" title="bluesky_httpserver.authenticators.LDAPAuthenticator" href="bluesky_httpserver.authenticators.LDAPAuthenticator.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Bluesky HTTP Server
          </a>
              <div class="version">
                0.0.10
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Starting and Using the Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control_re_manager.html">Controlling Run Engine Manager</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Server Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#configuration-using-environment-variables">Configuration Using Environment Variables</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../configuration.html#configuration-files">Configuration Files</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#communication-with-run-engine-manager">Communication With Run Engine Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#custom-routers">Custom Routers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#authentication">Authentication</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../configuration.html#authorization-api-access">Authorization: API Access</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../configuration.html#basic-api-access-policy">Basic API Access Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration.html#dictionary-api-access-policy">Dictionary API Access Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration.html#access-policy-based-on-external-access-control-server">Access Policy Based on External Access Control Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.html#authorization-resource-access">Authorization: Resource Access</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver">Bluesky Queue Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver-api">Bluesky Queue Server API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-widgets">Bluesky Widgets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">Bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">Ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">Data Broker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bluesky HTTP Server</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../configuration.html">Server Configuration</a></li>
      <li class="breadcrumb-item active">bluesky_httpserver.authorization.BasicAPIAccessControl</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/bluesky_httpserver.authorization.BasicAPIAccessControl.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bluesky-httpserver-authorization-basicapiaccesscontrol">
<h1>bluesky_httpserver.authorization.BasicAPIAccessControl<a class="headerlink" href="#bluesky-httpserver-authorization-basicapiaccesscontrol" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="bluesky_httpserver.authorization.BasicAPIAccessControl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluesky_httpserver.authorization.</span></span><span class="sig-name descname"><span class="pre">BasicAPIAccessControl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/bluesky_httpserver/authorization/api_access.html#BasicAPIAccessControl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky_httpserver.authorization.BasicAPIAccessControl" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic API access policy. The policy is used by HTTP server
by default. The basic policy supports two default users: <code class="docutils literal notranslate"><span class="pre">UNAUTHENTICATED_SINGLE_USER</span></code>
(user authorized with single-user API key) and <code class="docutils literal notranslate"><span class="pre">UNAUTHENTICATED_PUBLIC</span></code> (unauthorized user,
sending no token or API key with the request). The default users are assigned to
<code class="docutils literal notranslate"><span class="pre">unauthenticated_single_user</span></code> and <code class="docutils literal notranslate"><span class="pre">unauthenticated_public</span></code> roles respectively.
In additon, five roles are defined by the policy and available to subclassed policies:
<code class="docutils literal notranslate"><span class="pre">admin</span></code>, <code class="docutils literal notranslate"><span class="pre">expert</span></code>, <code class="docutils literal notranslate"><span class="pre">advanced</span></code>, <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">observer</span></code>.</p>
<p>Each of the seven roles is assigned a reasonable set of default scopes, which may be
customized for practical deployments. The parameter <code class="docutils literal notranslate"><span class="pre">roles</span></code> allows to replace or modify
sets of scopes assigned to default roles or add new custom roles recognized by policies.
Note, that the basic API access policy support only unauthenticated access and uses
only two roles. The other default roles and custom roles are intended for use in subclasses
that define more sophysticated policies.</p>
<p>The optional parameter <code class="docutils literal notranslate"><span class="pre">roles</span></code> accepts a dictionary, which maps role names to operations
on the respective sets of scopes. The operations include <code class="docutils literal notranslate"><span class="pre">scopes_set</span></code> (replaces the existing
scopes by the new scopes or sets scopes for a new custom role), <code class="docutils literal notranslate"><span class="pre">scopes_add</span></code> (adds
scopes to the existing scopes) and <code class="docutils literal notranslate"><span class="pre">scopes_remove</span></code> (remove scopes from the set).
Multiple operations for a given role are executed in the following order: <code class="docutils literal notranslate"><span class="pre">scopes_set</span></code>,
<code class="docutils literal notranslate"><span class="pre">scopes_add</span></code> followed by <code class="docutils literal notranslate"><span class="pre">scopes_remove</span></code>.</p>
<p>The following examples illustrate how modify API access for the default <code class="docutils literal notranslate"><span class="pre">user</span></code> role.
Access to API may be disabled by mapping the role name to <code class="docutils literal notranslate"><span class="pre">None</span></code> or setting scopes to the
empty list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;user&#39; can not access any API.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_set&quot;</span><span class="p">:</span> <span class="p">[]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_set&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
</pre></div>
</div>
<p>In the following examples, the scopes are not changed, since no operations are specified or
the operations do not modify the scopes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scopes are not changed</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="p">[]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="p">[]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="p">[]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
</pre></div>
</div>
<p>The scopes are replaces by specifying a list of scopes with <code class="docutils literal notranslate"><span class="pre">scopes_set</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace the scopes with the new set: &#39;user&#39; can now only read status and the queue.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_set&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read:status&quot;</span><span class="p">,</span> <span class="s2">&quot;read:queue&quot;</span><span class="p">]}}</span>

<span class="c1"># Replace the scopes: &#39;user&#39; can now only read status.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_set&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read:status&quot;</span><span class="p">]}}</span>
<span class="c1"># A single scope may be specified as a string (more convenient in YML config file).</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_set&quot;</span><span class="p">:</span> <span class="s2">&quot;read:status&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Additional scopes can be added to the default scopes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In addition to default scopes, &#39;user&#39; can now upload and execute scripts.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;write:scripts&quot;</span><span class="p">]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="s2">&quot;write:scripts&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Scopes can be removed from the default scopes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;user&#39; is assigned the default scopes except API for editing the queue.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;write:queue:edit&quot;</span><span class="p">]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_remove&quot;</span><span class="p">:</span> <span class="s2">&quot;write:queue:edit&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Multiple operations may be specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now the &#39;user&#39; can execute scripts, but not edit the queue.</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;write:scripts&quot;</span><span class="p">],</span> <span class="s2">&quot;remove&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;write:queue:edit&quot;</span><span class="p">]}}</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scopes_add&quot;</span><span class="p">:</span> <span class="s2">&quot;write:scripts&quot;</span><span class="p">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;write:queue:edit&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>In practical deployments, the policy arguments are defined in config YML files.
The following is an example of configuration that modifies the scopes for
the <code class="docutils literal notranslate"><span class="pre">user</span></code> role and creates a new <code class="docutils literal notranslate"><span class="pre">test_role</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">api_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">BasicAPIAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">roles</span><span class="p">:</span>
      <span class="n">user</span><span class="p">:</span>
        <span class="n">scopes_add</span><span class="p">:</span> <span class="n">write</span><span class="p">:</span><span class="n">scripts</span>
        <span class="n">scopes_remove</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">write</span><span class="p">:</span><span class="n">queue</span><span class="p">:</span><span class="n">edit</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">queue</span><span class="p">:</span><span class="n">edit</span>
      <span class="n">test_role</span><span class="p">:</span>
        <span class="n">scopes_add</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">status</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">queue</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">history</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">resources</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">config</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">monitor</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">console</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">lock</span>
          <span class="o">-</span> <span class="n">read</span><span class="p">:</span><span class="n">testing</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>roles: dict, None</strong></dt><dd><p>The dictionary that maps role names to operations that modify assigned role scopes.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the default roles with default unmodified scopes are used.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="bluesky_httpserver.authorization.BasicAPIAccessControl.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/bluesky_httpserver/authorization/api_access.html#BasicAPIAccessControl.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bluesky_httpserver.authorization.BasicAPIAccessControl.__init__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p class="rubric">Methods</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#bluesky_httpserver.authorization.BasicAPIAccessControl.__init__" title="bluesky_httpserver.authorization.BasicAPIAccessControl.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>(*[, roles])</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_displayed_user_name</span></code>(username)</p></td>
<td><p>Returns the displayed user name for the user. The displayed user name is assembled from <code class="docutils literal notranslate"><span class="pre">username</span></code>, full 'displayed' user name and user's email. The formatting depends on the available data, i.e. if no additional data is available, then <code class="docutils literal notranslate"><span class="pre">username</span></code> is returned. If the user is not found, then <code class="docutils literal notranslate"><span class="pre">username</span></code> is returned. The following output is possible for the user <em>'jdoe'</em>::.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_info</span></code>(username)</p></td>
<td><p>Returns complete user information, including a set of roles, set of scopes and displayed user name.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_roles</span></code>(username)</p></td>
<td><p>Returns a set of roles assigned to the user.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_user_scopes</span></code>(username)</p></td>
<td><p>Returns a set of scopes assigned to the user.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">is_user_known</span></code>(username)</p></td>
<td><p>Performs quick check whether the user is known.</p></td>
</tr>
</tbody>
</table>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bluesky_httpserver.authenticators.LDAPAuthenticator.html" class="btn btn-neutral float-left" title="bluesky_httpserver.authenticators.LDAPAuthenticator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bluesky_httpserver.authorization.DictionaryAPIAccessControl.html" class="btn btn-neutral float-right" title="bluesky_httpserver.authorization.DictionaryAPIAccessControl" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>