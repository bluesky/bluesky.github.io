<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Server Configuration &mdash; Bluesky HTTP Server 0.0.10.post7+g1c76906 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="bluesky_httpserver.authenticators.DictionaryAuthenticator" href="generated/bluesky_httpserver.authenticators.DictionaryAuthenticator.html" />
    <link rel="prev" title="Controlling Run Engine Manager" href="control_re_manager.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Bluesky HTTP Server
          </a>
              <div class="version">
                0.0.10.post7+g1c76906
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Starting and Using the Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_re_manager.html">Controlling Run Engine Manager</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-using-environment-variables">Configuration Using Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-files">Configuration Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#communication-with-run-engine-manager">Communication With Run Engine Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-routers">Custom Routers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-secret-keys">Setting Secret Keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-user-mode">Single-User Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#anonymous-public-access">Anonymous Public Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dictionary-authenticator">Dictionary Authenticator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ldap-authenticator">LDAP Authenticator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expiration-time-for-tokens-and-sessions">Expiration Time for Tokens and Sessions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#authorization-api-access">Authorization: API Access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-api-access-policy">Basic API Access Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dictionary-api-access-policy">Dictionary API Access Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-policy-based-on-external-access-control-server">Access Policy Based on External Access Control Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#authorization-resource-access">Authorization: Resource Access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-resource-access-policy">Default Resource Access Policy</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver">Bluesky Queue Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver-api">Bluesky Queue Server API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-widgets">Bluesky Widgets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">Bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">Ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">Data Broker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bluesky HTTP Server</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Server Configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="server-configuration">
<h1>Server Configuration<a class="headerlink" href="#server-configuration" title="Permalink to this heading">¶</a></h1>
<section id="configuration-using-environment-variables">
<h2>Configuration Using Environment Variables<a class="headerlink" href="#configuration-using-environment-variables" title="Permalink to this heading">¶</a></h2>
<p>Basic configuration of the HTTP Server may be set using environment variables. For example,
single-user API key could be <a class="reference internal" href="usage.html#passing-single-user-api-key-as-ev"><span class="std std-ref">set using the environment variable</span></a>
<code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_SINGLE_USER_API_KEY</span></code>. While many environment variables are supported by the server
and allow high level of customization of functionality, using configuration YML files is more simple,
allows greater fexibility and is considered a preferable way of configuring the server in production
deployments.</p>
<p>Environment variable for passing the path to server configuration file(s):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_CONFIG</span></code> - path to a single YML file or a directory with multiple YML files.</p></li>
</ul>
<p>Environment variables for controlling 0MQ communication with Run Engine Manager:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_CONTROL_ADDRESS</span></code> - 0MQ socket (REQ-REP) for control channel of RE Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_INFO_ADDRESS</span></code> -  0MQ socket (PUB-SUB) for console output of RE Manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PUBLIC_KEY</span></code> - public key for encryption of control API requests.</p></li>
</ul>
<p>Environment variables for configuring authentication:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_SERVER_SECRET_KEYS</span></code> - the value may be a single key or a <code class="docutils literal notranslate"><span class="pre">;</span></code>-separated list of keys to
support key rotation. The first key will be used for encryption. Each key will be tried in turn for decryption.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_SINGLE_USER_API_KEY</span></code> - Single-user API key. Enable single-user mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_ALLOW_ANONYMOUS_ACCESS</span></code> - Enables public anonymous access if the expression evaluates <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_ALLOW_ORIGINS</span></code> - the list of domains enables web apps served from other domains to make
requests to the server.</p></li>
</ul>
<p>Environment variables for controlling token and session lifetimes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_ACCESS_TOKEN_MAX_AGE</span></code> - maximum age of an access token</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_REFRESH_TOKEN_MAX_AGE</span></code> - maximum age of a refresh token</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_SESSION_MAX_AGE</span></code> - maximum age of a session</p></li>
</ul>
<p>Environment variables for database configuration:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_DATABASE_URI</span></code> - database URI. The default URI is <em>‘sqlite:///bluesky_httpserver.sqlite’</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_DATABASE_POOL_SIZE</span></code> - connection pool size. Default is 5.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_DATABASE_POOL_PRE_PING</span></code> - if true (default), use pessimistic connection testings.
This is recommended.</p></li>
</ul>
<p>Environment variables for customization of the server:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_CUSTOM_ROUTERS</span></code> - one or multiple custom routers (module names) separated with <code class="docutils literal notranslate"><span class="pre">:</span></code> or <code class="docutils literal notranslate"><span class="pre">,</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_CUSTOM_MODULES</span></code> - THE FUNCTIONALITY WILL BE DEPRECATED IN FAVOR OF CUSTOM ROUTERS.</p></li>
</ul>
</section>
<section id="configuration-files">
<h2>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this heading">¶</a></h2>
<p>The preferable method for customizing HTTP server is using configuration YML files. The server
not attemting to load config files unless the path is passed to the server using environment
variable <code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_CONFIG</span></code> as described in <a class="reference internal" href="usage.html#passing-config-to-server"><span class="std std-ref">Passing Configuration to the Server</span></a>.
The path may point to a single config file or a directory containing multiple config files.
The settings in config file override any settings defined using environment variables.</p>
<section id="communication-with-run-engine-manager">
<h3>Communication With Run Engine Manager<a class="headerlink" href="#communication-with-run-engine-manager" title="Permalink to this heading">¶</a></h3>
<p>HTTP Server is communicating with Run Engine (RE) Manager over 0MQ. The default server
configuration assumes that RE Manager is running on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> and port 60615 is used
for control channel (REQ-REP), the console output is published using port 60625 (PUB-SUB),
and encryption for control channel is disabled. The default settings allow Queue Server to
run ‘out of the box’ if all system components are running on the same machine, which
is the case in testing and simple demos. In practical deployments the settings need to be
customized.</p>
<p>The configuration for 0MQ communication with RE Manager can be customized using environment
variables or configuration files.</p>
<p>The following environment variables are used to configure 0MQ communication settings:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_CONTROL_ADDRESS</span></code> - the address of REQ-REP 0MQ socket of RE Manager used
for control channel. The default address: <code class="docutils literal notranslate"><span class="pre">tcp://localhost:60615</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_INFO_ADDRESS</span></code> - the address of PUB-SUB 0MQ socket used by RE Manager
to publish console output. The default address: <code class="docutils literal notranslate"><span class="pre">tcp://localhost:60625</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PUBLIC_KEY</span></code> - the public key used for encryption of control messages
sent to RE Manager over 0MQ. The encryption is disabled by default. To enable the encryption,
generate the public/private key pair using
<a class="reference external" href="https://blueskyproject.io/bluesky-queueserver/cli_tools.html#qserver-zmq-keys">‘qserver-zmq-keys’ CLI tool</a>,
pass the private key to RE Manager. Pass the public key to HTTP Server using
<code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PUBLIC_KEY</span></code> environment variable.</p></li>
</ul>
<p>The same parameters can be specified by including <code class="docutils literal notranslate"><span class="pre">qserver_zmq_configuration</span></code> into
the config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>qserver_zmq_configuration:
  control_address: tcp://localhost:60615
  info_address: tcp://localhost:60625
  public_key: ${PUBLIC_KEY}
</pre></div>
</div>
<p>All parameters in the config file are optional and override the values passed using
environment variables and the default values. The public key is typically passed using environment
variable <code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PUBLIC_KEY</span></code>, but different environment variable name could be specified
in the config file as in the example above. Explicitly including public key in the config file
is considered unsafe practice in production systems.</p>
</section>
<section id="custom-routers">
<h3>Custom Routers<a class="headerlink" href="#custom-routers" title="Permalink to this heading">¶</a></h3>
<p>The HTTP Server can be extended to support application-specific functionality by developing
Python modules with custom routers. The module names are passed to the server as <code class="docutils literal notranslate"><span class="pre">:</span></code>-separated
list using the environment variable <code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_CUSTOM_ROUTERS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">QSERVER_HTTP_CUSTOM_ROUTERS</span> <span class="n">modu</span><span class="o">.</span><span class="n">le1</span><span class="p">:</span><span class="n">mod</span><span class="o">.</span><span class="n">ule2</span>
</pre></div>
</div>
<p>Alternatively, the list of modules can be specified in the configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server_configuration</span><span class="p">:</span>
  <span class="n">custom_routers</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">modu</span><span class="o">.</span><span class="n">le1</span>
    <span class="o">-</span> <span class="n">mod</span><span class="o">.</span><span class="n">ule2</span>
</pre></div>
</div>
</section>
<section id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this heading">¶</a></h3>
<p>The server may be configured to run in single-user mode or multi-user mode. In nulti-user
mode the server is using one or more authentication providers to validate user login
data and allows users to obtain access tokens or API keys for authorization of requests.
Single-user and multi-user modes are mutually exclusive: activation of one or more
authentication providers automatically disables single-user mode.</p>
<p>In addition, the server supports autonomous public mode, which could be enabled in
the server configuration. The public mode can be activated for the server running in
single-user or multi-user mode.</p>
<section id="setting-secret-keys">
<h4>Setting Secret Keys<a class="headerlink" href="#setting-secret-keys" title="Permalink to this heading">¶</a></h4>
<p>The server is using secret keys for authentication and authorization algorithms.
If the secret keys are not set in the configuration, the server generates random
secret keys upon startup and the existing tokens stop working after the restart
of the server. This is not acceptable in production deployments, therefore
the server configuration must contain secret keys that do not change between restarts.</p>
<p>The server configuration may contain multiple secret keys (a list of keys).
The first key in the list is used to encode tokens. The server attempts to decode
the received tokens by trying all secret keys.</p>
<p>One method to pass the keys is to set the environment variable <code class="docutils literal notranslate"><span class="pre">QSERVER_HTTP_SERVER_SERVER_SECRET_KEYS</span></code>
with the string value of the key or multiple keys separated by ‘;’. Alternatively
the secret key can be set as part of <em>authentication</em> parameters in the server config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>authentication:
  secret_key:
    - ${SECRET_KEY_1}
    - ${SECRET_KEY_2}
</pre></div>
</div>
<p>It is considered unsafe to keep secret keys in text files, but instead use environment variables
to list the secret keys. In this example, the environment variables <code class="docutils literal notranslate"><span class="pre">SECRET_KEY_1</span></code> and
<code class="docutils literal notranslate"><span class="pre">SECRET_KEY_2</span></code> must be set before starting the server.</p>
<p>Secure secret keys may be generated using <code class="docutils literal notranslate"><span class="pre">openssl</span></code> or by running a Python script from Linux
command line. Generating a secret key using <code class="docutils literal notranslate"><span class="pre">openssl</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">rand</span> <span class="o">-</span><span class="nb">hex</span> <span class="mi">32</span>
</pre></div>
</div>
<p>Generating a secret key Python script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import secrets; print(secrets.token_hex(32))&quot;</span>
</pre></div>
</div>
</section>
<section id="single-user-mode">
<h4>Single-User Mode<a class="headerlink" href="#single-user-mode" title="Permalink to this heading">¶</a></h4>
<p>Single-user access mode is activated by passing single-user API key to the server using
<a class="reference internal" href="usage.html#passing-single-user-api-key-as-ev"><span class="std std-ref">environment variable</span></a> or server config file
<a class="reference internal" href="usage.html#passing-single-user-api-key-in-config"><span class="std std-ref">configuration file</span></a>. The single-user
API key can be used for making API requests. The scopes for single-user access are
defined by API access policy (see <a class="reference internal" href="#basic-api-access-policy"><span class="std std-ref">Basic API Access Policy</span></a> for details).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Single-user mode is disabled if any providers are listed in the server config file.</p>
</div>
</section>
<section id="anonymous-public-access">
<h4>Anonymous Public Access<a class="headerlink" href="#anonymous-public-access" title="Permalink to this heading">¶</a></h4>
<p>Public access may enabled by setting <code class="docutils literal notranslate"><span class="pre">authentication/allow_anonymous_access</span></code> parameter
in the server config file (see <a class="reference internal" href="usage.html#enabling-anonymous-public-access"><span class="std std-ref">Enabling Anonymous Public Access</span></a>). In most practical
deployment anonymous access is expected to be disabled or provide minimal monitoring
privileges.</p>
</section>
<section id="dictionary-authenticator">
<h4>Dictionary Authenticator<a class="headerlink" href="#dictionary-authenticator" title="Permalink to this heading">¶</a></h4>
<p>Dictionary authenticator is recommended for server testing and demos. The authenticator
is receiving username-to-password mapping during initialization. The mapping is defined
as <code class="docutils literal notranslate"><span class="pre">users_to_password</span></code> argument define in server config file.</p>
<p>The following example shows server configured to use with <code class="docutils literal notranslate"><span class="pre">DictionaryAuthenticator</span></code>
for user authentication (named as <em>‘toy’</em> provider), <code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code>
authorization policy and enabled public access:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>authentication:
  allow_anonymous_access: True
  providers:
    - provider: toy
      authenticator: bluesky_httpserver.authenticators:DictionaryAuthenticator
      args:
        users_to_passwords:
          bob: ${BOB_PASSWORD}
          alice: ${ALICE_PASSWORD}
          cara: ${CARA_PASSWORD}
api_access:
  policy: bluesky_httpserver.authorization:DictionaryAPIAccessControl
  args:
    users:
      bob:
        roles:
          - admin
          - expert
      alice:
        roles: advanced
      cara:
        roles: user
</pre></div>
</div>
<p>The passwords are defined in the configuration as environment variable names,
which should be set before starting the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">BOB_PASSWORD</span><span class="o">=</span><span class="n">bob_password</span>
<span class="n">export</span> <span class="n">ALICE_PASSWORD</span><span class="o">=</span><span class="n">alice_password</span>
<span class="n">export</span> <span class="n">CARA_PASSWORD</span><span class="o">=</span><span class="n">cara_password</span>
</pre></div>
</div>
<p>The users <em>‘bob’</em>, <em>‘alice’</em> and <em>‘cara’</em> should now be able to log into the server
and generate tokens and apikeys.</p>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">DictionaryAuthenticator</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authenticators.DictionaryAuthenticator.html#bluesky_httpserver.authenticators.DictionaryAuthenticator" title="bluesky_httpserver.authenticators.DictionaryAuthenticator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authenticators.DictionaryAuthenticator</span></code></a></p></td>
<td><p>For test and demo purposes only!</p></td>
</tr>
</tbody>
</table>
</section>
<section id="ldap-authenticator">
<h4>LDAP Authenticator<a class="headerlink" href="#ldap-authenticator" title="Permalink to this heading">¶</a></h4>
<p>LDAP authenticator is designed for production deployments. The authenticator validates
user login information (username/password) by communicating with LDAP server (e.g. active
Directory server). The following example illustrates how to configure the server to
use demo OpenLDAP server running in docker container (run <code class="docutils literal notranslate"><span class="pre">./start_LDAP.sh</span></code> in the root
of the repository to start the server). The server is configured to authenticate
two users: <em>‘user01’</em> and <em>‘user02’</em> with passwords <em>‘password1’</em> and <em>‘password2’</em>
respectively. The configuration does not enable public access.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authentication</span><span class="p">:</span>
  <span class="n">providers</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">provider</span><span class="p">:</span> <span class="n">ldap</span>
      <span class="n">authenticator</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authenticators</span><span class="p">:</span><span class="n">LDAPAuthenticator</span>
      <span class="n">args</span><span class="p">:</span>
        <span class="n">server_address</span><span class="p">:</span> <span class="n">localhost</span>
        <span class="n">server_port</span><span class="p">:</span> <span class="mi">1389</span>
        <span class="n">use_tls</span><span class="p">:</span> <span class="n">false</span>
        <span class="n">use_ssl</span><span class="p">:</span> <span class="n">false</span>
<span class="n">api_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">DictionaryAPIAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">users</span><span class="p">:</span>
      <span class="n">user01</span><span class="p">:</span>
        <span class="n">roles</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">admin</span>
          <span class="o">-</span> <span class="n">expert</span>
      <span class="n">user02</span><span class="p">:</span>
        <span class="n">roles</span><span class="p">:</span> <span class="n">user</span>
</pre></div>
</div>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">LDAPAuthenticator</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authenticators.LDAPAuthenticator.html#bluesky_httpserver.authenticators.LDAPAuthenticator" title="bluesky_httpserver.authenticators.LDAPAuthenticator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authenticators.LDAPAuthenticator</span></code></a></p></td>
<td><p>LDAP authenticator.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="expiration-time-for-tokens-and-sessions">
<h4>Expiration Time for Tokens and Sessions<a class="headerlink" href="#expiration-time-for-tokens-and-sessions" title="Permalink to this heading">¶</a></h4>
<p>The server is using reasonable default values for lifetimes of the access token (15 minutes)
refresh token (7 days) and sessions (365 days). The default values may be changed in
configuration by setting authentication parameters <code class="docutils literal notranslate"><span class="pre">access_token_max_age</span></code>,
<code class="docutils literal notranslate"><span class="pre">refresh_token_max_age</span></code> and <code class="docutils literal notranslate"><span class="pre">session_max_age</span></code>, which define maximum age of the respecitvely
items in seconds. For example, the following configuration sets maximum age of the tokens
and the session to 10, 3600 and 7200 seconds respectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authentication</span><span class="p">:</span>
  <span class="n">providers</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="nb">list</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">providers</span> <span class="n">here</span> <span class="o">...&gt;</span>
  <span class="n">access_token_max_age</span><span class="p">:</span> <span class="mi">10</span>
  <span class="n">refresh_token_max_age</span><span class="p">:</span> <span class="mi">3600</span>
  <span class="n">session_max_age</span><span class="p">:</span> <span class="mi">7200</span>
</pre></div>
</div>
</section>
</section>
<section id="authorization-api-access">
<h3>Authorization: API Access<a class="headerlink" href="#authorization-api-access" title="Permalink to this heading">¶</a></h3>
<p>The HTTP Server is using API access policy to determine whether an authorized user
is allowed to call requested API. The API access policy associates user names with
one or several roles and the roles with allowed access scopes. If no policy is
selected in the configuration, the server is using <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code>, which
supports API access control for single-user and anonymous public access.
<code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code> policy is a subclass of the basic policy that
accepts the fixed dictionary that maps user names to assigned roles as an argument
during initialization (arguments are defined in the config file) and serves as
a convenient tool for testing, demos and small local deployments.
More sophysticated policies based on <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> should be implemented
for production deployments, where user roles are stored on a secure server.</p>
<section id="basic-api-access-policy">
<span id="id1"></span><h4>Basic API Access Policy<a class="headerlink" href="#basic-api-access-policy" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> is used by default if no API access policy is specified in
the config file. The policy supports access in single-user mode and anonymous public mode.
The policy defines two user names: <code class="docutils literal notranslate"><span class="pre">UNAUTHENTICATED_SINGLE_USER</span></code> and <code class="docutils literal notranslate"><span class="pre">UNAUTHENTICATED_PUBLIC</span></code>
associated with <code class="docutils literal notranslate"><span class="pre">unauthenticated_single_user</span></code> and <code class="docutils literal notranslate"><span class="pre">unauthenticated_public</span></code> respecitvely.
The first user name is used to manage access for clients using single-user API key and
the second user name is used for access without API key or token (calls with an invalid
API key or a token always fail).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Basic policy does not allow any users to log into the server or use tokens and
API keys except the single-user API key.</p>
</div>
<p>If the default scopes are not adequate, the roles can be customized in the config file.
For example, the following configuration adds <code class="docutils literal notranslate"><span class="pre">read:console</span></code> scope to
<code class="docutils literal notranslate"><span class="pre">unauthenticated_public</span></code> role and removes <code class="docutils literal notranslate"><span class="pre">write:scripts</span></code> and <code class="docutils literal notranslate"><span class="pre">user:apikeys</span></code>
scopes from <code class="docutils literal notranslate"><span class="pre">unauthenticated_single_user</span></code> role:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">api_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">BasicAPIAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">roles</span><span class="p">:</span>
      <span class="n">unauthenticated_public</span><span class="p">:</span>
        <span class="n">scopes_add</span><span class="p">:</span> <span class="n">read</span><span class="p">:</span><span class="n">console</span>
      <span class="n">unauthenticated_single_user</span><span class="p">:</span>
        <span class="n">scopes_remove</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">write</span><span class="p">:</span><span class="n">scripts</span>
          <span class="o">-</span> <span class="n">user</span><span class="p">:</span><span class="n">apikeys</span>
</pre></div>
</div>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authorization.BasicAPIAccessControl.html#bluesky_httpserver.authorization.BasicAPIAccessControl" title="bluesky_httpserver.authorization.BasicAPIAccessControl"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authorization.BasicAPIAccessControl</span></code></a></p></td>
<td><p>Basic API access policy.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dictionary-api-access-policy">
<h4>Dictionary API Access Policy<a class="headerlink" href="#dictionary-api-access-policy" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code> is a subclass of <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> and
provides five additional default roles <code class="docutils literal notranslate"><span class="pre">admin</span></code>, <code class="docutils literal notranslate"><span class="pre">expert</span></code>, <code class="docutils literal notranslate"><span class="pre">advanced</span></code>,
<code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">observer</span></code>. The roles are assigned reasonable default scopes,
but could be customized using <code class="docutils literal notranslate"><span class="pre">roles</span></code> argument, which is handled by the
base class. The instructions and examples of customization of roles may
be found in the documentation on <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> policy.</p>
<p>The mapping of user names to user information, including the assigned roles,
displayed name (optional) and email (optional) is passed to <code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code>
using the argument <code class="docutils literal notranslate"><span class="pre">users</span></code>. The optional information is used to generated
formatted displayed name (such as <code class="docutils literal notranslate"><span class="pre">jdoe</span> <span class="pre">&quot;Doe,</span> <span class="pre">John</span> <span class="pre">&lt;jdoe&#64;gmail.com&gt;&quot;)</span></code>
required for some Run Engine Manager API calls. If no users are listed,
the policy behaves identically to <code class="docutils literal notranslate"><span class="pre">BasicAPIAccessControl</span></code> policy.</p>
<p>The following example illustrates how to configure <code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code>
for two users (<code class="docutils literal notranslate"><span class="pre">bob</span></code> and <code class="docutils literal notranslate"><span class="pre">jdoe</span></code> are login usernames):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">api_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">DictionaryAPIAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">users</span><span class="p">:</span>
      <span class="n">bob</span><span class="p">:</span>
        <span class="n">roles</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">admin</span>
          <span class="o">-</span> <span class="n">expert</span>
        <span class="n">email</span><span class="p">:</span> <span class="n">bob</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span>
      <span class="n">jdoe</span><span class="p">:</span>
        <span class="n">roles</span><span class="p">:</span> <span class="n">advanced</span>
        <span class="n">dislayed_name</span><span class="p">:</span> <span class="n">Doe</span><span class="p">,</span> <span class="n">John</span>
        <span class="n">email</span><span class="p">:</span> <span class="n">jdoe</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">DictionaryAPIAccessControl</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authorization.DictionaryAPIAccessControl.html#bluesky_httpserver.authorization.DictionaryAPIAccessControl" title="bluesky_httpserver.authorization.DictionaryAPIAccessControl"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authorization.DictionaryAPIAccessControl</span></code></a></p></td>
<td><p>Dictionary-based API access policy.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="access-policy-based-on-external-access-control-server">
<h4>Access Policy Based on External Access Control Server<a class="headerlink" href="#access-policy-based-on-external-access-control-server" title="Permalink to this heading">¶</a></h4>
<p>The policy is periodically loading user access data from the external
Access Control server. The server holds user access information obtained from other
services, such as Active Directory, and serves the purpose of reducing the load
on those services.</p>
<p>The following example shows configuration of <code class="docutils literal notranslate"><span class="pre">ServerBasedAPIAccessControl</span></code>
to use hypothetical <code class="docutils literal notranslate"><span class="pre">accesscontrol.server.com:60001</span></code> as Access Control server.
The requests are sent with the average period of 300 seconds (+/- 20%). If the server
can not be contacted for 3600 seconds (1 hour), the access control data expires and
users lose access to the Queue Server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">api_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">ServerBasedAPIAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">instrument</span><span class="p">:</span> <span class="n">srx</span>
    <span class="n">server</span><span class="p">:</span> <span class="n">accesscontrol</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span>
    <span class="n">port</span><span class="p">:</span> <span class="mi">60001</span>
    <span class="n">update_period</span><span class="p">:</span> <span class="mi">300</span>
    <span class="n">expiration_period</span><span class="p">:</span> <span class="mi">3600</span>
    <span class="n">roles</span><span class="p">:</span>
      <span class="n">expert</span><span class="p">:</span>
        <span class="n">scopes_remove</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">write</span><span class="p">:</span><span class="n">scripts</span>
          <span class="o">-</span> <span class="n">write</span><span class="p">:</span><span class="n">permissions</span>
</pre></div>
</div>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">ServerBasedAPIAccessControl</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authorization.ServerBasedAPIAccessControl.html#bluesky_httpserver.authorization.ServerBasedAPIAccessControl" title="bluesky_httpserver.authorization.ServerBasedAPIAccessControl"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authorization.ServerBasedAPIAccessControl</span></code></a></p></td>
<td><p>Access policy based on external Access Control Server.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="authorization-resource-access">
<h3>Authorization: Resource Access<a class="headerlink" href="#authorization-resource-access" title="Permalink to this heading">¶</a></h3>
<p>Resource access policy is used to manage user access to resources, such as
plans and devices. The policy associates user name with the group name, which
is passed to Run Engine Manager in some API calls.</p>
<section id="default-resource-access-policy">
<h4>Default Resource Access Policy<a class="headerlink" href="#default-resource-access-policy" title="Permalink to this heading">¶</a></h4>
<p>Only the default policy <code class="docutils literal notranslate"><span class="pre">DefaultResourceAccessControl</span></code> is currently implemented.
This is a simple policy, which associates one fixed group name with all users.
The group name used by default is <code class="docutils literal notranslate"><span class="pre">'primary'</span></code>. <code class="docutils literal notranslate"><span class="pre">DefaultResourceAccessControl</span></code>
with default settings is activated by default if no other policy is selected
in the config file. While the default policy may look simplistic, it may suite
the needs of many production deployments, where user group permissions are
used not for access control, but for filtering out unwanted plans and device to
avoid clutter in the lists of allowed plans and devices (and GUI combo boxes
generated based on those lists).</p>
<p>The default group name can be changed in the policy configuration. For example,
the following policy configuration sets the returned group name to <code class="docutils literal notranslate"><span class="pre">test_user</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource_access</span><span class="p">:</span>
  <span class="n">policy</span><span class="p">:</span> <span class="n">bluesky_httpserver</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span><span class="n">DefaultResourceAccessControl</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">default_group</span><span class="p">:</span> <span class="n">test_user</span>
</pre></div>
</div>
<p>See the documentation on <code class="docutils literal notranslate"><span class="pre">DefaultResourceAccessControl</span></code> for more details.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/bluesky_httpserver.authorization.DefaultResourceAccessControl.html#bluesky_httpserver.authorization.DefaultResourceAccessControl" title="bluesky_httpserver.authorization.DefaultResourceAccessControl"><code class="xref py py-obj docutils literal notranslate"><span class="pre">authorization.DefaultResourceAccessControl</span></code></a></p></td>
<td><p>Default resource access policy.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="control_re_manager.html" class="btn btn-neutral float-left" title="Controlling Run Engine Manager" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="generated/bluesky_httpserver.authenticators.DictionaryAuthenticator.html" class="btn btn-neutral float-right" title="bluesky_httpserver.authenticators.DictionaryAuthenticator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>