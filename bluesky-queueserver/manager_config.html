

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RE Manager Configuration &mdash; bluesky-queueserver 0.0.21.post55+g44ba626 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=0c24fe83" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=66f05e8d"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="qserver : Quick Introduction" href="qserver_quick_ref.html" />
    <link rel="prev" title="Command-Line Tools" href="cli_tools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            bluesky-queueserver
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky/bluesky-queueserver">Source Code on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_for_users.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_queue_server.html">Using the Queue Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="features_and_config.html">Features and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="startup_code.html">Organizing Bluesky Startup Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="item_validation.html">Validation of Queue Items</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_annotation.html">Annotating Bluesky Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_tools.html">Command-Line Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RE Manager Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cli-parameters">CLI Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-files">Configuration Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network">network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#startup">startup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation">operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#worker">worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-engine">run_engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-redis">Using Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-of-ipython-kernel">Configuration of IPython Kernel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="qserver_quick_ref.html"><em>qserver</em> : Quick Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interacting_with_qs.html">Interacting with Queue Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="re_manager_api.html">Run Engine Manager API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver-api">Bluesky Queue Server API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-httpserver">Bluesky HTTP Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-widgets">Bluesky Widgets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">Bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">Ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">Data Broker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bluesky-queueserver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">RE Manager Configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/manager_config.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="re-manager-configuration">
<span id="manager-configuration"></span><h1>RE Manager Configuration<a class="headerlink" href="#re-manager-configuration" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The default settings of RE Manager are optimized for running basic tutorials and
simple demos using built-in startup scripts with simulated plans and devices,
and are not sufficient for development and production deployments. The parameter
values may be passed to RE Manager using environment variables, config file(s)
and CLI parameters. Parameters passed using config file(s) override the parameters
passed using environment variables. Parameters passed using CLI override all other
parameters.</p>
</section>
<section id="cli-parameters">
<h2>CLI Parameters<a class="headerlink" href="#cli-parameters" title="Link to this heading"></a></h2>
<p>Comprehensive list of CLI parameters of RE Manager may be found in the documentation
for <a class="reference internal" href="cli_tools.html#start-re-manager-cli"><span class="std std-ref">start-re-manager</span></a>. Note, that not setting parameters such as <code class="docutils literal notranslate"><span class="pre">--keep-re</span></code>
or <code class="docutils literal notranslate"><span class="pre">--use-persistent-metadata</span></code> does not disable the respective features if
they are enabled in the config file.</p>
</section>
<section id="environment-variables">
<span id="config-environment-variables"></span><h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h2>
<p>Several parameters can be passed to RE Manager using environment variables:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_CONFIG</span></code> - a path to a single config file or a directory containing multiple
config files. The path can be also passed using <code class="docutils literal notranslate"><span class="pre">--config</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_CONTROL_ADDRESS_FOR_SERVER</span></code> - address of the 0MQ REQ-REP socket used
for control communication channel. The address may also be set in the config file or
passed using <code class="docutils literal notranslate"><span class="pre">--zmq-control-addr</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_INFO_ADDRESS_FOR_SERVER</span></code> - address of the 0MQ PUB-SUB socked used to
publish console output. The address may also be set in the config file or passed using
<code class="docutils literal notranslate"><span class="pre">--zmq-info-addr</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_EMERGENCY_LOCK_KEY_FOR_SERVER</span></code> - emergency lock key used to unlock RE Manager
if the lock key set by a user is lost. The key may also be set in the config file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PRIVATE_KEY_FOR_SERVER</span></code> - private key used to decrypt control messages sent
by clients. <strong>Using environment variables may be preferred way of setting the public key.</strong>
Alternatively, the private key may be set in the config file by referencing a different
environment variable. Explicitly listing security keys in the config file is not recommended.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_USE_IPYTHON_KERNEL</span></code> - tells RE Manager whether to start tbe worker in IPython mode
(start IPython kernel) or use plain Python worker. Boolean value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_IP</span></code> - sets IP address for IPython kernel opened in the worker process.
The values are <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code> (automatically find network IP address of the host running
the worker) or valid network IP address of the host. If the address is <code class="docutils literal notranslate"><span class="pre">localhost</span></code> or
<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, the clients running on remote hosts will not be able to connect to the kernel.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_CONNECTION_FILE</span></code> - sets the name of IPython kernel connection file.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_CONNECTION_DIR</span></code> - sets the directory for IPython kernel connection
files. Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_IOPUB_PORT</span></code> - sets the port for IPython kernel IOPub socket.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_HB_PORT</span></code> - sets the port for IPython kernel heartbeat socket.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_CONTROL_PORT</span></code> - sets the port for IPython kernel control socket.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_SHELL_PORT</span></code> - sets the port for IPython kernel shell socket.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_STDIN_PORT</span></code> - sets the port for IPython kernel stdin socket.
Used only in IPython mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_MATPLOTLIB</span></code> - sets Matplotlib backend for IPython kernel.
Used only in IPython mode.</p></li>
</ul>
</div></blockquote>
</section>
<section id="configuration-files">
<span id="config-configuration-files"></span><h2>Configuration Files<a class="headerlink" href="#configuration-files" title="Link to this heading"></a></h2>
<p>The example of a configuration file (e.g. <code class="docutils literal notranslate"><span class="pre">qserver_config.yml</span></code>) that contains all sections and
most of the supported parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>network:
  zmq_control_addr: tcp://*:60615
  zmq_private_key: ${CUSTOM_EV_FOR_PRIVATE_KEY}
  zmq_info_addr: tcp://*:60625
  zmq_publish_console: true
  redis_addr: localhost:6379
  redis_name_prefix: qs_default
startup:
  keep_re: true
  startup_dir: ~/.ipython/profile_collection/startup
  existing_plans_and_devices_path: ~/.ipython/profile_collection/startup
  user_group_permissions_path: ~/.ipython/profile_collection/startup
operation:
  print_console_output: true
  console_logging_level: NORMAL
  update_existing_plans_and_devices: ENVIRONMENT_OPEN
  user_group_permissions_reload: ON_REQUEST
  emergency_lock_key: custom_lock_key
worker:
  use_ipython_kernel: true
  ipython_kernel_ip: auto
  ipython_matplotlib: qt5
  ipython_connection_file: connection_file.json,
  ipython_connection_dir: /tmp
  ipython_shell_port: 60000
  ipython_iopub_port: 60001
  ipython_stdin_port: 60002
  ipython_hb_port: 60003
  ipython_control_port: 60004
run_engine:
  use_persistent_metadata: true
  kafka_server: 127.0.0.1:9092
  kafka_topic: custom_topic_name
  zmq_data_proxy_addr: localhost:5567
  databroker_config: TST
</pre></div>
</div>
<p>All the parameters are optional. The default values or values passed using environment
variables are used for missing parameters. The configuration may be split into multiple YML
files and the path to the directory containing the files passed to RE Manager.</p>
<p>Assuming the configuration is saved in <code class="docutils literal notranslate"><span class="pre">~/.config/qserver/qserver_config.yml</span></code>,
RE Manager can be started as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ start-re-manager --config=~/.config/qserver/qserver_config.yml
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ QSERVER_CONFIG=~/.config/qserver/qserver_config.yml start-re-manager
</pre></div>
</div>
<p>Additional CLI parameters override the respective configuration or default parameters.</p>
<section id="network">
<h3>network<a class="headerlink" href="#network" title="Link to this heading"></a></h3>
<p>Parameters that define for network settings used by RE Manager:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">zmq_control_addr</span></code> - address of the 0MQ REQ-REP socket used  for control communication channel.
The address may also be set using environment variable <code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_CONTROL_ADDRESS_FOR_SERVER</span></code>
or passed using <code class="docutils literal notranslate"><span class="pre">--zmq-control-addr</span></code> CLI parameter. Address format: <code class="docutils literal notranslate"><span class="pre">tcp://*:60615</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zmq_private_key</span></code> - private key used to decrypt control messages sent by clients (40 characters).
The value should be a string referencing an environment variable (e.g. <code class="docutils literal notranslate"><span class="pre">${CUSTOM_EV_NAME}</span></code>)
or a string containing a public key (not recommended). The private key may also be set
using environment variable <code class="docutils literal notranslate"><span class="pre">QSERVER_ZMQ_PRIVATE_KEY_FOR_SERVER</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zmq_info_addr</span></code> - address of the 0MQ PUB-SUB socked used to publish console output. The address
may also be passed using environment variable QSERVER_ZMQ_INFO_ADDRESS_FOR_SERVER or
<code class="docutils literal notranslate"><span class="pre">--zmq-info-addr</span></code> CLI parameter. Address format: <code class="docutils literal notranslate"><span class="pre">tcp://*:60625</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zmq_publish_console</span></code> - enable or disable publishing console output to the socket set using
<code class="docutils literal notranslate"><span class="pre">zmq_info_addr</span></code>. Accepted values are <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>. The value can also passed using
<code class="docutils literal notranslate"><span class="pre">--zmq-publish-console</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redis_addr</span></code> - the address of Redis server, e.g. <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, <code class="docutils literal notranslate"><span class="pre">localhost:6379</span></code>.
The address may also contain a Redis database number, e.g. <code class="docutils literal notranslate"><span class="pre">localhost:6379/0</span></code>.
Redis address may also be passed using <code class="docutils literal notranslate"><span class="pre">--redis-addr</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redis_name_prefix</span></code> - the prefix is appended to the Redis keys to differentiate between keys
created by different instances of RE Manager. The value may also be passed using
<code class="docutils literal notranslate"><span class="pre">--redis-name-prefix</span></code> CLI parameter.</p></li>
</ul>
</section>
<section id="startup">
<h3>startup<a class="headerlink" href="#startup" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Parameters that control opening the worker environment and handling of startup files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keep_re</span></code> - keep and use the instance of the Run Engine created in startup scripts (<code class="docutils literal notranslate"><span class="pre">true</span></code>)
or delete the instance of the Run Engine created in startup scripts and create a new instance
based on settings in <a class="reference internal" href="#config-file-run-engine"><span class="std std-ref">run_engine</span></a> (<code class="docutils literal notranslate"><span class="pre">false</span></code>). The built-in configuration
options for Run Engine are very limited and it is assumed that Run Engine is created in startup
scripts in production deployments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startup_dir</span></code>, <code class="docutils literal notranslate"><span class="pre">startup_profile</span></code>, <code class="docutils literal notranslate"><span class="pre">startup_module</span></code> and <code class="docutils literal notranslate"><span class="pre">startup_script</span></code> are mutually
exclusive parameters that specify a path to startup directory, name of the startup IPython
profile, name of installed Python module containing startup code or a path to startup script.
The values may be passed using <code class="docutils literal notranslate"><span class="pre">--startup-dir</span></code>, <code class="docutils literal notranslate"><span class="pre">--startup-profile</span></code>, <code class="docutils literal notranslate"><span class="pre">--startup-module</span></code>
or <code class="docutils literal notranslate"><span class="pre">--startup-script</span></code> CLI parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">existing_plans_and_devices_path</span></code> - path to file that contains the list of existing plans
and devices. The path may be a relative path to the directory containing startup files.
If the path is directory, then the default file name ‘existing_plans_and_devices.yaml’ is used.
The value may also be passed using <code class="docutils literal notranslate"><span class="pre">--existing-plans-devices</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_group_permissions_path</span></code> - path to a file that contains lists of plans and devices
available to users. The path may be a relative path to the profile collection directory.
If the path is a directory, then the default file name ‘user_group_permissions.yaml’ is used.
The value may also be passed using <code class="docutils literal notranslate"><span class="pre">--user-group-permissions</span></code> CLI parameter.</p></li>
</ul>
</div></blockquote>
</section>
<section id="operation">
<h3>operation<a class="headerlink" href="#operation" title="Link to this heading"></a></h3>
<p>The parameters that define run-time behavior of RE Manager:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">print_console_output</span></code> - enables (<code class="docutils literal notranslate"><span class="pre">true</span></code>) or disables (<code class="docutils literal notranslate"><span class="pre">false</span></code>) printing of console
output in the terminal. The value may also be set using <code class="docutils literal notranslate"><span class="pre">--console-output</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">console_logging_level</span></code> - sets logging level used by RE Manager. The accepted values are
<code class="docutils literal notranslate"><span class="pre">'SILENT'</span></code>, <code class="docutils literal notranslate"><span class="pre">'QUIET'</span></code> <code class="docutils literal notranslate"><span class="pre">'NORMAL'</span></code> (default) and <code class="docutils literal notranslate"><span class="pre">'VERBOSE'</span></code>. The non-default value
may also be selected using <code class="docutils literal notranslate"><span class="pre">--silent</span></code>, <code class="docutils literal notranslate"><span class="pre">--quiet</span></code> and <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> CLI parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_existing_plans_and_devices</span></code> - select when the list of existing plans and devices
stored on disk should be updated. The available choices are not to update the stored
lists (<code class="docutils literal notranslate"><span class="pre">'NEVER'</span></code>), update the lists when the environment is opened
(<code class="docutils literal notranslate"><span class="pre">'ENVIRONMENT_OPEN'</span></code>, default) or update the lists each the lists are changed (<code class="docutils literal notranslate"><span class="pre">'ALWAYS'</span></code>).
The value may be set using <code class="docutils literal notranslate"><span class="pre">--update-existing-plans-devices</span></code> parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_group_permissions_reload</span></code> - select when user group permissions are reloaded from disk.
Options: <code class="docutils literal notranslate"><span class="pre">'NEVER'</span></code> - RE Manager never attempts to load permissions from disk file.
If permissions fail to load from Redis, they are loaded from disk at the first startup
of RE Manager or on request. <code class="docutils literal notranslate"><span class="pre">'ON_REQUEST'</span></code> - permissions are loaded from disk file when
requested by ‘permission_reload’ API call. <code class="docutils literal notranslate"><span class="pre">'ON_STARTUP'</span></code> (default) - permissions are loaded
from disk each time RE Manager is started or when ‘permission_reload’ API request is received.
The value may be set using <code class="docutils literal notranslate"><span class="pre">--user-group-permissions-reload</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emergency_lock_key</span></code> - emergency lock key used to unlock RE Manager if the lock key set by
a user is lost. The key may also be set using environment variable
<code class="docutils literal notranslate"><span class="pre">QSERVER_EMERGENCY_LOCK_KEY_FOR_SERVER</span></code>.</p></li>
</ul>
</section>
<section id="worker">
<span id="config-file-worker"></span><h3>worker<a class="headerlink" href="#worker" title="Link to this heading"></a></h3>
<p>The parameters that define configuration of RE Worker.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">use_ipython_kernel</span></code> - enable/disable IPython mode (<code class="docutils literal notranslate"><span class="pre">true/false</span></code>, default <code class="docutils literal notranslate"><span class="pre">false</span></code>).
In IPython mode the worker creates IPython kernel used to run the worker environment.
If IPython mode is disabled, the worker environment is run using plain Python. The option
can also be set using <code class="docutils literal notranslate"><span class="pre">--use-ipython-kernel</span></code> CLI parameter or <code class="docutils literal notranslate"><span class="pre">QSERVER_USE_IPYTHON_KERNEL</span></code>
environment variable. See <a class="reference internal" href="using_queue_server.html#worker-ipython-kernel"><span class="std std-ref">Running RE Worker with IPython Kernel</span></a> and <a class="reference internal" href="#config-of-ipython-kernel"><span class="std std-ref">Configuration of IPython Kernel</span></a>
for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipython_kernel_ip</span></code> - set IP address of IPython kernel. The option is ignored if worker
is running not in IPython mode. The supported values are <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code> or valid
network IP address of the host. If the IP address is <code class="docutils literal notranslate"><span class="pre">localhost</span></code> (default) or <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>,
the clients running on remote hosts can not connect to the kernel. If the value is <code class="docutils literal notranslate"><span class="pre">auto</span></code>,
the worker attempts to find network address of the host. The option can also be set using
<code class="docutils literal notranslate"><span class="pre">--ipython-kernel-ip</span></code> CLI parameter or <code class="docutils literal notranslate"><span class="pre">QSERVER_IPYTHON_KERNEL_IP</span></code> environment variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipython_matplotlib</span></code> - set Matplotlib backend for IPython kernel. The parameter is ignored
if the worker is not in IPython mode. The parameter accepts the set of values identical to
the parameter <code class="docutils literal notranslate"><span class="pre">--matplotlib</span></code> of <code class="docutils literal notranslate"><span class="pre">IPython</span></code>. Typical values are <code class="docutils literal notranslate"><span class="pre">agg</span></code> (default, disables
plotting) or <code class="docutils literal notranslate"><span class="pre">qt5</span></code> (plotting using Qt5 backend). The option can also be set using
<code class="docutils literal notranslate"><span class="pre">--ipython-matplotlib</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipython_connection_file</span></code> - the name of the IPython kernel connection file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipython_connection_dir</span></code> - the name and directory where IPython kernel creates and looks
for the connection files. The default value is good in most cases.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipython_shell_port</span></code>, <code class="docutils literal notranslate"><span class="pre">ipython_iopub_port</span></code>, <code class="docutils literal notranslate"><span class="pre">ipython_stdin_port</span></code>, <code class="docutils literal notranslate"><span class="pre">ipython_hb_port</span></code>,
<code class="docutils literal notranslate"><span class="pre">ipython_control_port</span></code> - 0MQ ports used by IPython kernel.</p></li>
</ul>
</section>
<section id="run-engine">
<span id="config-file-run-engine"></span><h3>run_engine<a class="headerlink" href="#run-engine" title="Link to this heading"></a></h3>
<p>The parameters that define configuration of Run Engine created by RE Manager and some basic
subscriptions for the Run Engine. The configuration options are very limited and primarily
intended for use in quick demos. It is assumed that in production systems, Run Engine and
its subscriptions are fully defined in startup scripts and this section is skipped completely.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">use_persistent_metadata</span></code> - use msgpack-based persistent storage for scan metadata
(<code class="docutils literal notranslate"><span class="pre">true/false</span></code>). The option can also be enabled using <code class="docutils literal notranslate"><span class="pre">--use-persistent-metadata</span></code> CLI
parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kafka_server</span></code> - bootstrap server to for Kafka Run Engine callback, e.g. <code class="docutils literal notranslate"><span class="pre">127.0.0.1:9092</span></code>.
The value can be set using <code class="docutils literal notranslate"><span class="pre">--kafka-server</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kafka_topic</span></code> - kafka topic of Kafka Run Engine callback. The value can also be set using
<code class="docutils literal notranslate"><span class="pre">--kafka-topic</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zmq_data_proxy_addr</span></code> - address of ZMQ proxy used to publish data by ZMQ Run Engine callback.
The value can also be set using <code class="docutils literal notranslate"><span class="pre">--zmq-data-proxy-addr</span></code> CLI parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">databroker_config</span></code> -  databroker configuration (e.g. <code class="docutils literal notranslate"><span class="pre">'srx'</span></code>) used by Databroker
callback. The value can also be set using <code class="docutils literal notranslate"><span class="pre">--databroker-config</span></code> CLI parameter.</p></li>
</ul>
</section>
</section>
<section id="using-redis">
<h2>Using Redis<a class="headerlink" href="#using-redis" title="Link to this heading"></a></h2>
<p>RE Manager is using Redis as a persistent storage for plan queue, plan history and a few other
parameters, that are expected to be preserved between RE Manager restarts. Starting from version
v0.0.20, RE Manager is appending a prefix to each Redis key. The prefix can be used to identify
the keys created by different instances of RE Manager (not necessarily running simultaneously,
but maintaining different plan queue and history). The prefixed keys can also be easily
distinguished from keys created by other applications using the same Redis server. The default
prefix is <code class="docutils literal notranslate"><span class="pre">qs_default</span></code>. Custom prefix can be passed using <code class="docutils literal notranslate"><span class="pre">--redis-name-prefix</span></code> CLI parameter
or set in the config file using <code class="docutils literal notranslate"><span class="pre">redis_name_prefix</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">network</span></code> section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that Redis server is installed locally on the machine running the Queue Server</p>
</div>
<p>Prior to version v0.0.20, RE Manager did not append any prefix to the keys. If it is desirable
to continue using RE Manager without prefix, e.g. to access the plan queue and history created
by the older version of RE Manager, pass <cite>“”</cite> (empty string) as the parameter value.</p>
</section>
<section id="configuration-of-ipython-kernel">
<span id="config-of-ipython-kernel"></span><h2>Configuration of IPython Kernel<a class="headerlink" href="#configuration-of-ipython-kernel" title="Link to this heading"></a></h2>
<p>Queue Server can be configured to execute plans using IPython or plain Python (default mode).
If IPython mode is enabled, the worker process is starting a new in-process IPython kernel
each time the environment is opened. The worker then connects to the kernel 0MQ ports to
monotor the kernel state and run tasks. External client applications, such as Jupyter console,
may also connect to the same 0MQ ports to communicate with the kernel. The kernel connection,
including kernel IP address, port numbers and location of the connection file, is configured
using a group of connection parameters. The connection parameters may be passed as CLI parameters
(see <a class="reference internal" href="cli_tools.html#start-re-manager-ipython-kernel"><span class="std std-ref">Configuration of IPython Kernel</span></a>), environment variables (see <a class="reference internal" href="#config-environment-variables"><span class="std std-ref">Environment Variables</span></a>)
or set in the manager config file (see <a class="reference internal" href="#config-configuration-files"><span class="std std-ref">Configuration Files</span></a>).</p>
<p>The IPython kernel mode is enable using <code class="docutils literal notranslate"><span class="pre">--use-ipython-kernel</span></code> CLI parameter,  <code class="docutils literal notranslate"><span class="pre">QSERVER_USE_IPYTHON_KERNEL</span></code>
environment variable or <code class="docutils literal notranslate"><span class="pre">use_ipython_kernel</span></code> parameter in the manager config file. IPython mode is
disabled by default. If IPython mode is disabled, the remaining parameters from the group are ignored.</p>
<p>The following rules apply when IPython mode is enabled:</p>
<ul class="simple">
<li><p>Default behavior. If no connection parameters are specified, IPython kernel is created with random ports.
The kernel IP address is set to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, random port numbers are assigned to kernel 0MQ ports and
a new connection file with unique name is created in the default directory.</p></li>
<li><p>Kernel IP address may be set using <code class="docutils literal notranslate"><span class="pre">--ipython-kernel-ip</span></code> CLI parameter. If the parameter value is
<code class="docutils literal notranslate"><span class="pre">localhost</span></code> or <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, the kernel can not be accessed from remote machines. If the value
is <code class="docutils literal notranslate"><span class="pre">auto</span></code>, the worker attempts to find network IP address of the host running the worker. In rare cases
when automatic detection fails, the IP address may be explicitly specified.</p></li>
<li><p>Kernel 0MQ port numbers may be explicitly assigned using the following parameters:
<code class="docutils literal notranslate"><span class="pre">--ipython-shell-port</span></code>, <code class="docutils literal notranslate"><span class="pre">--ipython-iopub-port</span></code>, <code class="docutils literal notranslate"><span class="pre">--ipython-stdin-port</span></code>, <code class="docutils literal notranslate"><span class="pre">--ipython-hb-port</span></code>,
<code class="docutils literal notranslate"><span class="pre">--ipython-control-port</span></code>. Those parameters are optional. Random port numbers are generated for
unassigned ports.</p></li>
<li><p>If the default location used by the kernel to store connection files is not desirable, the directory
may be set using <code class="docutils literal notranslate"><span class="pre">--ipython-connection-dir</span></code> CLI parameter.</p></li>
<li><p>In many cases, it is desirable to reuse the same connection file for new instances of the kernel.
Using the same connection parameters, including the <code class="docutils literal notranslate"><span class="pre">key</span></code> parameter (UUID), allows the clients
to reconnect to the new kernel automatically after the environment is restarted. The connection
file name may be set using <code class="docutils literal notranslate"><span class="pre">--ipython-connection-file</span></code> CLI parameter. If the connection file
does not exist, a new file is created. If the connection file exists, the kernel loads connection
parameters from the file. If any of the loaded connection parameters do not match the parameters
in the manager configuration (e.g. one of the 0MQ port numbers is different), the existing connection
file is updated with the new parameters and the new <code class="docutils literal notranslate"><span class="pre">key</span></code> (UUID) is generated.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The connection parameters in manager configuration override the parameters in IPython kernel config
files, such as <code class="docutils literal notranslate"><span class="pre">ipython_kernel_config.py</span></code>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli_tools.html" class="btn btn-neutral float-left" title="Command-Line Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="qserver_quick_ref.html" class="btn btn-neutral float-right" title="qserver : Quick Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>