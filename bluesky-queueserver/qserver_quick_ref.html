<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qserver : Quick Introduction &mdash; bluesky-queueserver 0.0.19.post55+g60a928e documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=0c24fe83" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=1773ddd3"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interacting with Queue Server" href="interacting_with_qs.html" />
    <link rel="prev" title="RE Manager Configuration" href="manager_config.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            bluesky-queueserver
          </a>
              <div class="version">
                0.0.19.post55+g60a928e
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky/bluesky-queueserver">Source Code on GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_for_users.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_queue_server.html">Using the Queue Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="features_and_config.html">Features and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="startup_code.html">Organizing Bluesky Startup Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython.html">Using IPython Startup Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="item_validation.html">Validation of Queue Items</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_annotation.html">Annotating Bluesky Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_tools.html">Command-Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_config.html">RE Manager Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><em>qserver</em> : Quick Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#starting-queueserver">Starting QueueServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-re-manager-using-qserver-cli-tool">Interacting with RE Manager using <em>qserver</em> CLI tool</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interacting_with_qs.html">Interacting with Queue Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="re_manager_api.html">Run Engine Manager API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-queueserver-api">Bluesky Queue Server API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-httpserver">Bluesky HTTP Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky-widgets">Bluesky Widgets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/bluesky">Bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/ophyd">Ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io/databroker">Data Broker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bluesky-queueserver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><em>qserver</em> : Quick Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/qserver_quick_ref.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="qserver-quick-introduction">
<h1><em>qserver</em> : Quick Introduction<a class="headerlink" href="#qserver-quick-introduction" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The released versions of Queue Server are considered stable and rarely crash. Developers
that are working on the code are very likely experience the server crashing so that
0MQ socket remains open and the server can not be easily restarted. The crash may happen
during interactive experiments with the server or while running unit tests.
To close the sockets (we are interested in sockets on ports 60615 and 60610), find
PIDs of the respective processes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ netstat -ltnp
</pre></div>
</div>
<p>and then kill the processes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kill -9 &lt;pid&gt;
</pre></div>
</div>
</div>
<section id="starting-queueserver">
<h2>Starting QueueServer<a class="headerlink" href="#starting-queueserver" title="Link to this heading">¶</a></h2>
<p>Running the demo requires two shells: the first to run Queue Server (RE Manager) and the second shell
to communicate with the manager using <cite>qserver</cite> CLI tool. See the notes
<a class="reference internal" href="using_queue_server.html#running-re-manager-as-application"><span class="std std-ref">Running RE Manager as an Application</span></a> and tutorial <a class="reference internal" href="tutorials.html#tutorial-starting-queue-server"><span class="std std-ref">Starting the Queue Server</span></a>
for more information</p>
</section>
<section id="interacting-with-re-manager-using-qserver-cli-tool">
<h2>Interacting with RE Manager using <em>qserver</em> CLI tool<a class="headerlink" href="#interacting-with-re-manager-using-qserver-cli-tool" title="Link to this heading">¶</a></h2>
<p>Run <em>qserver</em> with option <cite>-h</cite> to dislay the available options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>The most basic request is ‘ping’ intended to fetch some response from RE Manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">ping</span>
</pre></div>
</div>
<p>Current default address of RE Manager is set to <a class="reference external" href="tcp://localhost:60615">tcp://localhost:60615</a>, but different
address may be passed as a parameter to CLI tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">ping</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;tcp://localhost:60615&quot;</span>
</pre></div>
</div>
<p>The ‘qserver’ CLI tool may run in the monitoring mode (send ‘ping’ request to RE Manager every second):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">monitor</span>
</pre></div>
</div>
<p>Currently ‘ping’ request returns the status of RE Manager, but the returned data may change. The recommended
way to fetch status of RE Manager is to use ‘status’ request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">status</span>
</pre></div>
</div>
<p>Before plans could be executed, the RE Worker environment must be opened. Opening RE Worker environment
involves loading beamline profile collection and instantiation of Run Engine and may take a few minutes.
The package comes with simulated profile collection that includes simulated Ophyd devices and built-in
Bluesky plans and loads almost instantly. An open RE Worker environment may be closed or destroyed.
Orderly closing of the environment is a safe operation, which is possible only when RE Worker
(and RE Manager) is in idle state, i.e. no plans are currently running or paused. Destroying
the environment is potentially dangerous, since it involves killing of RE Process that could potentially
be running plans, and supposed to be used for destroying unresponsive environment in case of RE failure.
Note that any operations on the queue (such as adding or removing plans) can be performed before
the environment is opened.</p>
<p>Open the new RE environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">environment</span> <span class="nb">open</span>
</pre></div>
</div>
<p>Close RE environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">environment</span> <span class="n">close</span>
</pre></div>
</div>
<p>Destroy RE environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">environment</span> <span class="n">destroy</span>
</pre></div>
</div>
<p>Get the lists (JSON) of allowed plans and devices:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">allowed</span> <span class="n">plans</span>
<span class="n">qserver</span> <span class="n">allowed</span> <span class="n">devices</span>
</pre></div>
</div>
<p>The list of allowed plans and devices is generated based on the list of existing plans and devices
(‘existing_plans_and_devices.yaml’ by default) and user group permissions (‘user_group_permissions.yaml’
by default). The files with permission data are loaded at RE Manager startup. If any of the files
are changed while RE Manager is running (e.g. a new plan was added to the profile collection and
the new ‘existing_plans_and_devices.yaml’ file was generated) and restarting RE Manager is not
desirable, the data can be reloaded by sending ‘permissions_reload’ request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">permissions</span> <span class="n">reload</span>
</pre></div>
</div>
<p>Before plans could be executed they should be placed in the <strong>plan queue</strong>. The plan queue contains
<strong>items</strong>. The items are <strong>plans</strong> that could be executed by Run Engine or <strong>instructions</strong> that
can modify the state of the queue or RE Manager. Currently only one instruction (‘queue_stop’ - stops
execution of the queue) is supported.</p>
<p>Push a new plan to the back of the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="s1">&#39;{&quot;name&quot;:&quot;scan&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;], &quot;motor&quot;, -1, 1, 10]}&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]], &quot;kwargs&quot;:{&quot;num&quot;:10, &quot;delay&quot;:1}}&#39;</span>
</pre></div>
</div>
<p>It takes 10 second to execute the third plan in the group above, so it is may be the most convenient for testing
pausing/resuming/stopping of experimental plans.</p>
<p>API for queue operations is designed to work identically with items of all types. For example, a ‘queue_stop`
instruction can be added to the queue <cite>queue_item_add</cite> API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">instruction</span> <span class="n">queue</span><span class="o">-</span><span class="n">stop</span>
</pre></div>
</div>
<p>An item can be added at any position of the queue. Push a plan to the front or the back of the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="n">front</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="n">back</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="mi">2</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>  <span class="c1"># Inserted at pos #2 (0-based)</span>
</pre></div>
</div>
<p>The following command will insert an item in place of the last item in the queue; the last item remains
the last item in the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="o">-</span><span class="mi">1</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
</pre></div>
</div>
<p>An item can be inserted before or after an existing item with given Item UID.
Insert the plan before an existing item with &lt;uid&gt;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="n">before_uid</span> <span class="s1">&#39;&lt;uid&gt;&#39;</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
</pre></div>
</div>
<p>Insert the plan after an existing item with &lt;uid&gt;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="n">after_uid</span> <span class="s1">&#39;&lt;uid&gt;&#39;</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
</pre></div>
</div>
<p>If the queue has 5 items (0..4), then the following command pushes the new plan to the back of the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">add</span> <span class="n">plan</span> <span class="mi">5</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]]}&#39;</span>
</pre></div>
</div>
<p>The ‘queue_item_add’ request will accept any index value. If the index is out of range, then the item will
be pushed to the front or the back of the queue. If the queue is currently running, then it is recommended
to access elements using negative indices (counted from the back of the queue).</p>
<p>The names of the plans and devices are strings. The strings are converted to references to Bluesky plans and
Ophyd devices in the worker process. The simulated beamline profile collection includes all simulated
Ophyd devices and built-in Bluesky plans.</p>
<p>A batch of plans may be submitted to the queue by sending a single request. Every plan in the batch
is validated and the plans are added to the queue only if all plans pass validation. Otherwise the
batch is rejected. Currently <cite>qserver</cite> does not support API for batch operations. “args”:[[“det1”]], “item_type”: “plan”}, {“name”:”count”, “args”:[[“det2”]], “item_type”: “plan”}]’</p>
<p>Queue Server API allow to execute a single item (plan or instruction) submitted with the API call. Execution
of an item starts immediately if possible (RE Manager is idle and RE Worker environment exists), otherwise
API call fails and the item is not added to the queue. The following commands start execution of a single plan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">execute</span> <span class="n">plan</span> <span class="s1">&#39;{&quot;name&quot;:&quot;count&quot;, &quot;args&quot;:[[&quot;det1&quot;, &quot;det2&quot;]], &quot;kwargs&quot;:{&quot;num&quot;:10, &quot;delay&quot;:1}}&#39;</span>
</pre></div>
</div>
<p>Queue can be edited at any time. Changes to the running queue become effective the moment they are
performed. As the currently running plan is finished, the new plan is popped from the top of the queue.</p>
<p>The contents of the queue may be fetched at any time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">get</span>
</pre></div>
</div>
<p>The last item can be removed (popped) from the back of the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">remove</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">remove</span> <span class="n">back</span>
</pre></div>
</div>
<p>The position of the removed item may be specified similarly to <cite>queue_item_add</cite> request with the difference
that the position index must point to the existing element, otherwise the request fails (returns ‘success==False’).
The following examples remove the plan from the front of the queue and the element previous to last:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">remove</span> <span class="n">front</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">remove</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>The items can also be addressed by UID. Remove the item with &lt;uid&gt;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">remove</span> <span class="s1">&#39;&lt;uid&gt;&#39;</span>
</pre></div>
</div>
<p>Items can be read from the queue without changing it. <cite>queue_item_get</cite> requests are formatted identically to
<cite>queue_item_remove</cite> requests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">get</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">get</span> <span class="n">back</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">get</span> <span class="n">front</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">get</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">get</span> <span class="s1">&#39;&lt;uid&gt;&#39;</span>
</pre></div>
</div>
<p>Items can be moved within the queue. Items can be addressed by position or UID. If positional addressing
is used then items are moved from ‘source’ position to ‘destination’ position.
If items are addressed by UID, then the item with &lt;uid_source&gt; is inserted before or after
the item with &lt;uid_dest&gt;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">move</span> <span class="mi">3</span> <span class="mi">5</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">move</span> <span class="o">&lt;</span><span class="n">uid_source</span><span class="o">&gt;</span> <span class="n">before</span> <span class="o">&lt;</span><span class="n">uid_dest</span><span class="o">&gt;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">move</span> <span class="o">&lt;</span><span class="n">uid_source</span><span class="o">&gt;</span> <span class="n">after</span> <span class="o">&lt;</span><span class="n">uid_dest</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Addressing by position and UID can be mixed. The following instruction will move queue item #3
to the position following an item with &lt;uid_dest&gt;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">move</span> <span class="mi">3</span> <span class="n">after</span> <span class="o">&lt;</span><span class="n">uid_dest</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The following instruction moves item with &lt;uid_source&gt; to the front of the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">item</span> <span class="n">move</span> <span class="o">&lt;</span><span class="n">uid_source</span><span class="o">&gt;</span> <span class="s2">&quot;front&quot;</span>
</pre></div>
</div>
<p>The parameters of queue items may be updated or replaced. When the item is replaced, it is assigned a new
item UID, while if the item is updated, item UID remains the same. The commands implementing those
operations do not distinguish plans and instructions, i.e. an instruction may be updated/replaced
by a plan or a plan by an instruction. The operations may be performed using CLI tool by calling
<em>‘queue update’</em> and <em>‘queue replace’</em> with parameter <em>&lt;existing-uid&gt;</em> being item UID of the item in the
queue which is being replaced followed by the JSON representation of the dictionary of parameters
of the new item:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">update</span> <span class="n">plan</span> <span class="o">&lt;</span><span class="n">existing</span><span class="o">-</span><span class="n">uid</span><span class="o">&gt;</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:[[</span><span class="s2">&quot;det1&quot;</span><span class="p">,</span> <span class="s2">&quot;det2&quot;</span><span class="p">]]}</span><span class="s1">&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">update</span> <span class="n">instruction</span> <span class="o">&lt;</span><span class="n">existing</span><span class="o">-</span><span class="n">uid</span><span class="o">&gt;</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span><span class="s2">&quot;queue_stop&quot;</span><span class="p">}</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">replace</span> <span class="n">plan</span> <span class="o">&lt;</span><span class="n">existing</span><span class="o">-</span><span class="n">uid</span><span class="o">&gt;</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:[[</span><span class="s2">&quot;det1&quot;</span><span class="p">,</span> <span class="s2">&quot;det2&quot;</span><span class="p">]]}</span><span class="s1">&#39;</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">replace</span> <span class="n">instruction</span> <span class="o">&lt;</span><span class="n">existing</span><span class="o">-</span><span class="n">uid</span><span class="o">&gt;</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span><span class="s2">&quot;queue_stop&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Remove all entries from the plan queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">clear</span>
</pre></div>
</div>
<p>The plan queue can operate in LOOP mode, which is disabled by default. To enable or disable the LOOP mode
the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">mode</span> <span class="nb">set</span> <span class="n">loop</span> <span class="kc">True</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">mode</span> <span class="nb">set</span> <span class="n">loop</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Start execution of the plan queue. The environment MUST be opened before queue could be started:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">start</span>
</pre></div>
</div>
<p>Request to execute an empty queue is a valid operation that does nothing.</p>
<p>As the queue is running, the list of active runs (runs generated by the running plan may be obtained
at any time). The set of active runs consists of two subsets: open runs and closed runs. For
simple single-run plans the list will contain only one item. The list can be loaded using CLI
commands and HTTP API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">re</span> <span class="n">runs</span>            <span class="c1"># Get the list of active runs (runs generated by the currently running plans)</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">runs</span> <span class="n">active</span>     <span class="c1"># Get the list of active runs</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">runs</span> <span class="nb">open</span>       <span class="c1"># Get the list of open runs (subset of active runs)</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">runs</span> <span class="n">closed</span>     <span class="c1"># Get the list of closed runs (subset of active runs)</span>
</pre></div>
</div>
<p>The queue can be stopped at any time. Stopping the queue is a safe operation. When the stopping
sequence is initiated, the currently running plan is finished and the next plan is not be started.
The stopping sequence can be cancelled if it was activated by mistake or decision was changed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">queue</span> <span class="n">stop</span>
<span class="n">qserver</span> <span class="n">queue</span> <span class="n">stop</span> <span class="n">cancel</span>
</pre></div>
</div>
<p>While a plan in a queue is executed, operation Run Engine can be paused. In the unlikely event
if the request to pause is received while RunEngine is transitioning between two plans, the request
may be rejected by the RE Worker. In this case it needs to be repeated. If Run Engine is in the paused
state, plan execution can be resumed, aborted, stopped or halted. If the plan is aborted, stopped
or halted, it is not removed from the plan queue (it remains the first in the queue) and execution
of the queue is stopped. Execution of the queue may be started again if needed.</p>
<p>Running plan can be paused immediately (returns to the last checkpoint in the plan) or at the next
checkpoint (deferred pause):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">re</span> <span class="n">pause</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">pause</span> <span class="n">deferred</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">pause</span> <span class="n">immediate</span>
</pre></div>
</div>
<p>Resuming, aborting, stopping or halting of currently executed plan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">re</span> <span class="n">resume</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">stop</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">abort</span>
<span class="n">qserver</span> <span class="n">re</span> <span class="n">halt</span>
</pre></div>
</div>
<p>There is minimal user protection features implemented that will prevent execution of
the commands that are not supported in current state of the server. Error messages are printed
in the terminal that is running the server along with output of Run Engine.</p>
<p>Data on executed plans, including stopped plans, is recorded in the history. History can
be downloaded at any time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">history</span> <span class="n">get</span>
</pre></div>
</div>
<p>History is not intended for long-term storage. It can be cleared at any time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">history</span> <span class="n">clear</span>
</pre></div>
</div>
<p>Stop RE Manager (exit RE Manager application). There are two options: safe request that is rejected
when the queue is running or a plan is paused:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">manager</span> <span class="n">stop</span>
<span class="n">qserver</span> <span class="n">manager</span> <span class="n">stop</span> <span class="n">safe_on</span>
</pre></div>
</div>
<p>Manager can be also stopped at any time using unsafe stop, which causes current RE Worker to be
destroyed even if a plan is running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">manager</span> <span class="n">stop</span> <span class="n">safe_off</span>
</pre></div>
</div>
<p>The ‘test_manager_kill’ request is designed specifically for testing ability of RE Watchdog
to restart malfunctioning RE Manager process. This command stops event loop of RE Manager process
and causes RE Watchdog to restart the process (currently after 5 seconds). RE Manager
process is expected to fully recover its state, so that the restart does not affect
running or paused plans or the state of the queue. Another potential use of the request
is to test handling of communication timeouts, since RE Manager does not respond to the request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qserver</span> <span class="n">manager</span> <span class="n">kill</span> <span class="n">test</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="manager_config.html" class="btn btn-neutral float-left" title="RE Manager Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="interacting_with_qs.html" class="btn btn-neutral float-right" title="Interacting with Queue Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>