


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to store analysis results &mdash; databroker 1.2.0.post60+g97b5871b documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to create a new Catalog backed by MongoDB" href="mongo-backed-catalog.html" />
    <link rel="prev" title="How to store data from the Run Engine" href="store-data-from-run-engine.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> databroker
          

          
          </a>

          
            
            
              <div class="version">
                1.2.0.post60+g97b5871b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/install.html">Installation Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search-and-lookup.html">Find Runs in a Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/get-data.html">Get Data from a Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/get-metadata.html">Navigate Metadata in a Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Export Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How-to Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="download-data-samples.html">How to download some Catalogs with data samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-backed-catalog.html">How to create a new Catalog backed by files</a></li>
<li class="toctree-l1"><a class="reference internal" href="store-data-from-run-engine.html">How to store data from the Run Engine</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to store analysis results</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongo-backed-catalog.html">How to create a new Catalog backed by MongoDB</a></li>
</ul>
<p class="caption"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/v2-transition.html">What are the API versions v0, v1, v2?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/local-and-remote-use-cases.html">How can it be used locally and remotely?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/relationship-to-intake.html">What is Databroker’s relationship to Intake?</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/v2.html">New (v2) API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/v1.html">Original (v1 / v0) API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/configuration.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Bluesky Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io">Homepage</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky">GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://gitter.im/NSLS-II/DAMA">Gitter</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">databroker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to store analysis results</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/how-to/store-analysis-results.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-store-analysis-results">
<h1>How to store analysis results<a class="headerlink" href="#how-to-store-analysis-results" title="Permalink to this headline">¶</a></h1>
<p><em>I want to access analysis results using Databroker.</em></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This is very new work and should be treated as experimental.</p>
</div>
<p>Databroker is designed to hold processed and analyzed data as well as raw data.
Currently, it is most commonly used for the former, but it was designed for
both from the start.</p>
<p>When collecting raw data, we can rely on Ophyd and the RunEngine to organize
our data and metadata in a structure recognizable to Databroker. When capturing
analysis results, we have to do some of that works ourselves.</p>
<ol class="arabic">
<li><p>Install <code class="docutils literal notranslate"><span class="pre">bluesky-live</span></code>. If you have a recent version of databroker
(v1.2.0 or higher) then you already have it; it’s a requirement of
databroker’s.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install bluesky-live
</pre></div>
</div>
</li>
<li><p>Organize your data into a BlueskyRun. If your data can be represented as
single table (i.e. a spreadsheet) with dictionary of metadata, then you can
use this simplified interace.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky_live.run_builder</span> <span class="kn">import</span> <span class="nn">build_simple_run</span>

<span class="n">run</span> <span class="o">=</span> <span class="n">buiLd_simple_run</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Here, our “table” is given as a dict of lists, but the following are also accepted:</p>
<ul class="simple">
<li><p>dict of numpy arrays</p></li>
<li><p>pandas DataFrame</p></li>
<li><p>xarray Dataset</p></li>
</ul>
<p>This is approach is equivalent:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky_live.run_builder</span> <span class="kn">import</span> <span class="nn">RunBuilder</span>

<span class="k">with</span> <span class="n">RunBuilder</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">})</span> <span class="k">as</span> <span class="n">builder</span><span class="p">:</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_stream</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]})</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">get_run</span><span class="p">()</span>
</pre></div>
</div>
<p>and, unlike <code class="docutils literal notranslate"><span class="pre">build_simple_run</span></code>, it extends to multiple streams (i.e.
tables or spreadsheets), as in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">RunBuilder</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">})</span> <span class="k">as</span> <span class="n">builder</span><span class="p">:</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_stream</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_stream</span><span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">]})</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">get_run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Store your BlueskyRun.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">documents</span><span class="p">():</span>
    <span class="n">catalog</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may notice that we are falling back to the <code class="docutils literal notranslate"><span class="pre">v1</span></code> API here, where for
all other things we show and recommend the new <code class="docutils literal notranslate"><span class="pre">v2</span></code> API. This is because
we are still <a class="reference external" href="https://github.com/bluesky/databroker/issues/605">discussing the design</a> for this in v2. Until that is sorted
out, this is the officially-recommended solution.</p>
<p>It uses <a class="reference external" href="https://blueskyproject.io/suitcase/">Suitcase</a> internally to do the writing.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mongo-backed-catalog.html" class="btn btn-neutral float-right" title="How to create a new Catalog backed by MongoDB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="store-data-from-run-engine.html" class="btn btn-neutral float-left" title="How to store data from the Run Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015 Brookhaven National Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>