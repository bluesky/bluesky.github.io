

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>sample &mdash; hklpy 0+untagged.1.gfe4591c.dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="user" href="user.html" />
    <link rel="prev" title="geometries" href="geometries.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hklpy
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.1.gfe4591c.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Core Functionality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Ready-to-Use Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ready_to_use.html">Ready-to-Use Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Notes</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="calc.html">calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="context.html">context</a></li>
<li class="toctree-l2"><a class="reference internal" href="diffract.html">diffract</a></li>
<li class="toctree-l2"><a class="reference internal" href="engine.html">engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometries.html">geometries</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-a-sample-with-a-lattice">define a sample with a lattice</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-an-orientation-matrix">define an orientation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compute-the-motor-positions-for-a-reflection">compute the motor positions for a reflection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user.html">user</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html">util</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hklpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="api.html">API Reference</a> &raquo;</li>
        
      <li>sample</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/sample.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sample">
<span id="id1"></span><h1>sample<a class="headerlink" href="#sample" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-hkl.sample"></span><dl class="py class">
<dt id="hkl.sample.HklSample">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">hkl.sample.</span></code><code class="sig-name descname"><span class="pre">HklSample</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'user'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a sample in diffractometer calculations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>calc</strong> (<em>instance of CalcRecip</em>) – Reciprocal space calculation class</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – A user-defined name used to refer to the sample</p></li>
<li><p><strong>sample</strong> (<em>Hkl.Sample</em><em>, </em><em>optional</em>) – A Sample instance from the wrapped Hkl library. Created
automatically if not specified.</p></li>
<li><p><strong>units</strong> (<em>{'user'</em><em>, </em><em>'default'}</em>) – Units to use</p></li>
<li><p><strong>lattice</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – The lattice</p></li>
<li><p><strong>U</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – The crystal orientation matrix, U</p></li>
<li><p><strong>UB</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – The UB matrix, where U is the crystal orientation matrix and B is
the transition matrix of a non-orthonormal (the reciprocal of the
crystal) in an orthonormal system</p></li>
<li><p><strong>ux</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – ux part of the U matrix</p></li>
<li><p><strong>uy</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – uy part of the U matrix</p></li>
<li><p><strong>uz</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – uz part of the U matrix</p></li>
<li><p><strong>reflections</strong> – <p>All reflections for the current sample in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>This assumes the hkl engine is used; generally, the ordered set of
positions for the engine in-use should be specified.</p>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="hkl.sample.HklSample.U">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">U</span></code><a class="headerlink" href="#hkl.sample.HklSample.U" title="Permalink to this definition">¶</a></dt>
<dd><p>The crystal orientation matrix, U</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.UB">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">UB</span></code><a class="headerlink" href="#hkl.sample.HklSample.UB" title="Permalink to this definition">¶</a></dt>
<dd><p>The UB matrix, where U is the crystal orientation matrix and B is the
transition matrix of a non-orthonormal (the reciprocal of the crystal)
in an orthonormal system</p>
<dl class="simple">
<dt>If written to, the B matrix will be kept constant:</dt><dd><p>U * B = UB -&gt; U = UB * B^-1</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.__init__">
<code class="sig-name descname"><span class="pre">__init__</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'user'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize self.  See help(type(self)) for accurate signature.</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample._create_reflection">
<code class="sig-name descname"><span class="pre">_create_reflection</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample._create_reflection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample._create_reflection" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new reflection with the current geometry/detector</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample._get_reflection_dict">
<code class="sig-name descname"><span class="pre">_get_reflection_dict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">refl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample._get_reflection_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample._get_reflection_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return dictionary with reflection details.</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample._refl_matrix">
<code class="sig-name descname"><span class="pre">_refl_matrix</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fcn</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample._refl_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample._refl_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a reflection angle matrix.</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.add_reflection">
<code class="sig-name descname"><span class="pre">add_reflection</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_ub</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.add_reflection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.add_reflection" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a reflection, optionally specifying the detector to use</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Reflection h</p></li>
<li><p><strong>k</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Reflection k</p></li>
<li><p><strong>l</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Reflection l</p></li>
<li><p><strong>detector</strong> (<em>Hkl.Detector</em><em>, </em><em>optional</em>) – The detector</p></li>
<li><p><strong>position</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a><em> or </em><em>namedtuple</em><em>, </em><em>optional</em>) – The physical motor position that this reflection corresponds to
If not specified, the current geometry of the calculation engine is
assumed.</p></li>
<li><p><strong>compute_ub</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Calculate the UB matrix with the last two reflections</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.affine">
<code class="sig-name descname"><span class="pre">affine</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.affine"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.affine" title="Permalink to this definition">¶</a></dt>
<dd><p>Make the sample transform affine</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.clear_reflections">
<code class="sig-name descname"><span class="pre">clear_reflections</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.clear_reflections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.clear_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear all reflections for the current sample.</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.compute_UB">
<code class="sig-name descname"><span class="pre">compute_UB</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.compute_UB"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.compute_UB" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the UB matrix with two reflections.</p>
<p>Using the Busing and Levy method, compute the UB matrix for two sample
reflections, r1 and r2.</p>
<p>Returns the UB matrix or raises gi.repository.GLib.GError
(a change from 0.3.15 and before).  Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if no error
raised but computation was not successful.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r1</strong> (<em>HklReflection</em>) – Reflection 1</p></li>
<li><p><strong>r2</strong> (<em>HklReflection</em>) – Reflection 2</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>UB matrix or raises <code class="docutils literal notranslate"><span class="pre">gi.repository.GLib.GError</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.hkl_calc">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">hkl_calc</span></code><a class="headerlink" href="#hkl.sample.HklSample.hkl_calc" title="Permalink to this definition">¶</a></dt>
<dd><p>The HklCalc instance associated with the sample</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.hkl_sample">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">hkl_sample</span></code><a class="headerlink" href="#hkl.sample.HklSample.hkl_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>The HKL library sample object</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.lattice">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">lattice</span></code><a class="headerlink" href="#hkl.sample.HklSample.lattice" title="Permalink to this definition">¶</a></dt>
<dd><p>The lattice (a, b, c, alpha, beta, gamma)</p>
<p>a, b, c [nm]
alpha, beta, gamma [deg]</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.name">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">name</span></code><a class="headerlink" href="#hkl.sample.HklSample.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the currently selected sample</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.reciprocal">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">reciprocal</span></code><a class="headerlink" href="#hkl.sample.HklSample.reciprocal" title="Permalink to this definition">¶</a></dt>
<dd><p>The reciprocal lattice</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.reflections">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">reflections</span></code><a class="headerlink" href="#hkl.sample.HklSample.reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>All reflections for the current sample in the form:
[(h, k, l), …]</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.reflections_details">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">reflections_details</span></code><a class="headerlink" href="#hkl.sample.HklSample.reflections_details" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list with details of all reflections.</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.remove_reflection">
<code class="sig-name descname"><span class="pre">remove_reflection</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">refl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#HklSample.remove_reflection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.HklSample.remove_reflection" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a specific reflection</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.ux">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ux</span></code><a class="headerlink" href="#hkl.sample.HklSample.ux" title="Permalink to this definition">¶</a></dt>
<dd><p>ux part of the U matrix</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.uy">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">uy</span></code><a class="headerlink" href="#hkl.sample.HklSample.uy" title="Permalink to this definition">¶</a></dt>
<dd><p>uy part of the U matrix</p>
</dd></dl>

<dl class="py method">
<dt id="hkl.sample.HklSample.uz">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">uz</span></code><a class="headerlink" href="#hkl.sample.HklSample.uz" title="Permalink to this definition">¶</a></dt>
<dd><p>uz part of the U matrix</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="hkl.sample.check_lattice">
<code class="sig-prename descclassname"><span class="pre">hkl.sample.</span></code><code class="sig-name descname"><span class="pre">check_lattice</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lattice</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/sample.html#check_lattice"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.sample.check_lattice" title="Permalink to this definition">¶</a></dt>
<dd><p>Check an Hkl.Lattice for validity</p>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><strong>ValueError</strong></a> – </p>
</dd>
</dl>
</dd></dl>

<hr class="docutils" />
<div class="section" id="examples">
<span id="sample-examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>We limit our examples here to just a few brief examples will show how to
define a sample, its crystal lattice, and orient the crystal to position
it using reciprocal space coordinates.  We’ll leave it to others (for
now) to show more comprehensive examples that show additional
capabilities, such as limiting the ranges of the motors for acceptable
solutions of the <em>forward</em> calculation from (<em>hkl</em>) to motor positions.</p>
<p>These examples use a diffractometer object called <code class="docutils literal notranslate"><span class="pre">fourc</span></code> which we’ll
take to be an instance of a 4-circle diffractometer in vertical
scattering geometry (<em>E4CV</em>) with simulated motors.  (This is similar
to the 6-circle example <a class="reference internal" href="geometries.html#geometries-sim6c"><span class="std std-ref">sim6c: Eulerian 6-circle with simulated motors</span></a>.)</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gi</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s1">&#39;Hkl&#39;</span><span class="p">,</span> <span class="s1">&#39;5.0&#39;</span><span class="p">)</span>
<span class="c1"># MUST come before `import hkl`</span>
<span class="kn">import</span> <span class="nn">hkl.diffract</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">PseudoSingle</span><span class="p">,</span> <span class="n">SoftPositioner</span>

<span class="k">class</span> <span class="nc">SimulatedE4CV</span><span class="p">(</span><span class="n">hkl</span><span class="o">.</span><span class="n">diffract</span><span class="o">.</span><span class="n">E4CV</span><span class="p">):</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">)</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">)</span>
    <span class="n">tth</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start the SoftPositioner objects with initial values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_positioners</span><span class="p">:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Then, create the <code class="docutils literal notranslate"><span class="pre">fourc</span></code> object for these examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span> <span class="o">=</span> <span class="n">SimulatedE4CV</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fourc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="define-a-sample-with-a-lattice">
<h3>define a sample with a lattice<a class="headerlink" href="#define-a-sample-with-a-lattice" title="Permalink to this headline">¶</a></h3>
<p>Define a sample with the name <em>EuPtIn4_eh1_ver</em> and define its
crystal lattice.  Use angstroms as units for the unit cell edges
and degrees for the angles.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl.util</span> <span class="kn">import</span> <span class="n">Lattice</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">new_sample</span><span class="p">(</span><span class="s1">&#39;EuPtIn4_eh1_ver&#39;</span><span class="p">,</span>
    <span class="n">lattice</span><span class="o">=</span><span class="n">Lattice</span><span class="p">(</span>
        <span class="n">a</span><span class="o">=</span><span class="mf">4.542</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">16.955</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">7.389</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="define-an-orientation-matrix">
<h3>define an orientation matrix<a class="headerlink" href="#define-an-orientation-matrix" title="Permalink to this headline">¶</a></h3>
<p>This is a brief example to define two reflections and then
apply the method of Busing &amp; Levy <a class="footnote-reference brackets" href="#id4" id="id2">1</a> to calculate
an orientation matrix.</p>
<p>For this example, the reflection positions were found
at a wavelength of 1.62751693358 angstroms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1.62751693358</span>
</pre></div>
</div>
<p>We found the (<em>080</em>) reflection
at these motor positions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span>
    <span class="n">omega</span><span class="o">=</span><span class="mf">22.31594</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">89.1377</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tth</span><span class="o">=</span><span class="mf">45.15857</span><span class="p">)</span>
</pre></div>
</div>
<p>Associate <cite>p</cite> (the motor positions) with the (<em>080</em>) reflection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Do the same for the (<em>0 12 1</em>) reflection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span>
    <span class="n">omega</span><span class="o">=</span><span class="mf">34.96232</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">78.3139</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tth</span><span class="o">=</span><span class="mf">71.8007</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Compute the <strong>UB</strong> matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">compute_UB</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
<p>See the <strong>libhkl</strong> documentation <a class="footnote-reference brackets" href="#id5" id="id3">2</a> for more details.</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Acta Cryst 22 (1967) 457-464</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p><strong>libhkl</strong> documentation:
<a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html">https://people.debian.org/~picca/hkl/hkl.html</a></p>
</dd>
</dl>
</div>
<div class="section" id="compute-the-motor-positions-for-a-reflection">
<h3>compute the motor positions for a reflection<a class="headerlink" href="#compute-the-motor-positions-for-a-reflection" title="Permalink to this headline">¶</a></h3>
<p>Compute the motor positions for the (<em>100</em>) reflection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be assigned to a python object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, the motor positions can be accessed: <code class="docutils literal notranslate"><span class="pre">p.omega</span></code>, <code class="docutils literal notranslate"><span class="pre">p.chi</span></code>,
<code class="docutils literal notranslate"><span class="pre">p.phi</span></code>, <code class="docutils literal notranslate"><span class="pre">p.tth</span></code>.</p>
<p>These are the motor angles computed as the first solution:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 21%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>(hkl)</p></th>
<th class="head"><p>omega</p></th>
<th class="head"><p>chi</p></th>
<th class="head"><p>phi</p></th>
<th class="head"><p>tth</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(1, 0, 0)</p></td>
<td><p>10.32101</p></td>
<td><p>0.20845</p></td>
<td><p>86.38310</p></td>
<td><p>20.64202</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="user.html" class="btn btn-neutral float-right" title="user" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="geometries.html" class="btn btn-neutral float-left" title="geometries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2014-2021, Brookhaven National Laboratory.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>