
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NSLS-II TARDIS Configuration &#8212; hklpy 1.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=650650d5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Constraints" href="../../constraints.html" />
    <link rel="prev" title="Use E4CV’s \(Q\) calculation engine" href="var_engines.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">hklpy 1.1</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release_notes.html">
                        Release History
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release_notes.html">
                        Release History
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ready_to_use.html">Simulated Diffractometers</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../diffractometer.html">Diffractometer Geometries</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="geo_e4cv.html">E4CV : 4-circle diffractometer example</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo_e6c.html">E6C : 6-circle diffractometer example</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo_k4cv.html">K4CV : 4-circle kappa diffractometer example</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howto.html">How-to Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="how_additional_parameters.html">Diffractometer “Parameters”</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_configuration.html">Sample orientation: export &amp; restore diffractometer configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_extra_real_axis.html">How to add extra motors to a diffractometer class</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_spec_commands.html">SPEC commands in Bluesky</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../t_and_c.html">Tests and Comparisons</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tst_UB_in_descriptor_document.html"><strong>UB</strong> : Save and Restore Crystal Orientation</a></li>



<li class="toctree-l2"><a class="reference internal" href="tst_UB_in_stream.html">WIP: save reflection information in stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="tst_e4cv_fourc.html">Compare E4CV 4-circle orientation with SPEC fourc</a></li>
<li class="toctree-l2"><a class="reference internal" href="tst_e6c_test_calculations.html">Non-exhaustive test of E6C calculations</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../variations.html">Variations</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="var_e4cv_renamed_axes.html">Rename the axes of a 4-circle diffractometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="var_engines.html">Use <code class="docutils literal notranslate"><span class="pre">E4CV</span></code>’s <span class="math notranslate nohighlight">\(Q\)</span> calculation engine</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">NSLS-II TARDIS Configuration</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../constraints.html">Constraints</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../user_guide.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="../variations.html" class="nav-link">Variations</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">NSLS-II...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="NSLS-II-TARDIS-Configuration">
<h1>NSLS-II TARDIS Configuration<a class="headerlink" href="#NSLS-II-TARDIS-Configuration" title="Link to this heading">#</a></h1>
<p>This notebook documents some calculations using a simulation of the Tardis diffractometer (an <code class="docutils literal notranslate"><span class="pre">E6C</span></code> variation) at NSLS-II. The connections with the EPICS motors have been replaced with simulated motors for this example.</p>
<p>Using the <a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html#orge5e0490">E6C</a> geometry from <a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html">libhkl</a>, &#64;cmazzoli found that, in this geometry, with the “lifting_detector_mu” mode, the following mapping applies:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>libhkl</p></th>
<th class="head"><p>TARDIS</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mu</p></td>
<td><p>theta</p></td>
</tr>
<tr class="row-odd"><td><p>gamma</p></td>
<td><p>delta</p></td>
</tr>
<tr class="row-even"><td><p>delta</p></td>
<td><p>gamma</p></td>
</tr>
<tr class="row-odd"><td><p>phi</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>chi</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>omega</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The diffractometer geometry with angle and axis definitions are depicted below</p></li>
</ul>
<p><img alt="ffea21e90e804523863baefbfaf37ca1" class="no-scaled-link" src="../../_images/6-circle-schematic.png" style="width: 480px; height: 320px;" /></p>
<ul class="simple">
<li><p><em>libhkl</em> documentation of the <a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html#orge5e0490">E6C (Eulerian 6-circle) geometry</a></p></li>
</ul>
<p>Begin by instantiating a calculation engine of the appropriate geometry, and configuring its mode as <strong>lifting_detector_mu</strong> . We must reach into the <code class="docutils literal notranslate"><span class="pre">hkl.calc</span></code> module to import <code class="docutils literal notranslate"><span class="pre">CalcE6C</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl.calc</span> <span class="kn">import</span> <span class="n">CalcE6C</span>

<span class="n">tardis_calc</span> <span class="o">=</span> <span class="n">CalcE6C</span><span class="p">()</span>

<span class="c1"># what modes are available?</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available modes: </span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">modes</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">physical_axes</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">pseudo_axes</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Available modes: tardis_calc.engine.modes = [&#39;bissector_vertical&#39;, &#39;constant_omega_vertical&#39;, &#39;constant_chi_vertical&#39;, &#39;constant_phi_vertical&#39;, &#39;lifting_detector_phi&#39;, &#39;lifting_detector_omega&#39;, &#39;lifting_detector_mu&#39;, &#39;double_diffraction_vertical&#39;, &#39;bissector_horizontal&#39;, &#39;double_diffraction_horizontal&#39;, &#39;psi_constant_vertical&#39;, &#39;psi_constant_horizontal&#39;, &#39;constant_mu_horizontal&#39;]
tardis_calc.physical_axes = OrderedDict([(&#39;mu&#39;, 0.0), (&#39;omega&#39;, 0.0), (&#39;chi&#39;, 0.0), (&#39;phi&#39;, 0.0), (&#39;gamma&#39;, 0.0), (&#39;delta&#39;, 0.0)])
tardis_calc.pseudo_axes = OrderedDict([(&#39;h&#39;, 0.0), (&#39;k&#39;, 0.0), (&#39;l&#39;, 0.0)])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;lifting_detector_mu&#39;</span>
</pre></div>
</div>
</div>
<p>Next, seed the calculation engine with a parameterized sample and wavelength (or energy).</p>
<p><strong>NOTE</strong>: length units are in Angstrom, angles are in degrees, and energy is in keV.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">Lattice</span>

<span class="c1"># lattice cell lengths are in Angstrom, angles are in degrees</span>
<span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">9.069</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">9.069</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">10.390</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">120.0</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="o">.</span><span class="n">new_sample</span><span class="p">(</span><span class="s1">&#39;sample1&#39;</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sample</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sample = HklSample(name=&#39;sample1&#39;, lattice=LatticeTuple(a=9.069, b=9.069, c=10.39, alpha=90.0, beta=90.0, gamma=119.99999999999999), ux=Parameter(name=&#39;None (internally: ux)&#39;, limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units=&#39;Degree&#39;), uy=Parameter(name=&#39;None (internally: uy)&#39;, limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units=&#39;Degree&#39;), uz=Parameter(name=&#39;None (internally: uz)&#39;, limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units=&#39;Degree&#39;), U=array([[1., 0., 0.],
       [0., 1., 0.],
       [0., 0., 1.]]), UB=array([[ 7.99999720e-01,  3.99999860e-01, -6.41365809e-17],
       [ 0.00000000e+00,  6.92820080e-01, -6.41365809e-17],
       [ 0.00000000e+00,  0.00000000e+00,  6.04733908e-01]]), reflections=[])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1.61198</span>  <span class="c1"># in Angstrom</span>

<span class="c1"># just to check</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Energy: </span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">energy</span><span class="w"> </span><span class="si">= }</span><span class="s2"> keV&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energy: tardis_calc.energy = 7.691422871251505 keV
</pre></div></div>
</div>
<p>Now, apply constraints appropriate for TARDIS’ geometry. This includes setting limits on the acceptable ranges of motion, initial (and constant!) values, and whether or not a particular axis should be factored into the fitting function that produces the forward and inverse solutions.</p>
<p>Since we are working with a <code class="docutils literal notranslate"><span class="pre">hkl.calc.CalcRecip</span></code> object, we do not have access to the convenience of the <code class="docutils literal notranslate"><span class="pre">apply_constraints()</span></code> method provided by the <code class="docutils literal notranslate"><span class="pre">hkl.diffract.Diffractometer</span></code> class. We have to set the constraints the hard way. These are the same steps implemented within <code class="docutils literal notranslate"><span class="pre">apply_constraints()</span></code>.</p>
<p><strong>NOTE</strong>: physical motors should be checked that limits are in place prior to initiating any motion. Note also that none of the calculations below are associated with any physical motors, and that there is no connection between “limit” values used in the calculation, and soft-limit values that may be present in a control system for physical motors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Theta</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
<span class="n">mu</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">181</span><span class="p">,</span> <span class="mi">181</span><span class="p">)</span>
<span class="n">mu</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># we don&#39;t have it. Fix to 0</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span>
<span class="n">phi</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">phi</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># we don&#39;t have it. Fix to 0</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span>
<span class="n">chi</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">chi</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># we don&#39;t have it!! Fix to 0</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>
<span class="n">omega</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">omega</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># NOTE: Tardis detector stage names are swapped from canonical names!</span>
<span class="c1"># delta</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
<span class="n">gamma</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">gamma</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># gamma</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">]</span>
<span class="n">delta</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">delta</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<p>We can take a look at the UB matrix, but thus far, it won’t be very interesting</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">UB</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.sample.UB = array([[ 7.99999720e-01,  3.99999860e-01, -6.41365809e-17],
       [ 0.00000000e+00,  6.92820080e-01, -6.41365809e-17],
       [ 0.00000000e+00,  0.00000000e+00,  6.04733908e-01]])
</pre></div></div>
</div>
<p>Add two, known reflections and the motor positions associated with those hkl values. Here, we are using values from &#64;cmazolli’s ESRF notes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(3,3,0): del = 64.449, gam = -0.871, th = 25.285
(5,2,0): del = 79.712, gam = -1.374, th = 46.816
</pre></div>
</div>
<p><strong>NOTE</strong>: the translation of gamma==delta, delta==gamma, and mu==theta is being used</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="n">position</span><span class="o">=</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="mf">64.449</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">25.285</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=-</span><span class="mf">0.871</span><span class="p">))</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">tardis_calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="n">position</span><span class="o">=</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="mf">79.712</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">46.816</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=-</span><span class="mf">1.374</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">reflections</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.sample.reflections = [(h=3.0, k=3.0, l=0.0), (h=5.0, k=2.0, l=0.0)]
</pre></div></div>
</div>
<p>Now a UB matrix can be computed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">compute_UB</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0.31323551, -0.4807593 ,  0.01113654],
       [ 0.73590724,  0.63942704,  0.01003773],
       [-0.01798898, -0.00176066,  0.60454803]])
</pre></div></div>
</div>
<p>Compare some libhkl-generated results with those from &#64;cmazolli’s notes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Experimentally found reflections @ Lambda = 1.61198 A</span>
<span class="c1"># (4, 4, 0) = [90.628, 38.373, 0, 0, 0, -1.156]</span>
<span class="c1"># (4, 1, 0) = [56.100, 40.220, 0, 0, 0, -1.091]</span>
<span class="c1"># @ Lambda = 1.60911</span>
<span class="c1"># (6, 0, 0) = [75.900, 61.000, 0, 0, 0, -1.637]</span>
<span class="c1"># @ Lambda = 1.60954</span>
<span class="c1"># (3, 2, 0) = [53.090, 26.144, 0, 0, 0, -.933]</span>
<span class="c1"># (5, 4, 0) = [106.415, 49.900, 0, 0, 0, -1.535]</span>
<span class="c1"># (4, 5, 0) = [106.403, 42.586, 0, 0, 0, -1.183]</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.forward((4,4,0)) = (PosCalcE6C(mu=38.37622128052063, omega=0.0, chi=0.0, phi=0.0, gamma=90.63030469353308, delta=-1.1613181970939916),)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.forward((4,1,0)) = (PosCalcE6C(mu=40.219919777570965, omega=0.0, chi=0.0, phi=0.0, gamma=56.09704093977083, delta=-1.0836608655032929),)
</pre></div></div>
</div>
<p>Change wavelength here to 1.60911 Angstrom. Note the difference below in <code class="docutils literal notranslate"><span class="pre">delta</span></code> (TARDIS’ gamma axis)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change wavelength (Angstrom)</span>
<span class="n">tardis_calc</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1.60911</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.forward((6,0,0)) = (PosCalcE6C(mu=60.99346591074179, omega=0.0, chi=0.0, phi=0.0, gamma=75.84521749189145, delta=-1.5839501607961701),)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1.60954</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis_calc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis_calc.forward((3,2,0)) = (PosCalcE6C(mu=26.173823521308144, omega=0.0, chi=0.0, phi=0.0, gamma=53.05207622287554, delta=-0.8437995840438257),)
tardis_calc.forward((5,4,0)) = (PosCalcE6C(mu=49.892322604056034, omega=0.0, chi=0.0, phi=0.0, gamma=106.32053081067252, delta=-1.423656049079967),)
tardis_calc.forward((4,5,0)) = (PosCalcE6C(mu=42.54926633295045, omega=0.0, chi=0.0, phi=0.0, gamma=106.31894239326303, delta=-1.1854071532601609),)
</pre></div></div>
</div>
</section>
<section id="HKL-PseudoPositioner-Use">
<h1>HKL PseudoPositioner Use<a class="headerlink" href="#HKL-PseudoPositioner-Use" title="Link to this heading">#</a></h1>
<p>Let’s explore the idea of an hkl ‘motor’</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="n">EpicsMotor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">SimulatedE6C</span>

<span class="c1"># FIXME: hack to get around what should have been done at init of tardis_calc instance</span>
<span class="n">tardis_calc</span><span class="o">.</span><span class="n">_lock_engine</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">Tardis</span><span class="p">(</span><span class="n">SimulatedE6C</span><span class="p">):</span> <span class="o">...</span>

<span class="c1"># class Tardis(E6C):</span>
<span class="c1">#     h = Cpt(PseudoSingle, &#39;&#39;)</span>
<span class="c1">#     k = Cpt(PseudoSingle, &#39;&#39;)</span>
<span class="c1">#     l = Cpt(PseudoSingle, &#39;&#39;)</span>

<span class="c1">#     theta = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X1}Mtr&#39;)</span>
<span class="c1">#     omega = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X2}Mtr&#39;)</span>
<span class="c1">#     chi = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X3}Mtr&#39;)</span>
<span class="c1">#     phi = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X4}Mtr&#39;)</span>
<span class="c1">#     delta = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X5}Mtr&#39;)</span>
<span class="c1">#     gamma = Cpt(EpicsMotor, &#39;XF:31IDA-OP{Tbl-Ax:X6}Mtr&#39;)</span>

<span class="c1"># re-map Tardis&#39; axis names onto what an E6C expects</span>
<span class="n">name_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># tardis: E6C</span>
    <span class="s1">&#39;mu&#39;</span><span class="p">:</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span>
    <span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="s1">&#39;omega&#39;</span><span class="p">,</span>
    <span class="s1">&#39;chi&#39;</span><span class="p">:</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">tardis</span> <span class="o">=</span> <span class="n">Tardis</span><span class="p">(</span>
    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1"># no prefix</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tardis&#39;</span><span class="p">,</span> <span class="c1"># local name</span>
    <span class="n">calc_inst</span><span class="o">=</span><span class="n">tardis_calc</span><span class="p">,</span> <span class="c1"># the calc engine setup above</span>
    <span class="c1"># energy=tardis_calc.energy, # FIXME: unexpected keyword argument</span>
<span class="p">)</span>
<span class="n">tardis</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">physical_axis_names</span> <span class="o">=</span> <span class="n">name_map</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">physical_axis_names</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.calc.physical_axis_names = [&#39;theta&#39;, &#39;omega&#39;, &#39;chi&#39;, &#39;phi&#39;, &#39;delta&#39;, &#39;gamma&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">real_position</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.real_position = TardisRealPos(mu=0, omega=0, chi=0, phi=0, gamma=0, delta=0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">connected</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.connected = True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Energy: </span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="si">= }</span><span class="s2"> keV&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energy: tardis.energy.get() = 8.0 keV
</pre></div></div>
</div>
<section id="Move-to-(101)-reflection">
<h2>Move to (101) reflection<a class="headerlink" href="#Move-to-(101)-reflection" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MoveStatus(done=False, pos=tardis, elapsed=0.0, success=False, settle_time=0.0)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">done</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
status.done = True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">real_position</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.real_position = TardisRealPos(mu=32.61342481972243, omega=0.0, chi=0.0, phi=0.0, gamma=12.011255441335317, delta=8.64179902840924)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">position</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.position = TardisPseudoPos(h=1.0000000000000002, k=-5.667215834780817e-16, l=1.0)
</pre></div></div>
</div>
</section>
<section id="Move-to-(102)-reflection">
<h2>Move to (102) reflection<a class="headerlink" href="#Move-to-(102)-reflection" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MoveStatus(done=True, pos=tardis, elapsed=0.0, success=True, settle_time=0.0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;tardis_h&#39;,
              {&#39;source&#39;: &#39;PY:tardis_h.position&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_h_setpoint&#39;,
              {&#39;source&#39;: &#39;PY:tardis_h.target&#39;,
               &#39;dtype&#39;: &#39;integer&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;tardis_h&#39;, {&#39;value&#39;: 1.0, &#39;timestamp&#39;: 1700539353.9169118}),
             (&#39;tardis_h_setpoint&#39;,
              {&#39;value&#39;: 1, &#39;timestamp&#39;: 1700539353.9169252})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;tardis_h&#39;,
              {&#39;source&#39;: &#39;PY:tardis_h.position&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_h_setpoint&#39;,
              {&#39;source&#39;: &#39;PY:tardis_h.target&#39;,
               &#39;dtype&#39;: &#39;integer&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_k&#39;,
              {&#39;source&#39;: &#39;PY:tardis_k.position&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_k_setpoint&#39;,
              {&#39;source&#39;: &#39;PY:tardis_k.target&#39;,
               &#39;dtype&#39;: &#39;integer&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_l&#39;,
              {&#39;source&#39;: &#39;PY:tardis_l.position&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_l_setpoint&#39;,
              {&#39;source&#39;: &#39;PY:tardis_l.target&#39;,
               &#39;dtype&#39;: &#39;integer&#39;,
               &#39;shape&#39;: [],
               &#39;upper_ctrl_limit&#39;: 0,
               &#39;lower_ctrl_limit&#39;: 0,
               &#39;units&#39;: &#39;&#39;}),
             (&#39;tardis_mu&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180}),
             (&#39;tardis_omega&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180}),
             (&#39;tardis_chi&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180}),
             (&#39;tardis_phi&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180}),
             (&#39;tardis_gamma&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180}),
             (&#39;tardis_delta&#39;,
              {&#39;source&#39;: &#39;computed&#39;,
               &#39;dtype&#39;: &#39;number&#39;,
               &#39;shape&#39;: [],
               &#39;units&#39;: &#39;&#39;,
               &#39;lower_ctrl_limit&#39;: -180,
               &#39;upper_ctrl_limit&#39;: 180})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;tardis_h&#39;, {&#39;value&#39;: 1.0, &#39;timestamp&#39;: 1700539353.9169118}),
             (&#39;tardis_h_setpoint&#39;,
              {&#39;value&#39;: 1, &#39;timestamp&#39;: 1700539353.9169252}),
             (&#39;tardis_k&#39;,
              {&#39;value&#39;: -1.0351079150284598e-17,
               &#39;timestamp&#39;: 1700539353.9170356}),
             (&#39;tardis_k_setpoint&#39;,
              {&#39;value&#39;: 0, &#39;timestamp&#39;: 1700539353.917049}),
             (&#39;tardis_l&#39;,
              {&#39;value&#39;: 1.9999999999999998, &#39;timestamp&#39;: 1700539353.9170997}),
             (&#39;tardis_l_setpoint&#39;,
              {&#39;value&#39;: 2, &#39;timestamp&#39;: 1700539353.9171119}),
             (&#39;tardis_mu&#39;,
              {&#39;value&#39;: 42.936333275662705, &#39;timestamp&#39;: 1700539353.9886892}),
             (&#39;tardis_omega&#39;, {&#39;value&#39;: 0.0, &#39;timestamp&#39;: 1700539353.9886923}),
             (&#39;tardis_chi&#39;, {&#39;value&#39;: 0.0, &#39;timestamp&#39;: 1700539353.9886947}),
             (&#39;tardis_phi&#39;, {&#39;value&#39;: 0.0, &#39;timestamp&#39;: 1700539353.9886968}),
             (&#39;tardis_gamma&#39;,
              {&#39;value&#39;: 12.143148125839154, &#39;timestamp&#39;: 1700539353.9886992}),
             (&#39;tardis_delta&#39;,
              {&#39;value&#39;: 17.765469685728892, &#39;timestamp&#39;: 1700539353.9887023})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">position</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.position = TardisPseudoPos(h=1.0, k=-1.0351079150284598e-17, l=1.9999999999999998)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tardis</span><span class="o">.</span><span class="n">real_position</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tardis.real_position = TardisRealPos(mu=42.936333275662705, omega=0.0, chi=0.0, phi=0.0, gamma=12.143148125839154, delta=17.765469685728892)
</pre></div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="var_engines.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Use <code class="docutils literal notranslate"><span class="pre">E4CV</span></code>’s <span class="math notranslate nohighlight">\(Q\)</span> calculation engine</p>
      </div>
    </a>
    <a class="right-next"
       href="../../constraints.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Constraints</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">NSLS-II TARDIS Configuration</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#HKL-PseudoPositioner-Use">HKL PseudoPositioner Use</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Move-to-(101)-reflection">Move to (101) reflection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Move-to-(102)-reflection">Move to (102) reflection</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/examples/notebooks/var_nslsii_tardis.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2014-2023, Brookhaven National Laboratory.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>