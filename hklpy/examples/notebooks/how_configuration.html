
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sample orientation: export &amp; restore diffractometer configuration &#8212; hklpy 1.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=96df9552"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to add extra motors to a diffractometer class" href="how_extra_real_axis.html" />
    <link rel="prev" title="Diffractometer “Parameters”" href="how_additional_parameters.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">hklpy 1.1</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release_notes.html">
                        Release History
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release_notes.html">
                        Release History
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ready_to_use.html">Simulated Diffractometers</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../diffractometer.html">Diffractometer Examples</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="geo_e4cv.html">E4CV : 4-circle diffractometer example</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo_e6c.html">E6C : 6-circle diffractometer example</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo_k4cv.html">K4CV : 4-circle kappa diffractometer example</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../howto.html">How-to Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="how_additional_parameters.html">Diffractometer “Parameters”</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Sample orientation: export &amp; restore diffractometer configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_extra_real_axis.html">How to add extra motors to a diffractometer class</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_spec_commands.html">SPEC commands in Bluesky</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../t_and_c.html">Tests and Comparisons</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tst_UB_in_descriptor_document.html"><strong>UB</strong> : Save and Restore Crystal Orientation</a></li>



<li class="toctree-l2"><a class="reference internal" href="tst_UB_in_stream.html">WIP: save reflection information in stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="tst_e4cv_fourc.html">Compare E4CV 4-circle orientation with SPEC fourc</a></li>
<li class="toctree-l2"><a class="reference internal" href="tst_e6c_test_calculations.html">Non-exhaustive test of E6C calculations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../variations.html">Variations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="var_e4cv_renamed_axes.html">Rename the axes of a 4-circle diffractometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="var_engines.html">Use <code class="docutils literal notranslate"><span class="pre">E4CV</span></code>’s <span class="math notranslate nohighlight">\(Q\)</span> calculation engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="var_nslsii_tardis.html">NSLS-II TARDIS Configuration</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../constraints.html">Constraints</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../user_guide.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="../howto.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Sample...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Sample-orientation:-export-&amp;-restore-diffractometer-configuration">
<h1>Sample orientation: export &amp; restore diffractometer configuration<a class="headerlink" href="#Sample-orientation:-export-&-restore-diffractometer-configuration" title="Link to this heading">#</a></h1>
<p>A common user request is to preserve the orientation (<strong>UB</strong>) matrix and related terms used to compute it. Terms such as the list of orientation reflections, samples, and diffractometer geometry from their current session. The configuration should be saved somewhere so it is available, even after bluesky stops. Multiple sessions could (optionally) access the same configuration or use a different one.</p>
<p>It is a local choice how and where to save this configuration. The first step is to define a common structure to be exported and restored by <em>hklpy</em>. The structure would be stored in any of a variety of possibilities (some of these are provided by <em>hklpy</em>, the others are suggestions).</p>
<ul class="simple">
<li><p>text file: stored in:</p>
<ul>
<li><p>the local file directory</p></li>
<li><p>some other directory</p></li>
<li><p>network storage</p></li>
</ul>
</li>
<li><p>NeXus HDF5 file: stored in the <code class="docutils literal notranslate"><span class="pre">pwd</span></code> or elsewhere</p></li>
<li><p>EPICS <a class="reference external" href="https://epics-controls.org/resources-and-support/documents/ca/">Channel Access</a> string <a class="reference external" href="https://epics.anl.gov/base/R7-0/3-docs/waveformRecord.html">waveform</a> record</p></li>
<li><p>EPICS <a class="reference external" href="https://epics-controls.org/resources-and-support/documents/pvaccess/">pvAccess</a> structure</p></li>
<li><p>in-memory cache, such as:</p>
<ul>
<li><p><a class="reference external" href="https://redis.io">redis</a></p></li>
</ul>
</li>
<li><p>database, such as:</p>
<ul>
<li><p><a class="reference external" href="https://mysql.com">MySQL</a></p></li>
<li><p><a class="reference external" href="https://sqlite.org">SQLite</a></p></li>
</ul>
</li>
<li><p>Python object: (such as used in this documentation)</p>
<ul>
<li><p>dictionary</p></li>
<li><p>JSON string</p></li>
<li><p>YAML string</p></li>
</ul>
</li>
</ul>
<p>A session could restore the configuration automatically from the chosen storage. Later, the session would export the configuration both automatically, and to a different location at the choice of the user.</p>
<p><strong>Objective</strong></p>
<p>Show how to export diffractometer configuration to a file and later restore it. Demonstrate with a 4-circle diffractometer (E4CV geometry).</p>
<section id="Setup-a-(simulated)-4-circle-diffractometer">
<h2>Setup a (simulated) 4-circle diffractometer<a class="headerlink" href="#Setup-a-(simulated)-4-circle-diffractometer" title="Link to this heading">#</a></h2>
<p>Load the support for a 4-circle diffractometer using the <em>E4CV</em> geometry. Since this is a simulation, we do not need an EPICS system with motors. The <a class="reference external" href="https://blueskyproject.io/hklpy/ready_to_use.html#simulatede4cv">SimulatedE4CV</a> structure (a Python class) provides all that is needed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">SimulatedE4CV</span>

<span class="n">sim4c</span> <span class="o">=</span> <span class="n">SimulatedE4CV</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sim4c&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Print all the details about this <code class="docutils literal notranslate"><span class="pre">sim4c</span></code> diffractometer we just created. Since this is a default configuration, no orientation reflections have been reported. The <strong>UB</strong> matrix is the default <span class="math notranslate nohighlight">\((2\pi/1.54)\)</span><strong>U</strong> where <strong>U</strong> is the identity matrix and 1.54 is the unit cell length. The geometry defines the names of the rotational axes <code class="docutils literal notranslate"><span class="pre">omega</span></code>, <code class="docutils literal notranslate"><span class="pre">chi</span></code>, <code class="docutils literal notranslate"><span class="pre">phi</span></code>, and <code class="docutils literal notranslate"><span class="pre">tth</span></code>. This is the canonical order. The <em>constraints</em> are applied when computing values for the rotational axes from
reciprocal space coordinates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim4c</span><span class="o">.</span><span class="n">pa</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
===================== ====================================================================
term                  value
===================== ====================================================================
diffractometer        sim4c
geometry              E4CV
class                 SimulatedE4CV
energy (keV)          8.05092
wavelength (angstrom) 1.54000
calc engine           hkl
mode                  bissector
positions             ===== =======
                      name  value
                      ===== =======
                      omega 0.00000
                      chi   0.00000
                      phi   0.00000
                      tth   0.00000
                      ===== =======
constraints           ===== ========= ========== ===== ====
                      axis  low_limit high_limit value fit
                      ===== ========= ========== ===== ====
                      omega -180.0    180.0      0.0   True
                      chi   -180.0    180.0      0.0   True
                      phi   -180.0    180.0      0.0   True
                      tth   -180.0    180.0      0.0   True
                      ===== ========= ========== ===== ====
sample: main          ================ ===================================================
                      term             value
                      ================ ===================================================
                      unit cell edges  a=1.54, b=1.54, c=1.54
                      unit cell angles alpha=90.0, beta=90.0, gamma=90.0
                      [U]              [[1. 0. 0.]
                                        [0. 1. 0.]
                                        [0. 0. 1.]]
                      [UB]             [[ 4.07999046e+00 -2.49827363e-16 -2.49827363e-16]
                                        [ 0.00000000e+00  4.07999046e+00 -2.49827363e-16]
                                        [ 0.00000000e+00  0.00000000e+00  4.07999046e+00]]
                      ================ ===================================================
===================== ====================================================================

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;pyRestTable.rest_table.Table at 0x7f3b75440750&gt;
</pre></div></div>
</div>
</section>
<section id="What-is-described-in-a-diffractometer-configuration?">
<h2>What is described in a diffractometer configuration?<a class="headerlink" href="#What-is-described-in-a-diffractometer-configuration?" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">hkl.DiffractometerConfiguration</span></code> structure is used for export and restore. To show what an export contains (for this default diffractometer), we make a Python object specifically for the <code class="docutils literal notranslate"><span class="pre">sim4c</span></code> diffractometer. In this example, the object is called <code class="docutils literal notranslate"><span class="pre">agent</span></code> (you could pick some other name, such as <code class="docutils literal notranslate"><span class="pre">config</span></code>).</p>
<p>Create <code class="docutils literal notranslate"><span class="pre">agent</span></code> specifically for the <code class="docutils literal notranslate"><span class="pre">sim4c</span></code> diffractometer to provide the methods in the next table.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Python</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">agent.export()</span></code></p></td>
<td><p>describe a diffractometer’s configuration</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">agent.preview()</span></code></p></td>
<td><p>preview a saved configuration</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">agent.restore()</span></code></p></td>
<td><p>set a diffractometer’s configuration</p></td>
</tr>
</tbody>
</table>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">DiffractometerConfiguration</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">DiffractometerConfiguration</span><span class="p">(</span><span class="n">sim4c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Export">
<h2>Export<a class="headerlink" href="#Export" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">export()</span></code> returns the current configuration of the diffractometer in any of several formats:</p>
<ul class="simple">
<li><p>JSON string (default)</p></li>
<li><p>YAML string</p></li>
<li><p>Python dictionary</p></li>
<li><p>file (as defined by a Python <em>pathlib</em> object)</p></li>
</ul>
<p>Note: Internally, the code uses the Python dictionary for the actual export and restore operations. The other formats derive from the Python dictionary. All information in the Python dictionary is first validated before it is restored to the diffractometer.</p>
<section id="Export:-JSON-string-(default)-format">
<h3>Export: JSON string (default) format<a class="headerlink" href="#Export:-JSON-string-(default)-format" title="Link to this heading">#</a></h3>
<p>Describe <code class="docutils literal notranslate"><span class="pre">sim4c</span></code> using <code class="docutils literal notranslate"><span class="pre">agent.export()</span></code>. The information content is similar to <code class="docutils literal notranslate"><span class="pre">sim4c.pa()</span></code>, but in a format convenient for both saving (to a file or other structure) and for restoring.</p>
<p>The default format is a <a class="reference external" href="https://json.org">JSON</a> string, formatted with line endings and indentation. (Alternatives include Python dictionary, <a class="reference external" href="https://yaml.org">YAML</a>, and file.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">export</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
  &#34;geometry&#34;: &#34;E4CV&#34;,
  &#34;engine&#34;: &#34;hkl&#34;,
  &#34;library&#34;: &#34;gi.repository.Hkl&#34;,
  &#34;mode&#34;: &#34;bissector&#34;,
  &#34;canonical_axes&#34;: [
    &#34;omega&#34;,
    &#34;chi&#34;,
    &#34;phi&#34;,
    &#34;tth&#34;
  ],
  &#34;real_axes&#34;: [
    &#34;omega&#34;,
    &#34;chi&#34;,
    &#34;phi&#34;,
    &#34;tth&#34;
  ],
  &#34;reciprocal_axes&#34;: [
    &#34;h&#34;,
    &#34;k&#34;,
    &#34;l&#34;
  ],
  &#34;constraints&#34;: {
    &#34;omega&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;chi&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;phi&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;tth&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    }
  },
  &#34;samples&#34;: {
    &#34;main&#34;: {
      &#34;name&#34;: &#34;main&#34;,
      &#34;lattice&#34;: {
        &#34;a&#34;: 1.54,
        &#34;b&#34;: 1.54,
        &#34;c&#34;: 1.54,
        &#34;alpha&#34;: 90.0,
        &#34;beta&#34;: 90.0,
        &#34;gamma&#34;: 90.0
      },
      &#34;reflections&#34;: [],
      &#34;UB&#34;: [
        [
          4.079990459207523,
          -2.4982736282101165e-16,
          -2.4982736282101165e-16
        ],
        [
          0.0,
          4.079990459207523,
          -2.4982736282101165e-16
        ],
        [
          0.0,
          0.0,
          4.079990459207523
        ]
      ],
      &#34;U&#34;: [
        [
          1.0,
          0.0,
          0.0
        ],
        [
          0.0,
          1.0,
          0.0
        ],
        [
          0.0,
          0.0,
          1.0
        ]
      ]
    }
  },
  &#34;name&#34;: &#34;sim4c&#34;,
  &#34;datetime&#34;: &#34;2023-11-16 12:48:44.500249&#34;,
  &#34;wavelength_angstrom&#34;: 1.54,
  &#34;energy_keV&#34;: 8.050921974025975,
  &#34;hklpy_version&#34;: &#34;1.0.5.dev207+g955ab4d&#34;,
  &#34;library_version&#34;: &#34;v5.0.0.3001&#34;,
  &#34;python_class&#34;: &#34;SimulatedE4CV&#34;,
  &#34;other&#34;: {}
}
</pre></div></div>
</div>
</section>
<section id="Export:-YAML-string-format">
<h3>Export: YAML string format<a class="headerlink" href="#Export:-YAML-string-format" title="Link to this heading">#</a></h3>
<p>View the same content in YAML format:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s2">&quot;yaml&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
geometry: E4CV
engine: hkl
library: gi.repository.Hkl
mode: bissector
canonical_axes:
- omega
- chi
- phi
- tth
real_axes:
- omega
- chi
- phi
- tth
reciprocal_axes:
- h
- k
- l
constraints:
  omega:
    low_limit: -180.0
    high_limit: 180.0
    value: 0.0
    fit: true
  chi:
    low_limit: -180.0
    high_limit: 180.0
    value: 0.0
    fit: true
  phi:
    low_limit: -180.0
    high_limit: 180.0
    value: 0.0
    fit: true
  tth:
    low_limit: -180.0
    high_limit: 180.0
    value: 0.0
    fit: true
samples:
  main:
    name: main
    lattice:
      a: 1.54
      b: 1.54
      c: 1.54
      alpha: 90.0
      beta: 90.0
      gamma: 90.0
    reflections: []
    UB:
    - - 4.079990459207523
      - -2.4982736282101165e-16
      - -2.4982736282101165e-16
    - - 0.0
      - 4.079990459207523
      - -2.4982736282101165e-16
    - - 0.0
      - 0.0
      - 4.079990459207523
    U:
    - - 1.0
      - 0.0
      - 0.0
    - - 0.0
      - 1.0
      - 0.0
    - - 0.0
      - 0.0
      - 1.0
name: sim4c
datetime: &#39;2023-11-16 12:48:44.571162&#39;
wavelength_angstrom: 1.54
energy_keV: 8.050921974025975
hklpy_version: 1.0.5.dev207+g955ab4d
library_version: v5.0.0.3001
python_class: SimulatedE4CV
other: {}

</pre></div></div>
</div>
</section>
<section id="Export:-Python-dictionary-format">
<h3>Export: Python dictionary format<a class="headerlink" href="#Export:-Python-dictionary-format" title="Link to this heading">#</a></h3>
<p>Or as Python dictionary:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;geometry&#39;: &#39;E4CV&#39;,
 &#39;engine&#39;: &#39;hkl&#39;,
 &#39;library&#39;: &#39;gi.repository.Hkl&#39;,
 &#39;mode&#39;: &#39;bissector&#39;,
 &#39;canonical_axes&#39;: [&#39;omega&#39;, &#39;chi&#39;, &#39;phi&#39;, &#39;tth&#39;],
 &#39;real_axes&#39;: [&#39;omega&#39;, &#39;chi&#39;, &#39;phi&#39;, &#39;tth&#39;],
 &#39;reciprocal_axes&#39;: [&#39;h&#39;, &#39;k&#39;, &#39;l&#39;],
 &#39;constraints&#39;: {&#39;omega&#39;: {&#39;low_limit&#39;: -180.0,
   &#39;high_limit&#39;: 180.0,
   &#39;value&#39;: 0.0,
   &#39;fit&#39;: True},
  &#39;chi&#39;: {&#39;low_limit&#39;: -180.0, &#39;high_limit&#39;: 180.0, &#39;value&#39;: 0.0, &#39;fit&#39;: True},
  &#39;phi&#39;: {&#39;low_limit&#39;: -180.0, &#39;high_limit&#39;: 180.0, &#39;value&#39;: 0.0, &#39;fit&#39;: True},
  &#39;tth&#39;: {&#39;low_limit&#39;: -180.0,
   &#39;high_limit&#39;: 180.0,
   &#39;value&#39;: 0.0,
   &#39;fit&#39;: True}},
 &#39;samples&#39;: {&#39;main&#39;: {&#39;name&#39;: &#39;main&#39;,
   &#39;lattice&#39;: {&#39;a&#39;: 1.54,
    &#39;b&#39;: 1.54,
    &#39;c&#39;: 1.54,
    &#39;alpha&#39;: 90.0,
    &#39;beta&#39;: 90.0,
    &#39;gamma&#39;: 90.0},
   &#39;reflections&#39;: [],
   &#39;UB&#39;: [[4.079990459207523,
     -2.4982736282101165e-16,
     -2.4982736282101165e-16],
    [0.0, 4.079990459207523, -2.4982736282101165e-16],
    [0.0, 0.0, 4.079990459207523]],
   &#39;U&#39;: [[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]]}},
 &#39;name&#39;: &#39;sim4c&#39;,
 &#39;datetime&#39;: &#39;2023-11-16 12:48:44.578586&#39;,
 &#39;wavelength_angstrom&#39;: 1.54,
 &#39;energy_keV&#39;: 8.050921974025975,
 &#39;hklpy_version&#39;: &#39;1.0.5.dev207+g955ab4d&#39;,
 &#39;library_version&#39;: &#39;v5.0.0.3001&#39;,
 &#39;python_class&#39;: &#39;SimulatedE4CV&#39;,
 &#39;other&#39;: {}}
</pre></div></div>
</div>
</section>
<section id="Export:-Data-file-(text)">
<h3>Export: Data file (text)<a class="headerlink" href="#Export:-Data-file-(text)" title="Link to this heading">#</a></h3>
<p>Or as a data file. To save as a data file, we need the name (and directory path) of that file. Could be a local file such as <code class="docutils literal notranslate"><span class="pre">sim4c-config.json</span></code> or a file in some other directory such as <code class="docutils literal notranslate"><span class="pre">~/.config/sim4c/autosave.json</span></code>. These are just ideas.</p>
<p>In any case, we describe the file name and path using Python’s <a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib</a> support package.</p>
<p>For this example, we’ll use files created just for this notebook in a temporary directory using Python’s <a class="reference external" href="https://docs.python.org/3/library/tempfile.html">tempfile</a> package. The entire directory will be deleted when the notebook exits. (The <code class="docutils literal notranslate"><span class="pre">iterdir()</span></code> method prints the directory’s contents. It’s empty at the start.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
<span class="n">config_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_path</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">config_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
config_path=PosixPath(&#39;/tmp/tmpvrwz9f7z&#39;)
list(config_path.iterdir())=[]
</pre></div></div>
</div>
<p>Export the configuration to file <code class="docutils literal notranslate"><span class="pre">sim4c.json</span></code> in the temporary directory. Show the file exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config_file</span> <span class="o">=</span> <span class="n">config_path</span> <span class="o">/</span> <span class="s2">&quot;sim4c.json&quot;</span>
<span class="n">agent</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">config_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
list(config_path.iterdir())=[PosixPath(&#39;/tmp/tmpvrwz9f7z/sim4c.json&#39;)]
</pre></div></div>
</div>
<p>Show the contents of the new configuration file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
  &#34;geometry&#34;: &#34;E4CV&#34;,
  &#34;engine&#34;: &#34;hkl&#34;,
  &#34;library&#34;: &#34;gi.repository.Hkl&#34;,
  &#34;mode&#34;: &#34;bissector&#34;,
  &#34;canonical_axes&#34;: [
    &#34;omega&#34;,
    &#34;chi&#34;,
    &#34;phi&#34;,
    &#34;tth&#34;
  ],
  &#34;real_axes&#34;: [
    &#34;omega&#34;,
    &#34;chi&#34;,
    &#34;phi&#34;,
    &#34;tth&#34;
  ],
  &#34;reciprocal_axes&#34;: [
    &#34;h&#34;,
    &#34;k&#34;,
    &#34;l&#34;
  ],
  &#34;constraints&#34;: {
    &#34;omega&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;chi&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;phi&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    },
    &#34;tth&#34;: {
      &#34;low_limit&#34;: -180.0,
      &#34;high_limit&#34;: 180.0,
      &#34;value&#34;: 0.0,
      &#34;fit&#34;: true
    }
  },
  &#34;samples&#34;: {
    &#34;main&#34;: {
      &#34;name&#34;: &#34;main&#34;,
      &#34;lattice&#34;: {
        &#34;a&#34;: 1.54,
        &#34;b&#34;: 1.54,
        &#34;c&#34;: 1.54,
        &#34;alpha&#34;: 90.0,
        &#34;beta&#34;: 90.0,
        &#34;gamma&#34;: 90.0
      },
      &#34;reflections&#34;: [],
      &#34;UB&#34;: [
        [
          4.079990459207523,
          -2.4982736282101165e-16,
          -2.4982736282101165e-16
        ],
        [
          0.0,
          4.079990459207523,
          -2.4982736282101165e-16
        ],
        [
          0.0,
          0.0,
          4.079990459207523
        ]
      ],
      &#34;U&#34;: [
        [
          1.0,
          0.0,
          0.0
        ],
        [
          0.0,
          1.0,
          0.0
        ],
        [
          0.0,
          0.0,
          1.0
        ]
      ]
    }
  },
  &#34;name&#34;: &#34;sim4c&#34;,
  &#34;datetime&#34;: &#34;2023-11-16 12:48:44.591289&#34;,
  &#34;wavelength_angstrom&#34;: 1.54,
  &#34;energy_keV&#34;: 8.050921974025975,
  &#34;hklpy_version&#34;: &#34;1.0.5.dev207+g955ab4d&#34;,
  &#34;library_version&#34;: &#34;v5.0.0.3001&#34;,
  &#34;python_class&#34;: &#34;SimulatedE4CV&#34;,
  &#34;other&#34;: {}
}
</pre></div></div>
</div>
</section>
</section>
<section id="Preview-&amp;-Restore">
<h2>Preview &amp; Restore<a class="headerlink" href="#Preview-&-Restore" title="Link to this heading">#</a></h2>
<p>To demonstrate <code class="docutils literal notranslate"><span class="pre">agent.preview()</span></code> and <code class="docutils literal notranslate"><span class="pre">agent.restore()</span></code>, let’s compare the file we just wrote with a file found on the internet. The <em>hklpy</em> repository on GitHub has a <em>compatible</em> (same geometry, canonical motor names, and back-end computation library) file used for testing the <em>hklpy</em> source code.</p>
<p>We’ll use the <a class="reference external" href="https://docs.python-requests.org/">requests</a> package for the download. With <em>requests</em>, we can keep the structure in memory. (There is no need to save it to a local file.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/bluesky/hklpy/main/hkl/tests/data/e4c-config.json&quot;</span>
<span class="p">)</span>
<span class="n">test_e4c_config</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_e4c_config</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
test_e4c_config=&#39;{\n    &#34;geometry&#34;: &#34;E4CV&#34;,\n    &#34;engine&#34;: &#34;hkl&#34;,\n    &#34;library&#34;: &#34;gi.repository.Hkl&#34;,\n    &#34;mode&#34;: &#34;bissector&#34;,\n    &#34;canonical_axes&#34;: [\n        &#34;omega&#34;,\n        &#34;chi&#34;,\n        &#34;phi&#34;,\n        &#34;tth&#34;\n    ],\n    &#34;real_axes&#34;: [\n        &#34;omega&#34;,\n        &#34;chi&#34;,\n        &#34;phi&#34;,\n        &#34;tth&#34;\n    ],\n    &#34;reciprocal_axes&#34;: [\n        &#34;h&#34;,\n        &#34;k&#34;,\n        &#34;l&#34;\n    ],\n    &#34;constraints&#34;: {\n        &#34;omega&#34;: {\n            &#34;low_limit&#34;: -100.0,\n            &#34;high_limit&#34;: 100.0,\n            &#34;value&#34;: 0.0,\n            &#34;fit&#34;: true\n        },\n        &#34;chi&#34;: {\n            &#34;low_limit&#34;: -100.0,\n            &#34;high_limit&#34;: 100.0,\n            &#34;value&#34;: 0.0,\n            &#34;fit&#34;: true\n        },\n        &#34;phi&#34;: {\n            &#34;low_limit&#34;: -100.0,\n            &#34;high_limit&#34;: 100.0,\n            &#34;value&#34;: 0.0,\n            &#34;fit&#34;: true\n        },\n        &#34;tth&#34;: {\n            &#34;low_limit&#34;: -100.0,\n            &#34;high_limit&#34;: 100.0,\n            &#34;value&#34;: 0.0,\n            &#34;fit&#34;: true\n        }\n    },\n    &#34;samples&#34;: {\n        &#34;main&#34;: {\n            &#34;name&#34;: &#34;main&#34;,\n            &#34;lattice&#34;: {\n                &#34;a&#34;: 1.54,\n                &#34;b&#34;: 1.54,\n                &#34;c&#34;: 1.54,\n                &#34;alpha&#34;: 90.0,\n                &#34;beta&#34;: 90.0,\n                &#34;gamma&#34;: 90.0\n            },\n            &#34;reflections&#34;: [],\n            &#34;UB&#34;: [\n                [\n                    4.079990459207523,\n                    -2.4982736282101165e-16,\n                    -2.4982736282101165e-16\n                ],\n                [\n                    0.0,\n                    4.079990459207523,\n                    -2.4982736282101165e-16\n                ],\n                [\n                    0.0,\n                    0.0,\n                    4.079990459207523\n                ]\n            ],\n            &#34;U&#34;: [\n                [\n                    1.0,\n                    0.0,\n                    0.0\n                ],\n                [\n                    0.0,\n                    1.0,\n                    0.0\n                ],\n                [\n                    0.0,\n                    0.0,\n                    1.0\n                ]\n            ]\n        },\n        &#34;vibranium&#34;: {\n            &#34;name&#34;: &#34;vibranium&#34;,\n            &#34;lattice&#34;: {\n                &#34;a&#34;: 6.283185307179586,\n                &#34;b&#34;: 6.283185307179586,\n                &#34;c&#34;: 6.283185307179586,\n                &#34;alpha&#34;: 90.0,\n                &#34;beta&#34;: 90.0,\n                &#34;gamma&#34;: 90.0\n            },\n            &#34;reflections&#34;: [\n                {\n                    &#34;reflection&#34;: {\n                        &#34;h&#34;: 4.0,\n                        &#34;k&#34;: 0.0,\n                        &#34;l&#34;: 0.0\n                    },\n                    &#34;position&#34;: {\n                        &#34;omega&#34;: -145.451,\n                        &#34;chi&#34;: 0.0,\n                        &#34;phi&#34;: 0.0,\n                        &#34;tth&#34;: 69.0966\n                    },\n                    &#34;wavelength&#34;: 1.54,\n                    &#34;orientation_reflection&#34;: false,\n                    &#34;flag&#34;: 1\n                },\n                {\n                    &#34;reflection&#34;: {\n                        &#34;h&#34;: 0.0,\n                        &#34;k&#34;: 4.0,\n                        &#34;l&#34;: 0.0\n                    },\n                    &#34;position&#34;: {\n                        &#34;omega&#34;: -145.451,\n                        &#34;chi&#34;: 0.0,\n                        &#34;phi&#34;: 90.0,\n                        &#34;tth&#34;: 69.0966\n                    },\n                    &#34;wavelength&#34;: 1.54,\n                    &#34;orientation_reflection&#34;: true,\n                    &#34;flag&#34;: 1\n                },\n                {\n                    &#34;reflection&#34;: {\n                        &#34;h&#34;: 0.0,\n                        &#34;k&#34;: 0.0,\n                        &#34;l&#34;: 4.0\n                    },\n                    &#34;position&#34;: {\n                        &#34;omega&#34;: -145.451,\n                        &#34;chi&#34;: 90.0,\n                        &#34;phi&#34;: 0.0,\n                        &#34;tth&#34;: 69.0966\n                    },\n                    &#34;wavelength&#34;: 1.54,\n                    &#34;orientation_reflection&#34;: true,\n                    &#34;flag&#34;: 1\n                }\n            ],\n            &#34;UB&#34;: [\n                [\n                    1.2217304763701863e-05,\n                    -0.9999999999253688,\n                    -1.7623547209572502e-15\n                ],\n                [\n                    -1.4926257043558267e-10,\n                    -1.4349296274686127e-42,\n                    -1.0000000000000002\n                ],\n                [\n                    0.9999999999253688,\n                    1.221730476364063e-05,\n                    -1.492626316575311e-10\n                ]\n            ],\n            &#34;U&#34;: [\n                [\n                    1.2217304763701863e-05,\n                    -0.9999999999253688,\n                    -1.8235863128158895e-15\n                ],\n                [\n                    -1.4926257043558267e-10,\n                    -9.139696455822134e-27,\n                    -1.0000000000000002\n                ],\n                [\n                    0.9999999999253688,\n                    1.2217304763701863e-05,\n                    -1.4926257042444305e-10\n                ]\n            ]\n        }\n    },\n    &#34;name&#34;: &#34;e4c&#34;,\n    &#34;datetime&#34;: &#34;2023-11-01 16:40&#34;,\n    &#34;wavelength_angstrom&#34;: 1.54,\n    &#34;energy_keV&#34;: 8.050921974025975,\n    &#34;hklpy_version&#34;: &#34;1.0.5.dev122+g473f61f&#34;,\n    &#34;library_version&#34;: &#34;v5.0.0.3001&#34;,\n    &#34;python_class&#34;: &#34;SimulatedE4CV&#34;,\n    &#34;other&#34;: {}\n}\n&#39;
</pre></div></div>
</div>
<section id="Preview:-JSON-string">
<h3>Preview: JSON string<a class="headerlink" href="#Preview:-JSON-string" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">agent.preview(structure)</span></code> method shows the sample information (name, crystal lattice parameters, and number of orientation reflections) from the configuration <code class="docutils literal notranslate"><span class="pre">structure</span></code> object, without loading it into the diffractometer.</p>
<p><code class="docutils literal notranslate"><span class="pre">agent.preview()</span></code> works with these types of <code class="docutils literal notranslate"><span class="pre">structure</span></code>:</p>
<ul class="simple">
<li><p>JSON string</p></li>
<li><p>YAML string</p></li>
<li><p>Python dictionary</p></li>
<li><p>file (pathlib object)</p></li>
</ul>
<p>Here, <code class="docutils literal notranslate"><span class="pre">test_e4c_config</span></code> is recognized as a JSON string.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">test_e4c_config</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">preview</span><span class="p">(</span><span class="n">test_e4c_config</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;str&#39;&gt;
name: e4c
date: 2023-11-01 16:40
geometry: E4CV

Table of Samples
= ========= ========= ========= ========= ===== ==== ===== =====
# sample    a         b         c         alpha beta gamma #refl
= ========= ========= ========= ========= ===== ==== ===== =====
1 main      1.54      1.54      1.54      90.0  90.0 90.0  0
2 vibranium 6.2831853 6.2831853 6.2831853 90.0  90.0 90.0  3
= ========= ========= ========= ========= ===== ==== ===== =====

</pre></div></div>
</div>
<p>See that <code class="docutils literal notranslate"><span class="pre">test_e4c_config</span></code> has an additional sample: <code class="docutils literal notranslate"><span class="pre">vibranium</span></code> (looks cubic with a lattice constant <span class="math notranslate nohighlight">\(a_o=2\pi\)</span> which is right since <em>vibranium</em> is fictional). Three orientation reflections are provided. Next, show the additional details.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># options to show constraints and list of reflections</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">preview</span><span class="p">(</span><span class="n">test_e4c_config</span><span class="p">,</span> <span class="n">show_constraints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_reflections</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
name: e4c
date: 2023-11-01 16:40
geometry: E4CV

Table of Samples
= ========= ========= ========= ========= ===== ==== ===== =====
# sample    a         b         c         alpha beta gamma #refl
= ========= ========= ========= ========= ===== ==== ===== =====
1 main      1.54      1.54      1.54      90.0  90.0 90.0  0
2 vibranium 6.2831853 6.2831853 6.2831853 90.0  90.0 90.0  3
= ========= ========= ========= ========= ===== ==== ===== =====


Table of Reflections for Sample: vibranium
= === === === ======== ==== ==== ======= ========== =======
# h   k   l   omega    chi  phi  tth     wavelength orient?
= === === === ======== ==== ==== ======= ========== =======
1 4.0 0.0 0.0 -145.451 0.0  0.0  69.0966 1.54       False
2 0.0 4.0 0.0 -145.451 0.0  90.0 69.0966 1.54       True
3 0.0 0.0 4.0 -145.451 90.0 0.0  69.0966 1.54       True
= === === === ======== ==== ==== ======= ========== =======


Table of Axis Constraints
===== ========= ========== ===== ====
axis  low_limit high_limit value fit?
===== ========= ========== ===== ====
omega -100.0    100.0      0.0   True
chi   -100.0    100.0      0.0   True
phi   -100.0    100.0      0.0   True
tth   -100.0    100.0      0.0   True
===== ========= ========== ===== ====

</pre></div></div>
</div>
<p>Note that the high and low limits in the constraints are now <span class="math notranslate nohighlight">\(\pm100\)</span>. In the default, they were <span class="math notranslate nohighlight">\(\pm180\)</span>.</p>
</section>
<section id="Restore:-JSON-string">
<h3>Restore: JSON string<a class="headerlink" href="#Restore:-JSON-string" title="Link to this heading">#</a></h3>
<p>Let’s restore the <code class="docutils literal notranslate"><span class="pre">test_e4c_config</span></code> configuration to our <code class="docutils literal notranslate"><span class="pre">sim4c</span></code> diffractometer. This is possible because we have identical matches of the diffractometer and the configuration:</p>
<ul class="simple">
<li><p>name of geometry</p></li>
<li><p>name of computation engine</p></li>
<li><p>name of back-end support library</p></li>
<li><p>names and exact order of reciprocal-space axes</p></li>
<li><p>names and exact order of canonical real-space axes</p></li>
</ul>
<p>(Other validation steps are applied to make sure that the data in the configuration is specified correctly.)</p>
<p>Once restore is complete, print all the diffractometer settings, as before using <code class="docutils literal notranslate"><span class="pre">sim4c.pa()</span></code>.</p>
<p>Note: The <code class="docutils literal notranslate"><span class="pre">agent.restore()</span></code> method does not move any axes of the diffractometer. It only changes configuration settings in Python memory.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">test_e4c_config</span><span class="p">)</span>
<span class="n">sim4c</span><span class="o">.</span><span class="n">pa</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
===================== ===============================================================================
term                  value
===================== ===============================================================================
diffractometer        sim4c
geometry              E4CV
class                 SimulatedE4CV
energy (keV)          8.05092
wavelength (angstrom) 1.54000
calc engine           hkl
mode                  bissector
positions             ===== =======
                      name  value
                      ===== =======
                      omega 0.00000
                      chi   0.00000
                      phi   0.00000
                      tth   0.00000
                      ===== =======
constraints           ===== ========= ========== ===== ====
                      axis  low_limit high_limit value fit
                      ===== ========= ========== ===== ====
                      omega -100.0    100.0      0.0   True
                      chi   -100.0    100.0      0.0   True
                      phi   -100.0    100.0      0.0   True
                      tth   -100.0    100.0      0.0   True
                      ===== ========= ========== ===== ====
sample: vibranium     ================= =============================================================
                      term              value
                      ================= =============================================================
                      unit cell edges   a=6.283185307179586, b=6.283185307179586, c=6.283185307179586
                      unit cell angles  alpha=90.0, beta=90.0, gamma=90.0
                      ref 1 (hkl)       h=4.0, k=0.0, l=0.0
                      ref 1 positioners omega=-145.45100, chi=0.00000, phi=0.00000, tth=69.09660
                      ref 2 (hkl)       h=0.0, k=4.0, l=0.0
                      ref 2 positioners omega=-145.45100, chi=0.00000, phi=90.00000, tth=69.09660
                      ref 3 (hkl)       h=0.0, k=0.0, l=4.0
                      ref 3 positioners omega=-145.45100, chi=90.00000, phi=0.00000, tth=69.09660
                      [U]               [[ 1.22173048e-05 -1.00000000e+00 -1.82358631e-15]
                                         [-1.49262570e-10 -9.13969646e-27 -1.00000000e+00]
                                         [ 1.00000000e+00  1.22173048e-05 -1.49262570e-10]]
                      [UB]              [[ 1.22173048e-05 -1.00000000e+00 -1.76235472e-15]
                                         [-1.49262570e-10 -1.43492963e-42 -1.00000000e+00]
                                         [ 1.00000000e+00  1.22173048e-05 -1.49262632e-10]]
                      ================= =============================================================
===================== ===============================================================================

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;pyRestTable.rest_table.Table at 0x7f3b646bb910&gt;
</pre></div></div>
</div>
<p>Observe the list of three <em>vibranium</em> sample reflections. Two of them, as noted, have been used to compute the <strong>UB</strong> matrix.</p>
</section>
<section id="Restore:-file">
<h3>Restore: file<a class="headerlink" href="#Restore:-file" title="Link to this heading">#</a></h3>
<p>We can swap back to the default settings by restoring from the temporary configuration file we created above. This resets the constraints and removes the <em>vibranium</em> sample.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
<span class="n">sim4c</span><span class="o">.</span><span class="n">pa</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
===================== ====================================================================
term                  value
===================== ====================================================================
diffractometer        sim4c
geometry              E4CV
class                 SimulatedE4CV
energy (keV)          8.05092
wavelength (angstrom) 1.54000
calc engine           hkl
mode                  bissector
positions             ===== =======
                      name  value
                      ===== =======
                      omega 0.00000
                      chi   0.00000
                      phi   0.00000
                      tth   0.00000
                      ===== =======
constraints           ===== ========= ========== ===== ====
                      axis  low_limit high_limit value fit
                      ===== ========= ========== ===== ====
                      omega -180.0    180.0      0.0   True
                      chi   -180.0    180.0      0.0   True
                      phi   -180.0    180.0      0.0   True
                      tth   -180.0    180.0      0.0   True
                      ===== ========= ========== ===== ====
sample: main          ================ ===================================================
                      term             value
                      ================ ===================================================
                      unit cell edges  a=1.54, b=1.54, c=1.54
                      unit cell angles alpha=90.0, beta=90.0, gamma=90.0
                      [U]              [[1. 0. 0.]
                                        [0. 1. 0.]
                                        [0. 0. 1.]]
                      [UB]             [[ 4.07999046e+00 -2.49827363e-16 -2.49827363e-16]
                                        [ 0.00000000e+00  4.07999046e+00 -2.49827363e-16]
                                        [ 0.00000000e+00  0.00000000e+00  4.07999046e+00]]
                      ================ ===================================================
===================== ====================================================================

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;pyRestTable.rest_table.Table at 0x7f3b74433390&gt;
</pre></div></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="how_additional_parameters.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Diffractometer “Parameters”</p>
      </div>
    </a>
    <a class="right-next"
       href="how_extra_real_axis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How to add extra motors to a diffractometer class</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Setup-a-(simulated)-4-circle-diffractometer">Setup a (simulated) 4-circle diffractometer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#What-is-described-in-a-diffractometer-configuration?">What is described in a diffractometer configuration?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Export">Export</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Export:-JSON-string-(default)-format">Export: JSON string (default) format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Export:-YAML-string-format">Export: YAML string format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Export:-Python-dictionary-format">Export: Python dictionary format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Export:-Data-file-(text)">Export: Data file (text)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Preview-&amp;-Restore">Preview &amp; Restore</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Preview:-JSON-string">Preview: JSON string</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Restore:-JSON-string">Restore: JSON string</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Restore:-file">Restore: file</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/examples/notebooks/how_configuration.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2014-2023, Brookhaven National Laboratory.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>