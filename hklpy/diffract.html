
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Module: diffract &#8212; hklpy 1.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=625c1dfc"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Module: engine" href="engine.html" />
    <link rel="prev" title="Module: context" href="context.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">hklpy 1.1</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Install hklpy
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="ready_to_use.html">
                        Simulated Diffractometers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="examples/index.html">
                        Examples
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="constraints.html">
                        Constraints
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="release_notes.html">
                        Release History
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Install hklpy
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="api.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="ready_to_use.html">
                        Simulated Diffractometers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="examples/index.html">
                        Examples
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="constraints.html">
                        Constraints
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="release_notes.html">
                        Release History
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="calc.html">Module: <code class="docutils literal notranslate"><span class="pre">calc</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Module: <code class="docutils literal notranslate"><span class="pre">configuration</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="context.html">Module: <code class="docutils literal notranslate"><span class="pre">context</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Module: <code class="docutils literal notranslate"><span class="pre">diffract</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="engine.html">Module: <code class="docutils literal notranslate"><span class="pre">engine</span></code></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="geometries.html">Module: <code class="docutils literal notranslate"><span class="pre">geometries</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="geometry_tables.html">Tables of Diffractometer Geometry</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">Module: <code class="docutils literal notranslate"><span class="pre">sample</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="user.html">Module: <code class="docutils literal notranslate"><span class="pre">user</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Module: <code class="docutils literal notranslate"><span class="pre">util</span></code></a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="api.html" class="nav-link">API Reference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Module:...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="module-diffract">
<span id="diffract"></span><h1>Module: <code class="docutils literal notranslate"><span class="pre">diffract</span></code><a class="headerlink" href="#module-diffract" title="Link to this heading">#</a></h1>
<p>A local subclass of <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.diffract.Diffractometer</span></code></a> for the desired
diffractometer geometry must be created to define the reciprocal-space
axes and customize the EPICS PVs used for the motor axes.  Other
capabilities are also customized in a local subclass.</p>
<p>Examples are provided in the
<a class="reference internal" href="geometries.html#geometries-examples"><span class="std std-ref">Geometries Examples</span></a> section.</p>
<p>These are the diffractometer geometries provided by the <strong>libhkl</strong>
library <a class="footnote-reference brackets" href="#libhkl" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.E4CH" title="hkl.geometries.E4CH"><code class="xref py py-class docutils literal notranslate"><span class="pre">E4CH</span></code></a></p></td>
<td><p>Eulerian 4-circle, vertical scattering plane</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.E4CV" title="hkl.geometries.E4CV"><code class="xref py py-class docutils literal notranslate"><span class="pre">E4CV</span></code></a></p></td>
<td><p>Eulerian 4-circle, horizontal scattering plane</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.E6C" title="hkl.geometries.E6C"><code class="xref py py-class docutils literal notranslate"><span class="pre">E6C</span></code></a></p></td>
<td><p>Eulerian 6-circle</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.K4CV" title="hkl.geometries.K4CV"><code class="xref py py-class docutils literal notranslate"><span class="pre">K4CV</span></code></a></p></td>
<td><p>Kappa 4-circle, vertical scattering plane</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.K6C" title="hkl.geometries.K6C"><code class="xref py py-class docutils literal notranslate"><span class="pre">K6C</span></code></a></p></td>
<td><p>Kappa 6-circle</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="geometries.html#hkl.geometries.Zaxis" title="hkl.geometries.Zaxis"><code class="xref py py-class docutils literal notranslate"><span class="pre">Zaxis</span></code></a></p></td>
<td><p>Z-axis</p></td>
</tr>
</tbody>
</table>
<p>These special-use geometries are also provided by the <strong>libhkl</strong>
library <a class="footnote-reference brackets" href="#libhkl" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.Petra3_p09_eh2" title="hkl.geometries.Petra3_p09_eh2"><code class="xref py py-class docutils literal notranslate"><span class="pre">Petra3_p09_eh2</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilMars" title="hkl.geometries.SoleilMars"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilMars</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSiriusKappa" title="hkl.geometries.SoleilSiriusKappa"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSiriusKappa</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSiriusTurret" title="hkl.geometries.SoleilSiriusTurret"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSiriusTurret</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed1p2" title="hkl.geometries.SoleilSixsMed1p2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed1p2</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p2" title="hkl.geometries.SoleilSixsMed2p2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p2</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p3" title="hkl.geometries.SoleilSixsMed2p3"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p3</span></code></a></p></li>
<li><p><a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p3v2" title="hkl.geometries.SoleilSixsMed2p3v2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p3v2</span></code></a></p></li>
</ul>
<p>In all cases, see the <strong>libhkl</strong> documentation for further information
on these geometries.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="libhkl" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p><strong>libhkl</strong> documentation:
<a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html">https://people.debian.org/~picca/hkl/hkl.html</a></p>
</aside>
</aside>
<section id="energy">
<span id="diffract-energy"></span><h2>Energy<a class="headerlink" href="#energy" title="Link to this heading">#</a></h2>
<p>The monochromatic X-ray energy used by the diffractometer is defined as
an ophyd <code class="docutils literal notranslate"><span class="pre">Signal</span></code>.  The <code class="docutils literal notranslate"><span class="pre">.energy</span></code> signal may be used as-provided, as
a constant or the Component may be replaced by an <code class="docutils literal notranslate"><span class="pre">ophyd.EpicsSignal</span></code>
in a custom subclass of <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a>, to
connect with an EPICS PV from the instrument’s control system.  There is
no corresponding <code class="docutils literal notranslate"><span class="pre">.wavelength</span></code> signal at the diffractometer level.
The <code class="docutils literal notranslate"><span class="pre">.energy_offset</span></code> signal is used to allow for a difference between
the reported energy of <code class="docutils literal notranslate"><span class="pre">.energy</span></code> and the energy used for
diffractometer operations <code class="docutils literal notranslate"><span class="pre">.calc.energy</span></code>.</p>
<p>These are the terms:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>term</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.energy</span></code></p></td>
<td><p>nominal energy (such as value reported by control system)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.energy_offset</span></code></p></td>
<td><p>adjustment from nominal to calibrated energy for diffraction</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.energy_units</span></code></p></td>
<td><p>engineering units to be used for <code class="docutils literal notranslate"><span class="pre">.energy</span></code> and <code class="docutils literal notranslate"><span class="pre">.energy_offset</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.calc.energy</span></code></p></td>
<td><p>energy for diffraction (used to compute wavelength)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.calc.wavelength</span></code></p></td>
<td><p>used for diffraction calculations</p></td>
</tr>
</tbody>
</table>
<p>These are the relationships:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">in_keV</span><span class="p">(</span><span class="o">.</span><span class="n">energy</span> <span class="o">+</span> <span class="o">.</span><span class="n">energy_offset</span><span class="p">)</span>
<span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">keV</span> <span class="o">/</span> <span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">energy</span>
</pre></div>
</div>
<p>For use with other types of radiation (such as neutrons or electrons),
the conversion between energy and wavelength must be changed by editing
the energy and wavelength methods in the <a class="reference internal" href="calc.html#hkl.calc.CalcRecip" title="hkl.calc.CalcRecip"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.calc.CalcRecip</span></code></a>
class.</p>
<p>When the Diffractometer <code class="docutils literal notranslate"><span class="pre">.energy</span></code> signal is written (via
<code class="docutils literal notranslate"><span class="pre">.energy.put(value)</span></code> operation), the <code class="docutils literal notranslate"><span class="pre">.energy_offset</span></code> is added.
This result is converted to <code class="docutils literal notranslate"><span class="pre">keV</span></code> as required by the lower-level
<a class="reference internal" href="calc.html#module-hkl.calc" title="hkl.calc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hkl.calc</span></code></a> module, and then written to <code class="docutils literal notranslate"><span class="pre">.calc.energy</span></code> which in
turn writes the <code class="docutils literal notranslate"><span class="pre">.calc.wavelength</span></code> value. Likewise, when
<code class="docutils literal notranslate"><span class="pre">.energy.get()</span></code> reads the energy, it takes its value from
<code class="docutils literal notranslate"><span class="pre">.calc.energy</span></code>, converts into <code class="docutils literal notranslate"><span class="pre">.energy_units</span></code>, and then applies
<code class="docutils literal notranslate"><span class="pre">.energy_offset</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>How to set energy, offset, and units</p>
<p>To change energy, offset, &amp; units, do it in this order:</p>
<ul class="simple">
<li><p>First, set units and offset</p></li>
<li><p>Finally, set energy</p></li>
</ul>
<p>Example for a <code class="docutils literal notranslate"><span class="pre">e4cv</span></code> diffractometer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e4cv</span><span class="o">.</span><span class="n">energy_units</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;eV&quot;</span><span class="p">)</span>
<span class="n">e4cv</span><span class="o">.</span><span class="n">energy_offset</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">e4cv</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
<span class="c1"># now, e4cv.calc.energy = 8.0015 keV</span>
</pre></div>
</div>
</div>
</section>
<section id="engineering-units">
<span id="diffract-energy-units"></span><h2>Engineering Units<a class="headerlink" href="#engineering-units" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="geometries.html#module-hkl.geometries" title="hkl.geometries"><code class="xref py py-mod docutils literal notranslate"><span class="pre">geometries</span></code></a> module is the main user interface, providing
the various diffractometer geometries provided by <strong>libhkl</strong> as <em>ophyd</em>
<cite>PseudoPositioner</cite> Devices <a class="footnote-reference brackets" href="#id5" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.  Each of these geometries is built from
the base class <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a>, where a feature
has been added to allow the energy units to be set by the user.
Internally, <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a> will apply any
necessary units conversion when interacting with the values from the
<a class="reference internal" href="calc.html#module-hkl.calc" title="hkl.calc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">calc</span></code></a> module.</p>
<p>In the <a class="reference internal" href="calc.html#module-hkl.calc" title="hkl.calc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">calc</span></code></a> module (lower level than
<a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a>), the units for <em>energy</em> and
<em>wavelength</em> are <code class="docutils literal notranslate"><span class="pre">keV</span></code> and <code class="docutils literal notranslate"><span class="pre">angstrom</span></code>, respectively.  These
engineering units are not changeable by the user since the <strong>libhkl</strong> code
requires a consistent set of units (it does not anticipate the need to
do a units conversion).</p>
<p>The Python <em>pint</em> package <a class="footnote-reference brackets" href="#id6" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> is used to apply any unit conversion.</p>
<p>This table summarizes the units for the energy and wavelength terms
for all diffractometer geometries.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>diffractometer attribute</p></th>
<th class="head"><p>engineering units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.energy</span></code></p></td>
<td><p>set by value of <code class="docutils literal notranslate"><span class="pre">.energy_units</span></code> Signal</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.calc.energy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">keV</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.wavelength</span></code></p></td>
<td><p>does not exist in <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.calc.wavelength</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">angstrom</span></code></p></td>
</tr>
</tbody>
</table>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p><em>ophyd</em> <cite>PseudoPositioner</cite> Device:
<a class="reference external" href="https://blueskyproject.io/ophyd/positioners.html#pseudopositioner">https://blueskyproject.io/ophyd/positioners.html#pseudopositioner</a></p>
</aside>
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p><em>pint</em> (for engineering units conversion):
<a class="reference external" href="https://pint.readthedocs.io">https://pint.readthedocs.io</a></p>
</aside>
</aside>
</section>
<section id="control-system-energy">
<span id="diffract-energy-control-system"></span><h2>Control System Energy<a class="headerlink" href="#control-system-energy" title="Link to this heading">#</a></h2>
<p>One way to connect the control system energy is to replace the <code class="docutils literal notranslate"><span class="pre">energy</span></code>
attribute in the custom subclass of <a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.diffract.Diffractometer()</span></code></a>,
connecting it as either <code class="docutils literal notranslate"><span class="pre">ophyd.EpicsSignal</span></code>, <code class="docutils literal notranslate"><span class="pre">ophyd.EpicsSignalRO</span></code>, or
<code class="docutils literal notranslate"><span class="pre">ophyd.EpicsSignalWithRBV</span></code>.  In the next example, the monochromator energy,
engineering units, and offset are provided by EPICS.  Also, another EPICS PV
controls whether the energy of the diffractometer object should be updated by
changes in the EPICS energy.  Note that the
<a class="reference internal" href="#hkl.diffract.Diffractometer._energy_changed" title="hkl.diffract.Diffractometer._energy_changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_energy_changed()</span></code></a> method is already
subscribed to updates in the <code class="docutils literal notranslate"><span class="pre">energy</span></code> signal.  It is not necessary to do this
in the custom subclass.  Don’t forget to add the definitions for the real and
pseudo positioners.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Connecting control system energy to a 4-circle diffractometer.</span><a class="headerlink" href="#id8" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">E4CV</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsMotor</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">PseudoSingle</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="k">class</span> <span class="nc">LocalDiffractometer</span><span class="p">(</span><span class="n">E4CV</span><span class="p">):</span>
<span class="linenos">11</span>    <span class="n">h</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">12</span>    <span class="n">k</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="n">l</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="n">omega</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;EPICS:m1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">16</span>    <span class="n">chi</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;EPICS:m2&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="n">phi</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;EPICS:m3&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="n">tth</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;EPICS:m4&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="n">energy</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s2">&quot;EPICS:energy&quot;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">energy_units</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s2">&quot;EPICS:energy.EGU&quot;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">energy_offset</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s2">&quot;EPICS:energy:offset&quot;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">energy_update_calc_flag</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s2">&quot;EPICS:energy:lock&quot;</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="n">fourc</span> <span class="o">=</span> <span class="n">LocalDiffractometer</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fourc&quot;</span><span class="p">)</span>
<span class="linenos">26</span><span class="n">fourc</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
<span class="linenos">27</span><span class="n">fourc</span><span class="o">.</span><span class="n">_energy_changed</span><span class="p">()</span>  <span class="c1"># force the callback to update</span>
</pre></div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="module-hkl.diffract">
<span id="source-code-documentation"></span><h2>Source code documentation<a class="headerlink" href="#module-hkl.diffract" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>diffract<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>Common Support for diffractometers</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Diffractometer</span></code></a>(prefix[, calc_kw, ...])</p></td>
<td><p>Diffractometer pseudopositioner</p></td>
</tr>
</tbody>
</table>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hkl.diffract.</span></span><span class="sig-name descname"><span class="pre">Diffractometer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calc_kw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decision_fcn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calc_inst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hkl'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">configuration_attrs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_attrs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer" title="Link to this definition">#</a></dt>
<dd><p>Diffractometer pseudopositioner</p>
<p>PUBLIC API</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.calc" title="hkl.diffract.Diffractometer.calc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc</span></code></a></p></td>
<td><p>The calculation instance</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.engine" title="hkl.diffract.Diffractometer.engine"><code class="xref py py-obj docutils literal notranslate"><span class="pre">engine</span></code></a></p></td>
<td><p>The calculation engine associated with the diffractometer</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.forward" title="hkl.diffract.Diffractometer.forward"><code class="xref py py-obj docutils literal notranslate"><span class="pre">forward</span></code></a>(pseudo)</p></td>
<td><p>Calculate the real positions given the pseudo positions (hkl -&gt; angles).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.inverse" title="hkl.diffract.Diffractometer.inverse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">inverse</span></code></a>(real)</p></td>
<td><p>Calculate the pseudo positions given the real positions (angles -&gt; hkl).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.forward_solutions_table" title="hkl.diffract.Diffractometer.forward_solutions_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">forward_solutions_table</span></code></a>(reflections[, full, ...])</p></td>
<td><p>Return table of computed solutions for each supplied (hkl) reflection.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.apply_constraints" title="hkl.diffract.Diffractometer.apply_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply_constraints</span></code></a>(constraints)</p></td>
<td><p>Constrain the solutions of the diffractometer's forward() computation.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.get_axis_constraints" title="hkl.diffract.Diffractometer.get_axis_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_axis_constraints</span></code></a>(axis)</p></td>
<td><p>Show the constraints for one axis.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.reset_constraints" title="hkl.diffract.Diffractometer.reset_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reset_constraints</span></code></a>()</p></td>
<td><p>Set constraints back to initial settings.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.show_constraints" title="hkl.diffract.Diffractometer.show_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">show_constraints</span></code></a>([fmt, printing])</p></td>
<td><p>Print the current constraints in a table.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.undo_last_constraints" title="hkl.diffract.Diffractometer.undo_last_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">undo_last_constraints</span></code></a>()</p></td>
<td><p>Remove the current constraints additions, restore previous.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.pa" title="hkl.diffract.Diffractometer.pa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pa</span></code></a>([all_samples, printing])</p></td>
<td><p>Report (all) the diffractometer settings.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.wh" title="hkl.diffract.Diffractometer.wh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">wh</span></code></a>([printing])</p></td>
<td><p>Report (brief) where is the diffractometer.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer.geometry_table" title="hkl.diffract.Diffractometer.geometry_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">geometry_table</span></code></a>()</p></td>
<td><p>Print a table describing this diffractometer geometry.</p></td>
</tr>
</tbody>
</table>
<p>PRIVATE API</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._calc_energy_update_permitted" title="hkl.diffract.Diffractometer._calc_energy_update_permitted"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_calc_energy_update_permitted</span></code></a></p></td>
<td><p>return boolean <cite>True</cite> if permitted</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._constraints_dict" title="hkl.diffract.Diffractometer._constraints_dict"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_constraints_dict</span></code></a></p></td>
<td><p>Return the constraints.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._constraints_for_databroker" title="hkl.diffract.Diffractometer._constraints_for_databroker"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_constraints_for_databroker</span></code></a></p></td>
<td><p>Return the constraints for databroker.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._energy_changed" title="hkl.diffract.Diffractometer._energy_changed"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_energy_changed</span></code></a>([value])</p></td>
<td><p>Callback indicating that the energy signal was updated</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._energy_offset_changed" title="hkl.diffract.Diffractometer._energy_offset_changed"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_energy_offset_changed</span></code></a>([value])</p></td>
<td><p>Callback indicating that the energy offset signal was updated.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._energy_units_changed" title="hkl.diffract.Diffractometer._energy_units_changed"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_energy_units_changed</span></code></a>([value])</p></td>
<td><p>Callback indicating that the energy units signal was updated.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._push_current_constraints" title="hkl.diffract.Diffractometer._push_current_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_push_current_constraints</span></code></a>()</p></td>
<td><p>push current constraints onto the stack</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._set_constraints" title="hkl.diffract.Diffractometer._set_constraints"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_set_constraints</span></code></a>(constraints)</p></td>
<td><p>set diffractometer's constraints</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#hkl.diffract.Diffractometer._update_calc_energy" title="hkl.diffract.Diffractometer._update_calc_energy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_update_calc_energy</span></code></a>([value])</p></td>
<td><p>writes <code class="docutils literal notranslate"><span class="pre">self.calc.energy</span></code> from <code class="docutils literal notranslate"><span class="pre">value</span></code> or <code class="docutils literal notranslate"><span class="pre">self.energy</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>A Diffractometer has a corresponding calculation engine from <strong>hklpy</strong> that does
forward and inverse calculations.</p>
<p>If instantiating a specific diffractometer class such as <cite>E4C</cite>, <cite>E6C</cite>,
neither the <cite>calc_inst</cite> or the <cite>calc_kw</cite> parameters are required.</p>
<p>However, there is the option to either pass in a calculation
instance (with <cite>calc_inst</cite>) or keywords for the default calculation
class (using <cite>calc_kw</cite>) to instantiate a new one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – PV prefix for all components</p></li>
<li><p><strong>calc_kw</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a><em>, </em><em>optional</em>) – Initializer arguments for the calc class</p></li>
<li><p><strong>decision_fcn</strong> (<em>callable</em><em>, </em><em>optional</em>) – The decision function to use when multiple solutions exist for a given
forward calculation. Defaults to arbitrarily picking the first
solution.</p></li>
<li><p><strong>engine</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a><em>, </em><em>optional</em>) – Calculation engine name.  Default: <code class="docutils literal notranslate"><span class="pre">hkl</span></code></p></li>
<li><p><strong>read_attrs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em>, </em><em>optional</em>) – Read attributes default to all pseudo and real positioners</p></li>
<li><p><strong>configuration_attrs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em>, </em><em>optional</em>) – Defaults to the UB matrix and energy</p></li>
<li><p><strong>parent</strong> (<em>Device</em><em>, </em><em>optional</em>) – Parent device</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a><em>, </em><em>optional</em>) – Device name</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.calc_class">
<span class="sig-name descname"><span class="pre">calc_class</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer.calc_class" title="Link to this definition">#</a></dt>
<dd><p>Reciprocal calculation class used with this diffractometer. If <code class="docutils literal notranslate"><span class="pre">None</span></code>
(as used in <cite>hkl.diffract.Diffractometer</cite>), <cite>calc_inst</cite> must be
specified upon initialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>sub-class of <a class="reference internal" href="calc.html#hkl.calc.CalcRecip" title="hkl.calc.CalcRecip">CalcRecip</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.max_forward_iterations">
<span class="sig-name descname"><span class="pre">max_forward_iterations</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer.max_forward_iterations" title="Link to this definition">#</a></dt>
<dd><p>Maximum allowed number of iterations in the <code class="docutils literal notranslate"><span class="pre">forward()</span></code>
method before failing to find a forward() solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">ophyd.Signal</span></code> (default value: 100)</p>
</dd>
</dl>
</dd></dl>

<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="geometries.html#hkl.geometries.E4CH" title="hkl.geometries.E4CH"><code class="xref py py-class docutils literal notranslate"><span class="pre">E4CH</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.E4CV" title="hkl.geometries.E4CV"><code class="xref py py-class docutils literal notranslate"><span class="pre">E4CV</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.E6C" title="hkl.geometries.E6C"><code class="xref py py-class docutils literal notranslate"><span class="pre">E6C</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.K4CV" title="hkl.geometries.K4CV"><code class="xref py py-class docutils literal notranslate"><span class="pre">K4CV</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.K6C" title="hkl.geometries.K6C"><code class="xref py py-class docutils literal notranslate"><span class="pre">K6C</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.Petra3_p09_eh2" title="hkl.geometries.Petra3_p09_eh2"><code class="xref py py-class docutils literal notranslate"><span class="pre">Petra3_p09_eh2</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.Petra3_p23_4c" title="hkl.geometries.Petra3_p23_4c"><code class="xref py py-class docutils literal notranslate"><span class="pre">Petra3_p23_4c</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.Petra3_p23_6c" title="hkl.geometries.Petra3_p23_6c"><code class="xref py py-class docutils literal notranslate"><span class="pre">Petra3_p23_6c</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilMars" title="hkl.geometries.SoleilMars"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilMars</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilNanoscopiumRobot" title="hkl.geometries.SoleilNanoscopiumRobot"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilNanoscopiumRobot</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSiriusKappa" title="hkl.geometries.SoleilSiriusKappa"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSiriusKappa</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSiriusTurret" title="hkl.geometries.SoleilSiriusTurret"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSiriusTurret</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed1p2" title="hkl.geometries.SoleilSixsMed1p2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed1p2</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p2" title="hkl.geometries.SoleilSixsMed2p2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p2</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p3" title="hkl.geometries.SoleilSixsMed2p3"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p3</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.SoleilSixsMed2p3v2" title="hkl.geometries.SoleilSixsMed2p3v2"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoleilSixsMed2p3v2</span></code></a>, <a class="reference internal" href="geometries.html#hkl.geometries.Zaxis" title="hkl.geometries.Zaxis"><code class="xref py py-class docutils literal notranslate"><span class="pre">Zaxis</span></code></a></p>
</div>
<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._calc_energy_update_permitted">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_calc_energy_update_permitted</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer._calc_energy_update_permitted" title="Link to this definition">#</a></dt>
<dd><p>return boolean <cite>True</cite> if permitted</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._constraints_dict">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_constraints_dict</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer._constraints_dict" title="Link to this definition">#</a></dt>
<dd><p>Return the constraints.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._constraints_for_databroker">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_constraints_for_databroker</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer._constraints_for_databroker" title="Link to this definition">#</a></dt>
<dd><p>Return the constraints for databroker.</p>
<p>Cannot write a dictionary from bluesky because all values must
be of the same data type, chosen from the first item in the
list. Just write the values (the boolean will be written as a
float.) The constraints will be written in the order of the real
positioners.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._energy_changed">
<span class="sig-name descname"><span class="pre">_energy_changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._energy_changed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._energy_changed" title="Link to this definition">#</a></dt>
<dd><p>Callback indicating that the energy signal was updated</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>energy</cite> signal is subscribed to this method
in the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Diffractometer.__init__()</span></code> method.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._energy_offset_changed">
<span class="sig-name descname"><span class="pre">_energy_offset_changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._energy_offset_changed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._energy_offset_changed" title="Link to this definition">#</a></dt>
<dd><p>Callback indicating that the energy offset signal was updated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">energy_offset</span></code> signal is subscribed to this method
in the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Diffractometer.__init__()</span></code> method.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._energy_units_changed">
<span class="sig-name descname"><span class="pre">_energy_units_changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._energy_units_changed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._energy_units_changed" title="Link to this definition">#</a></dt>
<dd><p>Callback indicating that the energy units signal was updated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">energy_units</span></code> signal is subscribed to this method
in the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Diffractometer.__init__()</span></code> method.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._push_current_constraints">
<span class="sig-name descname"><span class="pre">_push_current_constraints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._push_current_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._push_current_constraints" title="Link to this definition">#</a></dt>
<dd><p>push current constraints onto the stack</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._reflections">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_reflections</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer._reflections" title="Link to this definition">#</a></dt>
<dd><p>Return the list of reflections as a [[float]]</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._set_constraints">
<span class="sig-name descname"><span class="pre">_set_constraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraints</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._set_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._set_constraints" title="Link to this definition">#</a></dt>
<dd><p>set diffractometer’s constraints</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer._update_calc_energy">
<span class="sig-name descname"><span class="pre">_update_calc_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer._update_calc_energy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer._update_calc_energy" title="Link to this definition">#</a></dt>
<dd><p>writes <code class="docutils literal notranslate"><span class="pre">self.calc.energy</span></code> from <code class="docutils literal notranslate"><span class="pre">value</span></code> or <code class="docutils literal notranslate"><span class="pre">self.energy</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.apply_constraints">
<span class="sig-name descname"><span class="pre">apply_constraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraints</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.apply_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.apply_constraints" title="Link to this definition">#</a></dt>
<dd><p>Constrain the solutions of the diffractometer’s forward() computation.</p>
<p>This action will first save the current constraints onto
a stack, enabling both <em>undo</em> and <em>reset</em> features.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.calc">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calc</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer.calc" title="Link to this definition">#</a></dt>
<dd><p>The calculation instance</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.check_value">
<span class="sig-name descname"><span class="pre">check_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.check_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.check_value" title="Link to this definition">#</a></dt>
<dd><p>Raise exception if pos is not within limits.</p>
<p>In a scan, a subset of the pseudo axes may be directed,
which are given in a dict from a set message from the
bluesky RunEngine.</p>
<p>It is not permitted to scan both pseudo and real positioners.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.engine">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">engine</span></span><a class="headerlink" href="#hkl.diffract.Diffractometer.engine" title="Link to this definition">#</a></dt>
<dd><p>The calculation engine associated with the diffractometer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pseudo</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.forward" title="Link to this definition">#</a></dt>
<dd><p>Calculate the real positions given the pseudo positions (hkl -&gt; angles).</p>
<p>Return the default solution using the <code class="docutils literal notranslate"><span class="pre">_decision_fcn()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.forward_solutions_table">
<span class="sig-name descname"><span class="pre">forward_solutions_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">digits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.forward_solutions_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.forward_solutions_table" title="Link to this definition">#</a></dt>
<dd><p>Return table of computed solutions for each supplied (hkl) reflection.</p>
<p>The solutions are calculated using the current UB matrix &amp; constraints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reflections</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em> of </em><em>(</em><em>h</em><em>, </em><em>k</em><em>, </em><em>l</em><em>) </em><em>reflections</em>) – Each reflection is a tuple of 3 numbers,
(h, k, l) of the reflection.</p></li>
<li><p><strong>full</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, show all solutions.  If <code class="docutils literal notranslate"><span class="pre">False</span></code>,
only show the default solution.</p></li>
<li><p><strong>digits</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Number of digits to roundoff each position
value.  Default is 5.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.geometry_table">
<span class="sig-name descname"><span class="pre">geometry_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.geometry_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.geometry_table" title="Link to this definition">#</a></dt>
<dd><p>Print a table describing this diffractometer geometry.</p>
<p>Calls <a class="reference internal" href="calc.html#hkl.calc.CalcRecip.geometry_table" title="hkl.calc.CalcRecip.geometry_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hkl.calc.CalcRecip.geometry_table()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.get_axis_constraints">
<span class="sig-name descname"><span class="pre">get_axis_constraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.get_axis_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.get_axis_constraints" title="Link to this definition">#</a></dt>
<dd><p>Show the constraints for one axis.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.inverse">
<span class="sig-name descname"><span class="pre">inverse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">real</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.inverse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.inverse" title="Link to this definition">#</a></dt>
<dd><p>Calculate the pseudo positions given the real positions (angles -&gt; hkl).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.pa">
<span class="sig-name descname"><span class="pre">pa</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">printing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.pa"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.pa" title="Link to this definition">#</a></dt>
<dd><p>Report (all) the diffractometer settings.</p>
<p>EXAMPLE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">SimulatedK4CV</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">k4cv</span> <span class="o">=</span> <span class="n">SimulatedK4CV</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;k4cv&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">k4cv</span><span class="o">.</span><span class="n">pa</span><span class="p">()</span>  <span class="c1"># FIXME lines are too long to include in source code</span>
<span class="o">=====================</span> <span class="o">====================================================================</span>
<span class="n">term</span>                  <span class="n">value</span>
<span class="o">=====================</span> <span class="o">====================================================================</span>
<span class="n">diffractometer</span>        <span class="n">k4cv</span>
<span class="n">geometry</span>              <span class="n">K4CV</span>
<span class="k">class</span>                 <span class="nc">SimulatedK4CV</span>
<span class="n">energy</span> <span class="p">(</span><span class="n">keV</span><span class="p">)</span>          <span class="mf">8.05092</span>
<span class="n">wavelength</span> <span class="p">(</span><span class="n">angstrom</span><span class="p">)</span> <span class="mf">1.54000</span>
<span class="n">calc</span> <span class="n">engine</span>           <span class="n">hkl</span>
<span class="n">mode</span>                  <span class="n">bissector</span>
<span class="n">positions</span>             <span class="o">======</span> <span class="o">=======</span>
                    <span class="n">name</span>   <span class="n">value</span>
                    <span class="o">======</span> <span class="o">=======</span>
                    <span class="n">komega</span> <span class="mf">0.00000</span>
                    <span class="n">kappa</span>  <span class="mf">0.00000</span>
                    <span class="n">kphi</span>   <span class="mf">0.00000</span>
                    <span class="n">tth</span>    <span class="mf">0.00000</span>
                    <span class="o">======</span> <span class="o">=======</span>
<span class="n">sample</span><span class="p">:</span> <span class="n">main</span>          <span class="o">================</span> <span class="o">===================================================</span>
                    <span class="n">term</span>             <span class="n">value</span>
                    <span class="o">================</span> <span class="o">===================================================</span>
                    <span class="n">unit</span> <span class="n">cell</span> <span class="n">edges</span>  <span class="n">a</span><span class="o">=</span><span class="mf">1.54</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.54</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.54</span>
                    <span class="n">unit</span> <span class="n">cell</span> <span class="n">angles</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span>
                    <span class="p">[</span><span class="n">U</span><span class="p">]</span>              <span class="p">[[</span><span class="mf">1.</span> <span class="mf">0.</span> <span class="mf">0.</span><span class="p">]</span>
                                        <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span> <span class="mf">0.</span><span class="p">]</span>
                                        <span class="p">[</span><span class="mf">0.</span> <span class="mf">0.</span> <span class="mf">1.</span><span class="p">]]</span>
                    <span class="p">[</span><span class="n">UB</span><span class="p">]</span>             <span class="p">[[</span> <span class="mf">4.07999046e+00</span> <span class="o">-</span><span class="mf">2.49827363e-16</span> <span class="o">-</span><span class="mf">2.49827363e-16</span><span class="p">]</span>
                                        <span class="p">[</span> <span class="mf">0.00000000e+00</span>  <span class="mf">4.07999046e+00</span> <span class="o">-</span><span class="mf">2.49827363e-16</span><span class="p">]</span>
                                        <span class="p">[</span> <span class="mf">0.00000000e+00</span>  <span class="mf">0.00000000e+00</span>  <span class="mf">4.07999046e+00</span><span class="p">]]</span>
                    <span class="o">================</span> <span class="o">===================================================</span>
<span class="o">=====================</span> <span class="o">====================================================================</span>

<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">pyRestTable</span><span class="o">.</span><span class="n">rest_table</span><span class="o">.</span><span class="n">Table</span> <span class="n">at</span> <span class="mh">0x7f5c16503e20</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.reset_constraints">
<span class="sig-name descname"><span class="pre">reset_constraints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.reset_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.reset_constraints" title="Link to this definition">#</a></dt>
<dd><p>Set constraints back to initial settings.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.show_constraints">
<span class="sig-name descname"><span class="pre">show_constraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'simple'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">printing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.show_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.show_constraints" title="Link to this definition">#</a></dt>
<dd><p>Print the current constraints in a table.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.undo_last_constraints">
<span class="sig-name descname"><span class="pre">undo_last_constraints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.undo_last_constraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.undo_last_constraints" title="Link to this definition">#</a></dt>
<dd><p>Remove the current constraints additions, restore previous.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hkl.diffract.Diffractometer.wh">
<span class="sig-name descname"><span class="pre">wh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">printing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hkl/diffract.html#Diffractometer.wh"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hkl.diffract.Diffractometer.wh" title="Link to this definition">#</a></dt>
<dd><p>Report (brief) where is the diffractometer.</p>
<p>EXAMPLE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">SimulatedK4CV</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">k4cv</span> <span class="o">=</span> <span class="n">SimulatedK4CV</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;k4cv&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">k4cv</span><span class="o">.</span><span class="n">wh</span><span class="p">()</span>
<span class="o">=====================</span> <span class="o">=========</span> <span class="o">=========</span>
<span class="n">term</span>                  <span class="n">value</span>     <span class="n">axis_type</span>
<span class="o">=====================</span> <span class="o">=========</span> <span class="o">=========</span>
<span class="n">diffractometer</span>        <span class="n">k4cv</span>
<span class="n">sample</span> <span class="n">name</span>           <span class="n">main</span>
<span class="n">energy</span> <span class="p">(</span><span class="n">keV</span><span class="p">)</span>          <span class="mf">8.05092</span>
<span class="n">wavelength</span> <span class="p">(</span><span class="n">angstrom</span><span class="p">)</span> <span class="mf">1.54000</span>
<span class="n">calc</span> <span class="n">engine</span>           <span class="n">hkl</span>
<span class="n">mode</span>                  <span class="n">bissector</span>
<span class="n">h</span>                     <span class="mf">0.0</span>       <span class="n">pseudo</span>
<span class="n">k</span>                     <span class="mf">0.0</span>       <span class="n">pseudo</span>
<span class="n">l</span>                     <span class="mf">0.0</span>       <span class="n">pseudo</span>
<span class="n">komega</span>                <span class="mi">0</span>         <span class="n">real</span>
<span class="n">kappa</span>                 <span class="mi">0</span>         <span class="n">real</span>
<span class="n">kphi</span>                  <span class="mi">0</span>         <span class="n">real</span>
<span class="n">tth</span>                   <span class="mi">0</span>         <span class="n">real</span>
<span class="o">=====================</span> <span class="o">=========</span> <span class="o">=========</span>

<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">pyRestTable</span><span class="o">.</span><span class="n">rest_table</span><span class="o">.</span><span class="n">Table</span> <span class="n">at</span> <span class="mh">0x7f55c4775cd0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>compare with similar function in SPEC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1117.</span><span class="n">KAPPA</span><span class="o">&gt;</span> <span class="n">wh</span>
<span class="n">H</span> <span class="n">K</span> <span class="n">L</span> <span class="o">=</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mf">1.7345</span>
<span class="n">Alpha</span> <span class="o">=</span> <span class="mi">20</span>  <span class="n">Beta</span> <span class="o">=</span> <span class="mi">20</span>  <span class="n">Azimuth</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">32.952</span>  <span class="n">Lambda</span> <span class="o">=</span> <span class="mf">1.54</span>
<span class="n">Two</span> <span class="n">Theta</span>       <span class="n">Theta</span>         <span class="n">Chi</span>         <span class="n">Phi</span>     <span class="n">K_Theta</span>       <span class="n">Kappa</span>       <span class="n">K_Phi</span>
<span class="mf">40.000000</span>   <span class="mf">20.000000</span>   <span class="mf">90.000000</span>   <span class="mf">57.048500</span>   <span class="mf">77.044988</span>  <span class="mf">134.755995</span>  <span class="mf">114.093455</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="context.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Module: <code class="docutils literal notranslate"><span class="pre">context</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="engine.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Module: <code class="docutils literal notranslate"><span class="pre">engine</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy">Energy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#engineering-units">Engineering Units</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-system-energy">Control System Energy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-hkl.diffract">Source code documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">diffract</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer"><code class="docutils literal notranslate"><span class="pre">Diffractometer</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.calc_class"><code class="docutils literal notranslate"><span class="pre">Diffractometer.calc_class</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.max_forward_iterations"><code class="docutils literal notranslate"><span class="pre">Diffractometer.max_forward_iterations</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._calc_energy_update_permitted"><code class="docutils literal notranslate"><span class="pre">Diffractometer._calc_energy_update_permitted</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._constraints_dict"><code class="docutils literal notranslate"><span class="pre">Diffractometer._constraints_dict</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._constraints_for_databroker"><code class="docutils literal notranslate"><span class="pre">Diffractometer._constraints_for_databroker</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._energy_changed"><code class="docutils literal notranslate"><span class="pre">Diffractometer._energy_changed()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._energy_offset_changed"><code class="docutils literal notranslate"><span class="pre">Diffractometer._energy_offset_changed()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._energy_units_changed"><code class="docutils literal notranslate"><span class="pre">Diffractometer._energy_units_changed()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._push_current_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer._push_current_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._reflections"><code class="docutils literal notranslate"><span class="pre">Diffractometer._reflections</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._set_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer._set_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer._update_calc_energy"><code class="docutils literal notranslate"><span class="pre">Diffractometer._update_calc_energy()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.apply_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer.apply_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.calc"><code class="docutils literal notranslate"><span class="pre">Diffractometer.calc</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.check_value"><code class="docutils literal notranslate"><span class="pre">Diffractometer.check_value()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.engine"><code class="docutils literal notranslate"><span class="pre">Diffractometer.engine</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.forward"><code class="docutils literal notranslate"><span class="pre">Diffractometer.forward()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.forward_solutions_table"><code class="docutils literal notranslate"><span class="pre">Diffractometer.forward_solutions_table()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.geometry_table"><code class="docutils literal notranslate"><span class="pre">Diffractometer.geometry_table()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.get_axis_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer.get_axis_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.inverse"><code class="docutils literal notranslate"><span class="pre">Diffractometer.inverse()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.pa"><code class="docutils literal notranslate"><span class="pre">Diffractometer.pa()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.reset_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer.reset_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.show_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer.show_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.undo_last_constraints"><code class="docutils literal notranslate"><span class="pre">Diffractometer.undo_last_constraints()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hkl.diffract.Diffractometer.wh"><code class="docutils literal notranslate"><span class="pre">Diffractometer.wh()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/diffract.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2014-2023, Brookhaven National Laboratory.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>