

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caches &mdash; tiled 0.0.1.dev2371+g7edb96994 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=40b3cffc"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Access Control" href="access-control.html" />
    <link rel="prev" title="Case Study: Reading and Exporting a Specialized Format" href="specialized-formats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tiled
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/navigation.html">Navigate with the Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slicing.html">Load Slices of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Deliberate Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/login.html">Log into an Authenticated Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/serving-files.html">Serve a Directory of Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/writing.html">Writing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/streaming.html">Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simple-server.html">Simple Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/plotly-integration.html">Plot Data in Plotly Chart Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/zarr-integration.html">Serve Data as Zarr</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/authentication.html">Python Client Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/profiles.html">Use Profiles to streamline Python client setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/client-logger.html">Use Performance and Debug Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/docker.html">Run Tiled Server in a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/helm.html">Run Tiled Server from the Helm chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/configuration.html">Serve Data using Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/read-custom-formats.html">Serve Files with Custom Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/custom-export-formats.html">Add Custom Export Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/api-keys.html">Create and Use API Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/custom-clients.html">Custom Python Client Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/metrics.html">Prometheus Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/direct-client.html">Use Tiled in Python without an HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/tiled-authn-database.html">Set up a database for a scaled authenticated deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/register.html">Register Content in Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/retries.html">Control Retries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="standards.html">Standards Used by Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures.html">Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata and “Specs”</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="compression.html">Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="specialized-formats.html">Case Study: Reading and Exporting a Specialized Format</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Caches</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#client-side-http-response-cache">Client-side HTTP Response Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-side-resource-cache">Server-side Resource Cache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="access-control.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Catalog Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineage.html">How Tiled Fits into the Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-database.html">Storage Database</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/service.html">Service-side Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/http-api-overview.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/python-client.html">Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html">Authentication Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/scopes.html">Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/commandline.html">Command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/service-configuration.html">Service Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client-profiles.html">Client Profiles Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/min-versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tiled</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Caches</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/explanations/caching.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caches">
<h1>Caches<a class="headerlink" href="#caches" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Caching can make Tiled faster. Because, in general, caches make programs more
complex and harder to trace, Tiled was designed without any caching at first.
Caches were added with clear separation from the rest of Tiled and an easy
opt-out path.</p>
<p>Tiled has two kinds of caching:</p>
<ol class="arabic simple">
<li><p><strong>Client-side response cache.</strong> The Tiled Python client implements a standard
web cache, similar in both concept and implementation to a web browser’s cache.</p></li>
<li><p><strong>Server-side resource cache.</strong> The resource cache is used to cache file
handles and related system resources, to avoid rapidly opening, closing,
and reopening the same files while handling a burst of requests.</p></li>
</ol>
</section>
<section id="client-side-http-response-cache">
<span id="client-http-response-cache"></span><h2>Client-side HTTP Response Cache<a class="headerlink" href="#client-side-http-response-cache" title="Link to this heading"></a></h2>
<p>The client response cache is an LRU (Least Recently Used) response cache backed by a SQLite file.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tiled.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_uri</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># clear cache</span>
<span class="n">c</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">filepath</span>  <span class="c1"># locate SQLite file</span>

<span class="c1"># Customize the cache.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">tiled.client.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cache</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span>
    <span class="n">capacity</span><span class="o">=</span><span class="mi">500_000_000</span><span class="p">,</span>  <span class="c1"># bytes</span>
    <span class="n">max_item_size</span><span class="o">=</span><span class="mi">500_000</span><span class="p">,</span>  <span class="c1"># bytes</span>
    <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;path/to/my_cache.db&quot;</span><span class="p">,</span>
    <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="server-side-resource-cache">
<h2>Server-side Resource Cache<a class="headerlink" href="#server-side-resource-cache" title="Link to this heading"></a></h2>
<p>The “resource cache” is a TLRU (Time-aware Least Recently Used) cache. When
items are evicted from the cache, a hard reference is dropped, freeing the
resource to be closed by the garbage collector if there are no other extant
hard references. Items are evicted if:</p>
<ul class="simple">
<li><p>They have been in the cache for a <em>total</em> of more than a given time.
(Accessing an item does not reset this time.)</p></li>
<li><p>The cache is at capacity and this item is the least recently used item.</p></li>
</ul>
<p>It is not expected that users should need to tune this cache, except in
debugging scenarios. These environment variables may be set to tune
the cache parameters:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>TILED_RESOURCE_CACHE_MAX_SIZE<span class="w">  </span><span class="c1"># default 1024 items</span>
TILED_RESOURCE_CACHE_TTU<span class="w">  </span><span class="c1"># default 60. seconds</span>
</pre></div>
</div>
<p>The “size” is measured in cached items; that is, each item in the cache has
size 1.</p>
<p>To disable the resource cache, set:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">TILED_RESOURCE_CACHE_MAX_SIZE</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>It is also possible to register a custom cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cachetools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tiled.adapters.resource_cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_resource_cache</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">set_resource_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
</pre></div>
</div>
<p>Any object satisfying the <code class="docutils literal notranslate"><span class="pre">cachetools.Cache</span></code> interface is acceptable.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="specialized-formats.html" class="btn btn-neutral float-left" title="Case Study: Reading and Exporting a Specialized Format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="access-control.html" class="btn btn-neutral float-right" title="Access Control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bluesky Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>