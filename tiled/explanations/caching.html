<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caches &mdash; tiled 0.1.0a110.dev4+g8ae226b documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=92524bc8"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Access Control" href="access-control.html" />
    <link rel="prev" title="Case Study: Reading and Exporting a Specialized Format" href="specialized-formats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tiled
          </a>
              <div class="version">
                0.1.0a110.dev4+g8ae226b
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/navigation.html">Navigate with the Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slicing.html">Load Slices of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Deliberate Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/login.html">Log into an Authenticated Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/serving-files.html">Serve a Directory of Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/writing.html">Writing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/plotly-integration.html">Plot Data in Plotly Chart Studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/profiles.html">Use Profiles to streamline Python client setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/client-logger.html">Use Performance and Debug Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/docker.html">Run Tiled Server in a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/configuration.html">Serve Data using Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/read-custom-formats.html">Serve Files with Custom Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/custom-export-formats.html">Add Custom Export Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/api-keys.html">Create and Use API Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/custom-clients.html">Custom Python Client Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/metrics.html">Prometheus Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/direct-client.html">Use Tiled in Python without an HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/tune-caches.html">Tune Caches to Balance Speed and Memory Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/tiled-authn-database.html">Set up a database for a scaled authenticated deloyment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="standards.html">Standards Used by Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures.html">Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata and “Specs”</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="compression.html">Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="specialized-formats.html">Case Study: Reading and Exporting a Specialized Format</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Caches</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#client-side-http-response-cache">Client-side HTTP Response Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-side-object-cache">Server-side Object Cache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connection-to-dask">Connection to Dask</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="access-control.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineage.html">How Tiled Fits into the Ecosystem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/service.html">Service-side Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/http-api-overview.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/python-client.html">Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html">Authentication Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/scopes.html">Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/commandline.html">Command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/service-configuration.html">Service Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client-profiles.html">Client Profiles Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/min-versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tiled</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Caches</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/explanations/caching.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caches">
<h1>Caches<a class="headerlink" href="#caches" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Caching can make Tiled faster. Because, in general, caches make programs more
complex and harder to trace, Tiled was designed without any caching at first.
Caches were added with clear separation from the rest of Tiled and an easy
opt-out path.</p>
<p>Tiled has two kinds of caching:</p>
<ol class="arabic simple">
<li><p><strong>Client-side response cache.</strong> The Tiled Python client implements a standard
web cache, similar in both concept and implementation to a web browser’s cache.</p></li>
<li><p><strong>Service-side object cache.</strong> The <em>response</em> caches operate near the outer
edges of the application, stashing and retrieve HTTP response bytes. The
<em>object</em> cache is more deeply integrated into the application: it is
available for authors of Adapters to use for stashing any objects that may be
useful in expediting future work. These objects may serializable, such as chunks
of array data, or unserializable, such as file handles. Requests that ask for
overlapping but distinct slices of data or requests that ask for the same
data but in varied formats will not benefit from the <em>response</em> cache; they
will “miss”. The <em>object</em> cache, however, can slice and encode its cached
resources differently for different requests. The object cache will not provide
quite the same speed boost as a response cache, but it has a broader impact.</p></li>
</ol>
</section>
<section id="client-side-http-response-cache">
<span id="client-http-response-cache"></span><h2>Client-side HTTP Response Cache<a class="headerlink" href="#client-side-http-response-cache" title="Permalink to this heading">¶</a></h2>
<p>The client response cache is an LRU response cache backed by a SQLite file.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tiled.client</span> <span class="kn">import</span> <span class="n">from_uri</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># clear cache</span>
<span class="n">c</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">filepath</span>  <span class="c1"># locate SQLite file</span>

<span class="c1"># Customize the cache.</span>

<span class="kn">from</span> <span class="nn">tiled.client.cache</span> <span class="kn">import</span> <span class="n">Cache</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span>
    <span class="n">capacity</span><span class="o">=</span><span class="mi">500_000_000</span><span class="p">,</span>  <span class="c1"># bytes</span>
    <span class="n">max_item_size</span><span class="o">=</span><span class="mi">500_000</span><span class="p">,</span>  <span class="c1"># bytes</span>
    <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;path/to/my_cache.db&quot;</span><span class="p">,</span>
    <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="server-side-object-cache">
<h2>Server-side Object Cache<a class="headerlink" href="#server-side-object-cache" title="Permalink to this heading">¶</a></h2>
<p>TO DO</p>
<section id="connection-to-dask">
<h3>Connection to Dask<a class="headerlink" href="#connection-to-dask" title="Permalink to this heading">¶</a></h3>
<p>Dask provides an opt-in, experimental
<a class="reference external" href="https://docs.dask.org/en/latest/caching.html">opportunistic caching</a> mechanism.
It caches at the granularity of “tasks”, such as chunks of array or partitions
of dataframes.</p>
<p>Tiled’s object cache is generic—not exclusive to dask code paths—but it plugs
into dask in a similar way to make it easy for any Adapters that happen to use
dask to leverage Tiled’s object cache very simply, like this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tiled.server.object_cache</span> <span class="kn">import</span> <span class="n">get_object_cache</span>


<span class="k">with</span> <span class="n">get_object_cache</span><span class="p">()</span><span class="o">.</span><span class="n">dask_context</span><span class="p">:</span>
    <span class="c1"># Any tasks that happen to already be cached will be looked up</span>
    <span class="c1"># instead of computed here. Anything that _is_ computed here may</span>
    <span class="c1"># be cached, depending on its bytesize and its cost (how long it took to</span>
    <span class="c1"># compute).</span>
    <span class="n">dask_object</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<p>Items can be proactively cleared from the cache like so:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tiled.server.object_cache</span> <span class="kn">import</span> <span class="n">get_object_cache</span><span class="p">,</span> <span class="n">NO_CACHE</span>


<span class="n">cache</span> <span class="o">=</span> <span class="n">get_object_cache</span><span class="p">()</span>
<span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NO_CACHE</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">discard_dask</span><span class="p">(</span><span class="n">dask_object</span><span class="o">.</span><span class="n">__dask_keys__</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="specialized-formats.html" class="btn btn-neutral float-left" title="Case Study: Reading and Exporting a Specialized Format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="access-control.html" class="btn btn-neutral float-right" title="Access Control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bluesky Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>