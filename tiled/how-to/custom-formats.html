<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Support for a Custom Format &mdash; tiled 0.1.0a45.post4+g0341498 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Use Profiles to streamline Python client setup" href="profiles.html" />
    <link rel="prev" title="Serve Trees using Configuration Files" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> tiled
          </a>
              <div class="version">
                0.1.0a45.post4+g0341498
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/navigation.html">Navigate with the Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slicing.html">Load Slices of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/caching.html">Keep a Local Copy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Deliberate Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/login.html">Log into an Authenticated Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/serving-files.html">Serve a Directory of Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/plotly-integration.html">Plot Data in Plotly Chart Studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Serve Trees using Configuration Files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Add Support for a Custom Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#define-an-adapter">Define an Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#define-an-exporter">Define an exporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#register-the-exporter">Register the exporter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="profiles.html">Use Profiles to streamline Python client setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="direct-client.html">Use Tiled in Python without an HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="tune-caches.html">Tune Caches to Balance Speed and Memory Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Run Tiled using Docker</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/structures.html">Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/compression.html">Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/caching.html">Caching Design and Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/access-control.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/scaling-down.html">Scaling Tiled Down</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/lineage.html">How Tiled Fits into the Ecosystem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/service.html">Service-side Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/http-api-overview.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/python-client.html">Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html">Authentication Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html#configure-session-lifetime-parameters">Configure session lifetime parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/commandline.html">Command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/service-configuration.html">Service Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client-profiles.html">Client Profiles Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/design-documents/index.html">Design Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/min-versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tiled</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Add Support for a Custom Format</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how-to/custom-formats.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="add-support-for-a-custom-format">
<h1>Add Support for a Custom Format<a class="headerlink" href="#add-support-for-a-custom-format" title="Permalink to this headline">¶</a></h1>
<p>For a given “structure family” (e.g. <code class="docutils literal notranslate"><span class="pre">array</span></code>, <code class="docutils literal notranslate"><span class="pre">dataframe</span></code>) the Tiled server
can provide the data—in whole or in part—in a variety of formats.
See <a class="reference internal" href="../tutorials/export.html"><span class="doc">Deliberate Export</span></a> for a list of the formats supported out of the
box.</p>
<p>To teach Tiled to serve another format, first decide which structure family or
families are appropriate for this format. For example, it makes sense to export
a table an Excel spreadsheet, but it does not generally make sense to export an
N-dimensional array as an Excel spreadsheet. (If you do, you making specific
assumptions about the array.)</p>
<p>For this guide, we’ll take the example of
<a class="reference external" href="https://github.com/XraySpectroscopy/XAS-Data-Interchange/blob/master/specification/spec.md#example-xdi-file">XDI</a>,
which is a formalized text-based format for X-ray Spectroscopy data.
An example XDI file is reproduced below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># XDI/1.0 GSE/1.0</span>
<span class="c1"># Column.1: energy eV</span>
<span class="c1"># Column.2: i0</span>
<span class="c1"># Column.3: itrans</span>
<span class="c1"># Column.4: mutrans</span>
<span class="c1"># Element.edge: K</span>
<span class="c1"># Element.symbol: Cu</span>
<span class="c1"># Scan.edge_energy: 8980.0</span>
<span class="c1"># Mono.name: Si 111</span>
<span class="c1"># Mono.d_spacing: 3.13553</span>
<span class="c1"># Beamline.name: 13ID</span>
<span class="c1"># Beamline.collimation: none</span>
<span class="c1"># Beamline.focusing: yes</span>
<span class="c1"># Beamline.harmonic_rejection: rhodium-coated mirror</span>
<span class="c1"># Facility.name: APS</span>
<span class="c1"># Facility.energy: 7.00 GeV</span>
<span class="c1"># Facility.xray_source: APS Undulator A</span>
<span class="c1"># Scan.start_time: 2001-06-26T22:27:31</span>
<span class="c1"># Detector.I0: 10cm  N2</span>
<span class="c1"># Detector.I1: 10cm  N2</span>
<span class="c1"># Sample.name: Cu</span>
<span class="c1"># Sample.prep: Cu metal foil</span>
<span class="c1"># GSE.EXTRA:  config 1</span>
<span class="c1"># ///</span>
<span class="c1"># Cu foil Room Temperature</span>
<span class="c1"># measured at beamline 13-ID</span>
<span class="c1">#----</span>
<span class="c1"># energy i0 itrans mutrans</span>
  <span class="mf">8779.0</span>  <span class="mf">149013.7</span>  <span class="mf">550643.089065</span>  <span class="o">-</span><span class="mf">1.3070486</span>
  <span class="mf">8789.0</span>  <span class="mf">144864.7</span>  <span class="mf">531876.119084</span>  <span class="o">-</span><span class="mf">1.3006104</span>
  <span class="mf">8799.0</span>  <span class="mf">132978.7</span>  <span class="mf">489591.10592</span>  <span class="o">-</span><span class="mf">1.3033816</span>
  <span class="mf">8809.0</span>  <span class="mf">125444.7</span>  <span class="mf">463051.104096</span>  <span class="o">-</span><span class="mf">1.3059724</span>
  <span class="mf">8819.0</span>  <span class="mf">121324.7</span>  <span class="mf">449969.103983</span>  <span class="o">-</span><span class="mf">1.3107085</span>
  <span class="mf">8829.0</span>  <span class="mf">119447.7</span>  <span class="mf">444386.117562</span>  <span class="o">-</span><span class="mf">1.3138152</span>
  <span class="mf">8839.0</span>  <span class="mf">119100.7</span>  <span class="mf">440176.091039</span>  <span class="o">-</span><span class="mf">1.3072055</span>
  <span class="mf">8849.0</span>  <span class="mf">117707.7</span>  <span class="mf">440448.106567</span>  <span class="o">-</span><span class="mf">1.3195882</span>
  <span class="mf">8859.0</span>  <span class="mf">117754.7</span>  <span class="mf">442302.10637</span>  <span class="o">-</span><span class="mf">1.3233895</span>
  <span class="mf">8869.0</span>  <span class="mf">117428.7</span>  <span class="mf">441944.116528</span>  <span class="o">-</span><span class="mf">1.3253521</span>
  <span class="mf">8879.0</span>  <span class="mf">117383.7</span>  <span class="mf">442810.120466</span>  <span class="o">-</span><span class="mf">1.327693</span>
  <span class="mf">8889.0</span>  <span class="mf">117185.7</span>  <span class="mf">443658.11566</span>  <span class="o">-</span><span class="mf">1.3312944</span>
</pre></div>
</div>
<p>As you can see , the file’s contents comprise a single table
and a header of key–value pairs. Therefore, it makes sense to export <code class="docutils literal notranslate"><span class="pre">dataframe</span></code>
structures and their associated metadata into this format.</p>
<p>Consider a folder <code class="docutils literal notranslate"><span class="pre">data</span></code> containing a number of xdi files that we wish to serve using tiled.
An example folder containing a single <code class="docutils literal notranslate"><span class="pre">example.xdi</span></code> file can be generated by running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tiled.examples.xdi</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All code below is in <code class="docutils literal notranslate"><span class="pre">tiled/examples/xdi.py</span></code>.
The code is reproduced for reference but running the examples only requires modifying <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>.</p>
</div>
<section id="define-an-adapter">
<h2>Define an Adapter<a class="headerlink" href="#define-an-adapter" title="Permalink to this headline">¶</a></h2>
<p>The first step in exposing this data via tiled is to write a function which can
read xdi formatted files. It MUST accept a filepath (string) and it SHOULD
also accept a file buffer, which makes it easier to use in tests.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_xdi</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">metadata</span>
</pre></div>
</div>
<p>See the source code of <code class="docutils literal notranslate"><span class="pre">tiled.examples.xdi</span></code> for a fully-worked example.</p>
<p>In order to indicate that this data has some additional metadata structure
because it comes from an xdi file we subclass <code class="docutils literal notranslate"><span class="pre">DataFrameAdapter</span></code> and define the
<code class="docutils literal notranslate"><span class="pre">specs</span></code> attribute.  We also define a classmethod <code class="docutils literal notranslate"><span class="pre">from_file</span></code> which uses our
<code class="docutils literal notranslate"><span class="pre">read_xdi</span></code> function to construct an instance from a file.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">XDIDataFrameAdapter</span><span class="p">(</span><span class="n">DataFrameAdapter</span><span class="p">):</span>
    <span class="n">specs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xdi&quot;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">read_xdi</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
<p>Now take the following simple server configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># config.yml</span>
<span class="nt">trees</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
    <span class="nt">tree</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.trees.files:Tree.from_directory</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="nt">directory</span><span class="p">:</span> <span class="s">&quot;data&quot;</span>
      <span class="nt">mimetypes_by_file_ext</span><span class="p">:</span>
        <span class="nt">.xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/x-xdi</span>
      <span class="nt">readers_by_mimetype</span><span class="p">:</span>
        <span class="nt">application/x-xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.examples.xdi:XDIDataFrameAdapter.from_file</span>
</pre></div>
</div>
<p>and serve it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiled</span> <span class="n">serve</span> <span class="n">config</span> <span class="o">--</span><span class="n">public</span> <span class="n">config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>As is, we can access the data as CSV, for example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -H &#39;Accept: text/csv&#39; &#39;http://localhost:8000/dataframe/full/example&#39;
,energy,i0,itrans,mutrans
0,8779.0,149013.7,550643.089065,-1.3070486
1,8789.0,144864.7,531876.119084,-1.3006104
2,8799.0,132978.7,489591.10592,-1.3033816
3,8809.0,125444.7,463051.104096,-1.3059724
4,8819.0,121324.7,449969.103983,-1.3107085
5,8829.0,119447.7,444386.117562,-1.3138152
6,8839.0,119100.7,440176.091039,-1.3072055
7,8849.0,117707.7,440448.106567,-1.3195882
8,8859.0,117754.7,442302.10637,-1.3233895
9,8869.0,117428.7,441944.116528,-1.3253521
10,8879.0,117383.7,442810.120466,-1.327693
11,8889.0,117185.7,443658.11566,-1.3312944
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are three equivalent ways to request a format, more formally called a “media type” or a “MIME type”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. Use the standard [HTTP `Accept` Header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept).

```
$ curl -H &#39;Accept: text/csv&#39; &#39;http://localhost:8000/dataframe/full/example&#39;
```

2. Place the media type in a `format` query parameter.

```
$ curl &#39;http://localhost:8000/dataframe/full/example?format=text/csv&#39;
```

3. Provide just a file extension. This is user friendly for people who do not know or care what
a &quot;media type&quot; is. The server looks up `csv` in a registry mapping file extensions to media types.

```
$ curl &#39;http://localhost:8000/dataframe/full/example?format=csv&#39;
```
</pre></div>
</div>
</div>
</section>
<section id="define-an-exporter">
<h2>Define an exporter<a class="headerlink" href="#define-an-exporter" title="Permalink to this headline">¶</a></h2>
<p>When a client requests an XDI-formatted response, the Tiled server
will call our custom exporter with two arguments: the structure itself
(in this case, a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>) and a dictionary of metadata.
The metadata is freeform as far as Tiled is concerned—its content
and any internal structure is completely up to the user—so if we
have special requirements about what it must contain, we need to
do that validation inside our exporter. We might, for example,
refuse to export (raise an error) if required fields are missing
from the metadata or if the DataFrame we are given does not have the
expected columns.</p>
<p>The exporter must return either <code class="docutils literal notranslate"><span class="pre">str</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_xdi</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

    <span class="n">xdi_version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xdi_version&quot;</span><span class="p">)</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">extra_version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_version&quot;</span><span class="p">)</span>

    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# XDI/</span><span class="si">{</span><span class="n">xdi_version</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">extra_version</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">namespace_dict</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">namespace_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# /////////////</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# generated by tiled</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# -------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># write column labels</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># write data</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="register-the-exporter">
<h2>Register the exporter<a class="headerlink" href="#register-the-exporter" title="Permalink to this headline">¶</a></h2>
<p>Add new sections to the configuration as follows.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trees</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
    <span class="nt">tree</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.trees.files:Tree.from_directory</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="nt">directory</span><span class="p">:</span> <span class="s">&quot;data&quot;</span>
      <span class="nt">mimetypes_by_file_ext</span><span class="p">:</span>
        <span class="nt">.xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/x-xdi</span>
      <span class="nt">readers_by_mimetype</span><span class="p">:</span>
        <span class="nt">application/x-xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.examples.xdi:XDIDataFrameAdapter.from_file</span>

<span class="nt">media_types</span><span class="p">:</span>
  <span class="nt">xdi</span><span class="p">:</span>
    <span class="nt">application/x-xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.examples.xdi:write_xdi</span>
<span class="nt">file_extensions</span><span class="p">:</span>
  <span class="nt">xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/x-xdi</span>
</pre></div>
</div>
<p>First consider the section</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">media_types</span><span class="p">:</span>
  <span class="nt">xdi</span><span class="p">:</span>
    <span class="nt">application/x-xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiled.examples.xdi:write_xdi</span>
</pre></div>
</div>
<p>The key, <code class="docutils literal notranslate"><span class="pre">xdi</span></code> refers to a <code class="docutils literal notranslate"><span class="pre">spec</span></code> so that this exporter only applies to readers which have “xdi” in their <code class="docutils literal notranslate"><span class="pre">spec</span></code> attribute.
The key, <code class="docutils literal notranslate"><span class="pre">application/x-xdi</span></code> is a valid media type. In our case, there is no
registered <a class="reference external" href="https://www.iana.org/assignments/media-types/media-types.xhtml">IANA Media Type</a>
for the format of interest. Therefore, the standard tells us
to invent one of the form <code class="docutils literal notranslate"><span class="pre">application/x-*</span></code>, as in <code class="docutils literal notranslate"><span class="pre">application/x-xdi</span></code>. There
is, of course, some risk of name collisions when we invent names outside of the
official list, so be specific.</p>
<p>The final section</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">file_extensions</span><span class="p">:</span>
  <span class="nt">xdi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/x-xdi</span>
</pre></div>
</div>
<p>enables the usage</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl &#39;http://...?format=xdi&#39;
</pre></div>
</div>
<p>by mapping <code class="docutils literal notranslate"><span class="pre">&quot;xdi&quot;</span></code> to the media type. This is optional. You can provide
no file extensions for a media type. You can also provide <em>multiple</em>
file extensions that map to the same media type. For example, both
<code class="docutils literal notranslate"><span class="pre">tif</span></code> and <code class="docutils literal notranslate"><span class="pre">tiff</span></code> map to <code class="docutils literal notranslate"><span class="pre">image/tiff</span></code>.</p>
<p>The value, <code class="docutils literal notranslate"><span class="pre">tiled.examples.xdi:write_xdi</span></code>, is the module or package that our
exporter is defined in, followed by <code class="docutils literal notranslate"><span class="pre">:</span></code> and then the function name.</p>
<p>The Python file where <code class="docutils literal notranslate"><span class="pre">write_xdi</span></code> is defined by must in an importable location.
During configuration-parsing, Tiled <em>temporarily</em> adds the directory containing
the config file itself to <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>. This means that we can conveniently
drop <code class="docutils literal notranslate"><span class="pre">xdi.py</span></code> next to <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> and know that it will be found.
For long-term deployments it’s better to place exporters in installable Python
packages (i.e. with a proper <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, etc.) but for prototyping and
development this is much more expedient.</p>
<p>Now if we restart the server again with this updated <code class="docutils literal notranslate"><span class="pre">config.yml</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiled</span> <span class="n">serve</span> <span class="n">config</span> <span class="o">--</span><span class="n">public</span> <span class="n">config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>we can request the content as XDI in any of these ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -H &#39;Accept: application/x-xdi&#39; &#39;http://localhost:8000/dataframe/full/example.xdi&#39;
$ curl &#39;http://localhost:8000/dataframe/full/example?format=application/x-xdi&#39;
$ curl &#39;http://localhost:8000/dataframe/full/example?format=xdi&#39;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Serve Trees using Configuration Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="profiles.html" class="btn btn-neutral float-right" title="Use Profiles to streamline Python client setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bluesky Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>