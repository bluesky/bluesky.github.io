

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Custom Export Formats &mdash; tiled 0.1.0b23 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b61ae249"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create and Use API Keys" href="api-keys.html" />
    <link rel="prev" title="Serve Files with Custom Formats" href="read-custom-formats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tiled
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/navigation.html">Navigate with the Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slicing.html">Load Slices of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Deliberate Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/login.html">Log into an Authenticated Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/serving-files.html">Serve a Directory of Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/writing.html">Writing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simple-server.html">Simple Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/plotly-integration.html">Plot Data in Plotly Chart Studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Python Client Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiles.html">Use Profiles to streamline Python client setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-logger.html">Use Performance and Debug Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Run Tiled Server in a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="helm.html">Run Tiled Server from the Helm chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Serve Data using Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-custom-formats.html">Serve Files with Custom Formats</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Add Custom Export Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#text-format-example">Text Format Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#binary-format-example">Binary Format Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-extensions-as-convenience-aliases">File extensions as convenience aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-streaming-export">Advanced: Streaming export</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-examples">Further examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-keys.html">Create and Use API Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-clients.html">Custom Python Client Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Prometheus Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="direct-client.html">Use Tiled in Python without an HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiled-authn-database.html">Set up a database for a scaled authenticated deloyment</a></li>
<li class="toctree-l1"><a class="reference internal" href="register.html">Register Content in Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="retries.html">Control Retries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/standards.html">Standards Used by Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/structures.html">Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/metadata.html">Metadata and â€œSpecsâ€</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/compression.html">Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/specialized-formats.html">Case Study: Reading and Exporting a Specialized Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/caching.html">Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/access-control.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/catalog.html">Catalog Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/lineage.html">How Tiled Fits into the Ecosystem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/service.html">Service-side Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/http-api-overview.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/python-client.html">Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html">Authentication Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/scopes.html">Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/commandline.html">Command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/service-configuration.html">Service Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client-profiles.html">Client Profiles Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/min-versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tiled</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Add Custom Export Formats</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how-to/custom-export-formats.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="add-custom-export-formats">
<span id="custom-export-formats"></span><h1>Add Custom Export Formats<a class="headerlink" href="#add-custom-export-formats" title="Link to this heading">ïƒ</a></h1>
<p>The Tiled server can provide dataâ€”in whole or in partâ€”in a variety of
formats. See <a class="reference internal" href="../tutorials/export.html"><span class="doc">Deliberate Export</span></a> for a list of the formats supported out
of the box for each structure family (<code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;container&quot;</span></code>, â€¦).</p>
<p>This set of formats can easily be extended. A complete working example is
included in the tiled source tree at <code class="docutils literal notranslate"><span class="pre">example_configs/custom_export_formats</span></code>.
We will build it up from scratch.</p>
<p>Weâ€™ll start with a text-based format and then address a binary one.</p>
<section id="text-format-example">
<h2>Text Format Example<a class="headerlink" href="#text-format-example" title="Link to this heading">ïƒ</a></h2>
<p>As our first example, we will invent a variation on CSV (comma-separated variables)
that uses a ğŸ™‚ instead of a comma, as in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1ğŸ™‚2ğŸ™‚3
4ğŸ™‚5ğŸ™‚6
</pre></div>
</div>
<p>We will apply this format to arrays. Tiled expects a function with the interface:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span>
    <span class="n">array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">):</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Here is an implementation that exports an array as smiley-separated variables.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># custom_exporters.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">smiley_separated_variables</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;ğŸ™‚&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<p>In real-world cases, there is often already a library that writes the format
of interest. Then, our goal isnâ€™t to write an exporter from â€œscratchâ€; itâ€™s to
integrate some existing exporter with Tiled. For example, numpy can be made to
write smiley-separated variables. The trick is to make the library write to a
<em>buffer in memory</em> rather than to a file on disk, and then return a string. Most
libraries support the following approach.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">smiley_separated_variables</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="c1"># This StringIO presents a file-like interface that numpy can write to.</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;ğŸ™‚&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</pre></div>
</div>
<p>Either approachâ€”from scracth or using numpyâ€”-will work in our case. Notice
that we also get a dictionary of metadata. Some formats give us nowhere to put
this extra information, and we can just drop it in that case.</p>
<p>To integrate this with Tiled, we invoke it in a configuration file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># config.yml</span>

<span class="c1"># Register a custom format for the &quot;array&quot; structure family.</span>
<span class="nt">media_types</span><span class="p">:</span>
<span class="w">  </span><span class="nt">array</span><span class="p">:</span>
<span class="w">    </span><span class="nt">application/x-smileys</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_exporters:smiley_separated_variables</span>
<span class="c1"># And provide some example data to try it with....</span>
<span class="nt">trees</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">    </span><span class="nt">tree</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiled.examples.generated_minimal:tree</span>
</pre></div>
</div>
<p>The term <code class="docutils literal notranslate"><span class="pre">application/x-smileys</span></code> is a â€œmedia typeâ€, also known as â€œMIME typeâ€.
In our case, there is no registered
<a class="reference external" href="https://www.iana.org/assignments/media-types/media-types.xhtml">IANA Media Type</a>
for our exotic format. Therefore, the standard tells us to invent one of the form
<code class="docutils literal notranslate"><span class="pre">application/x-*</span></code>. There is, of course, some risk of name
collisions when we invent names outside of the official list, so be specific.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">custom_exporters.py</span></code> and <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> placed side by side in some
directory, we can start the server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiled</span> <span class="n">serve</span> <span class="n">config</span> <span class="o">--</span><span class="n">public</span> <span class="n">config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">custom_exporters.py</span></code> is placed in the same directory as <code class="docutils literal notranslate"><span class="pre">config.yml</span></code>,
the Tiled server will be able to find and import the <code class="docutils literal notranslate"><span class="pre">custom_exporters</span></code>
module even if it isnâ€™t installed in the normal Python module search
path or placed in the current working directory.</p>
<p>When it loads the configuration, Tiled temporarily adds the directory containing
<code class="docutils literal notranslate"><span class="pre">config.yml</span></code> to the Python module search path (<code class="docutils literal notranslate"><span class="pre">sys.path</span></code>). This makes it easy
to prototype and integrate custom code. Of course, the configuration can also
load modules that are installed in the normal fashion.</p>
</div>
<p>We can request data as smiley-separated variables from the command line
using <a class="reference external" href="https://httpie.io/">HTTPie</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http :8000/array/full/A?slice=:5,:5 Accept:application/x-smileys
HTTP/1.1 200 OK
content-length: 159
content-type: application/x-smileys; charset=utf-8
date: Wed, 12 Jan 2022 21:38:24 GMT
etag: 8b6ec7a60f30c181762a4c73a6b433b0
server: uvicorn
server-timing: read;dur=3.3, tok;dur=0.1, pack;dur=0.2, app;dur=8.1
set-cookie: tiled_csrf=JDHYkMUIBWECLqIJJvTaEcinv_Vd3kTxS08XCw3N4Yg; HttpOnly; Path=/; SameSite=lax

1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0
1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0
1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0
1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0
1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0ğŸ™‚1.0
</pre></div>
</div>
<p>or using the Tiled Python client.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tiled.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_uri</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/api&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;application/x-smileys&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="binary-format-example">
<h2>Binary Format Example<a class="headerlink" href="#binary-format-example" title="Link to this heading">ïƒ</a></h2>
<p>Letâ€™s add support for JPEG images. Tiled doesnâ€™t build in support for JPEG; for
scientific uses, PNG is better because it is lossless.</p>
<p>Weâ€™ll use the library PIL to write the JPEG data. As with the numpy example
above, we need to intercept its output in a buffer. In this case, it will be a
binary buffer, <code class="docutils literal notranslate"><span class="pre">BytesIO</span></code>, instead of <code class="docutils literal notranslate"><span class="pre">StringIO</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># custom_exporters.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tiled.structures.image_serializer_helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">img_as_ubyte</span>

<span class="k">def</span><span class="w"> </span><span class="nf">to_jpeg</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="c1"># PIL detail: ensure array has compatible data type before handing to PIL.</span>
    <span class="n">prepared_array</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">prepared_array</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jpeg&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">()</span>
</pre></div>
</div>
<p>This covers the basic functionality. See the built-in exporters in
<code class="docutils literal notranslate"><span class="pre">tiled/strucures/array.py</span></code> for details that add polish, like scaling the
imageâ€™s dynamic range and failing gracefully when given arrays that have the
wrong dimensionality to be exported as an image.</p>
<p>Weâ€™ll add it to our configuration.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># config.yml</span>

<span class="nt">media_types</span><span class="p">:</span>
<span class="w">  </span><span class="nt">array</span><span class="p">:</span>
<span class="w">    </span><span class="nt">application/x-smileys</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_exporters:smiley_separated_variables</span>
<span class="w">    </span><span class="nt">image/jpeg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_exporters:to_jpeg</span>
<span class="nt">trees</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">    </span><span class="nt">tree</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiled.examples.generated_minimal:tree</span>
</pre></div>
</div>
<p>Start the server again</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiled</span> <span class="n">serve</span> <span class="n">config</span> <span class="o">--</span><span class="n">public</span> <span class="n">config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>and navigate a web browser to <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/api/v1/array/full/A?format=image/jpeg</span></code>.
Since the example data is just an array of ones, this will appear as a white square image.</p>
</section>
<section id="file-extensions-as-convenience-aliases">
<h2>File extensions as convenience aliases<a class="headerlink" href="#file-extensions-as-convenience-aliases" title="Link to this heading">ïƒ</a></h2>
<p>Now, <code class="docutils literal notranslate"><span class="pre">image/jpeg</span></code> is unwieldy for users unfamiliar with MIME types. Adding</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">file_extensions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">jpg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">image/jpeg</span>
<span class="w">  </span><span class="nt">jpeg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">image/jpeg</span>
</pre></div>
</div>
<p>to the configuration enables</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:8000/api/v1/array/full/A?format=jpeg
http://localhost:8000/api/v1/array/full/A?format=jpg
</pre></div>
</div>
<p>as equivalent to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:8000/api/v1/array/full/A?format=image/jpeg
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The format can also be specified as an
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept">HTTP <code class="docutils literal notranslate"><span class="pre">Accept</span></code> Header</a>.
In that case, it must be given as a MIME type, in accordance with the standard.
The file extension alias is not accepted.</p>
</div>
</section>
<section id="advanced-streaming-export">
<h2>Advanced: Streaming export<a class="headerlink" href="#advanced-streaming-export" title="Link to this heading">ïƒ</a></h2>
<p>HTTP supports chunked responses, where data is streamed incrementally. This
is a good fit for streaming-oriented formats such as newline-delimited JSON.</p>
<p>To create a chunked exporter, implement your exporter as a Python generator
that yields bytes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="k">for</span> <span class="o">...</span> <span class="ow">in</span> <span class="o">...</span><span class="p">:</span>
        <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;...&quot;</span>
</pre></div>
</div>
</section>
<section id="further-examples">
<h2>Further examples<a class="headerlink" href="#further-examples" title="Link to this heading">ïƒ</a></h2>
<p>At the bottom of each of the modules in <code class="docutils literal notranslate"><span class="pre">tiled/structures</span></code>, you will
find the code for the built-in exporters (a.k.a â€œserializersâ€).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="read-custom-formats.html" class="btn btn-neutral float-left" title="Serve Files with Custom Formats" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api-keys.html" class="btn btn-neutral float-right" title="Create and Use API Keys" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bluesky Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>