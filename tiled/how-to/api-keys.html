<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create and Use API Keys &mdash; tiled 0.1.0a108 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=886a9b45"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Custom Python Client Objects" href="custom-clients.html" />
    <link rel="prev" title="Add Custom Export Formats" href="custom-export-formats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tiled
          </a>
              <div class="version">
                0.1.0a108
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/navigation.html">Navigate with the Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/slicing.html">Load Slices of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Deliberate Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/login.html">Log into an Authenticated Tiled Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/serving-files.html">Serve a Directory of Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/writing.html">Writing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/plotly-integration.html">Plot Data in Plotly Chart Studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="profiles.html">Use Profiles to streamline Python client setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-logger.html">Use Performance and Debug Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Run Tiled Server in a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Serve Data using Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-custom-formats.html">Serve Files with Custom Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-export-formats.html">Add Custom Export Formats</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Create and Use API Keys</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-use-api-keys">Why use API keys?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-api-key">Create an API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-the-api-key-in-python">Use the API Key in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-the-api-key-in-other-web-clients">Use the API Key in other web clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manage-api-keys">Manage API Keys</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom-clients.html">Custom Python Client Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Prometheus Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="direct-client.html">Use Tiled in Python without an HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="tune-caches.html">Tune Caches to Balance Speed and Memory Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiled-authn-database.html">Set up a database for a scaled authenticated deloyment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/standards.html">Standards Used by Tiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/structures.html">Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/metadata.html">Metadata and “Specs”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/compression.html">Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/specialized-formats.html">Case Study: Reading and Exporting a Specialized Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/caching.html">Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/access-control.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/lineage.html">How Tiled Fits into the Ecosystem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/service.html">Service-side Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/http-api-overview.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/python-client.html">Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authentication.html">Authentication Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/scopes.html">Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/commandline.html">Command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/service-configuration.html">Service Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/client-profiles.html">Client Profiles Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/min-versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tiled</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Create and Use API Keys</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how-to/api-keys.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="create-and-use-api-keys">
<h1>Create and Use API Keys<a class="headerlink" href="#create-and-use-api-keys" title="Permalink to this heading">¶</a></h1>
<p>This guide applies to <strong>multi-user</strong> Tiled deployments, i.e. deployments configured
with an authentication provider.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Single-user</strong> deployments run with a single API key. By default, it is
randomly generated and printed to the console at server startup, like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tiled serve pyobject tiled.examples.generated:tree
Generating large example data...
Done generating example data.

    Use the following URL to connect to Tiled:

    &quot;http://127.0.0.1:8000?api_key=8df0146c93e9add287d0e7f84a165ba4bd3517bbb3c7c6b4d963c3e1549d0311&quot;
</pre></div>
</div>
<p>This guide does not apply to single-user deployments like this.</p>
</div>
<section id="why-use-api-keys">
<h2>Why use API keys?<a class="headerlink" href="#why-use-api-keys" title="Permalink to this heading">¶</a></h2>
<p>Users can log in to Tiled with a simple username/password or through
a third party like ORICD or Google, as demonstrated in the tutorial
<a class="reference internal" href="../tutorials/login.html"><span class="doc">Log into an Authenticated Tiled Server</span></a>. For interactive workflows in Python, this the most
convenient way to authenticate.</p>
<p>But in other situations, it can more convenient to generate and use an API key.
An API key uses a comparatively simpler interaction, without an interactive
prompt or the need to periodically “refresh” a session to keep it active. This
is useful when:</p>
<ul class="simple">
<li><p>The code using tiled is running in an unsupervised, automated fashion
or scaled across many workers, such as in an HPC job, where is it not
possible to provide credentials interactively.</p></li>
<li><p>You are connecting from a generic web client like a web browser or <code class="docutils literal notranslate"><span class="pre">curl</span></code>,
which has no built-in integration with Tiled or with OpenAPI+OAuth2.</p></li>
</ul>
</section>
<section id="create-an-api-key">
<h2>Create an API Key<a class="headerlink" href="#create-an-api-key" title="Permalink to this heading">¶</a></h2>
<p>To follow along, you may start a Tiled server with a simple authentication provider,
as shown. Alternatively, you may use an existing authenticated Tiled server, such as
<code class="docutils literal notranslate"><span class="pre">https://tiled-demo.blueskyproject.io</span></code>; if you do, replace <code class="docutils literal notranslate"><span class="pre">http://localhost:8000</span></code>
in the example below with that address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># You can find example_configs/ in the root of the tiled source code repository.</span>
<span class="n">ALICE_PASSWORD</span><span class="o">=</span><span class="n">secret1</span> <span class="n">tiled</span> <span class="n">serve</span> <span class="n">config</span> <span class="n">example_configs</span><span class="o">/</span><span class="n">toy_authentication</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>Using the Tiled commandline interface, log in as <code class="docutils literal notranslate"><span class="pre">alice</span></code> using the password <code class="docutils literal notranslate"><span class="pre">secret1</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled profile create http://localhost:8000
$ tiled login
Username: alice
Password:
</pre></div>
</div>
<p>Create a new API key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key create
48e8f8598940fa0f3e80b406def606e17e815a2c76fe21350a99d6d9935371d11533b318
</pre></div>
</div>
<p>This text is the API key. <strong>It should be handled as a secret.</strong></p>
</section>
<section id="use-the-api-key-in-python">
<h2>Use the API Key in Python<a class="headerlink" href="#use-the-api-key-in-python" title="Permalink to this heading">¶</a></h2>
<p>We can use it in the Python client:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tiled.client</span> <span class="kn">import</span> <span class="n">from_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">API_KEY</span> <span class="o">=</span> <span class="s2">&quot;YOUR_KEY_HERE&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">API_KEY</span><span class="p">)</span>
</pre></div>
</div>
<p>API keys should never be placed directly in scripts or notebooks.
Instead, set the environment variable <code class="docutils literal notranslate"><span class="pre">TILED_API_KEY</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">TILED_API_KEY</span><span class="o">=</span><span class="n">YOUR_KEY_HERE</span>
</pre></div>
</div>
<p>and then start Python (or IPython, or Jupyter, or…). The Python client will
use that, unless it is explicitly passed different credentials.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tiled.client</span> <span class="kn">import</span> <span class="n">from_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>  <span class="c1"># uses TILED_API_KEY, if set</span>
</pre></div>
</div>
</section>
<section id="use-the-api-key-in-other-web-clients">
<h2>Use the API Key in other web clients<a class="headerlink" href="#use-the-api-key-in-other-web-clients" title="Permalink to this heading">¶</a></h2>
<p>We can use in other web clients as well. For example, using <a class="reference external" href="https://httpie.io/">HTTPie</a>
we can see that unauthenticated requests are refused</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http http://localhost:8000/api/v1/metadata/
HTTP/1.1 401 Unauthorized
content-length: 30
content-type: application/json
date: Mon, 31 Jan 2022 17:30:06 GMT
server: uvicorn
server-timing: app;dur=2.6
set-cookie: tiled_csrf=bZLhKsXVE2VirgXQncHsHn4Y0Wwwr66U0T0hqarJyfw; HttpOnly; Path=/; SameSite=lax
x-tiled-root: http://localhost:8000/api/v1

{
    &quot;detail&quot;: &quot;Not authenticated&quot;
}
</pre></div>
</div>
<p>but passing the API key in the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header as <code class="docutils literal notranslate"><span class="pre">Apikey</span> <span class="pre">YOUR_KEY_HERE</span></code> is accepted.
(Note the use of <code class="docutils literal notranslate"><span class="pre">'</span></code> quotes.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http http://localhost:8000/api/v1/metadata/ &#39;Authorization:Apikey 48e8f8598940fa0f3e80b406def606e17e815a2c76fe21350a99d6d9935371d11533b318&#39;
HTTP/1.1 200 OK
content-length: 320
content-type: application/json
date: Mon, 31 Jan 2022 17:34:48 GMT
etag: c7d94c99b0a3cd6e102a78520db84bef
server: uvicorn
server-timing: tok;dur=0.0, pack;dur=0.0, app;dur=15.2
set-cookie: tiled_csrf=InE4mplUO0goPxf4V07tVuLSLUvDqhgtALTHYoC3T3s; HttpOnly; Path=/; SameSite=lax
&lt;etc.&gt;
</pre></div>
</div>
<p>The API key can also be passed in the URL like
<code class="docutils literal notranslate"><span class="pre">http://localhost:8000/api/v1/metadata/?api_key=YOUR_KEY_HERE</span></code>. Using the
<code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header is preferred (more secure) but in some situations, as in
pasting a link into a web browser, the URL is the only option.</p>
</section>
<section id="manage-api-keys">
<h2>Manage API Keys<a class="headerlink" href="#manage-api-keys" title="Permalink to this heading">¶</a></h2>
<p>We can use the tiled commandline interface to examine and revoke API keys as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key
Usage: tiled api_key [OPTIONS] COMMAND [ARGS]...

  Create, list, and revoke API keys.

Options:
  --help  Show this message and exit.

Commands:
  create
  list
  revoke
</pre></div>
</div>
<p>We can see the key that we made above in the list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key list
First 8   Expires at (UTC)     Latest activity      Note                Scopes
48e8f859  -                    2022-01-31T18:32:33                      inherit

</pre></div>
</div>
<p>By default, an API key inherits all the same access
as the user who is for. If an API key will be used for a specific task, it is
good security hygiene to give it only the privileges it needs for that task.  It
is also recommended to set a limited lifetimes so that if the key is
unknowingly leaked it will not continue to work forever. For example, this
command creates an API key that will expire in 10 minutes (600 seconds) and can
search/list metadata but cannot download array data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key create --expires-in 600 --scopes read:metadata
ba9af604023a829ab22edb786168d6e1b97cef68c54c6d95d7fad5e3e6347fa131263581
</pre></div>
</div>
<p>See <a class="reference internal" href="../reference/scopes.html"><span class="doc">Scopes</span></a> for the full list of scopes and their capabilities.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key list
First 8   Expires at (UTC)     Latest activity      Note                Scopes
48e8f859  -                    2022-01-31T18:32:33                      inherit
ba9af604  2022-01-31T23:03:57  -                                        read:metadata
</pre></div>
</div>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">--note</span></code> option can be used to label an API key as a reminder of
where or how it is being used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key create --note=&quot;Data validation pipeline&quot; --scopes read:metadata read:data
573928c62e53096321fb874847bcc6a90ea636eebd8acbd7c5e9d18d2859847b3bfb4f19
$ tiled api_key list
First 8   Expires at (UTC)     Latest activity      Note                      Scopes
48e8f859  -                    2022-01-31T18:32:33                            inherit
ba9af604  2022-01-31T23:03:57  -                                              read:metadata
573928c6  -                    -                    Data validation pipeline  read:metadata read:data
</pre></div>
</div>
<p>If an API key is no longer need or accidentally leaked, it should be revoked. It
can be identified by its first eight characters, as shown in the the output of
<code class="docutils literal notranslate"><span class="pre">tiled</span> <span class="pre">api_key</span> <span class="pre">list</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tiled api_key revoke 573928c6
$ tiled api_key list
First 8   Expires at (UTC)     Latest activity      Note                      Scopes
48e8f859  -                    2022-01-31T18:32:33                            inherit
ba9af604  2022-01-31T23:03:57  -                                              read:metadata
</pre></div>
</div>
<p>Passing the full key also works, if you have it handy. There is no need to trim
just the first eight.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="custom-export-formats.html" class="btn btn-neutral float-left" title="Add Custom Export Formats" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="custom-clients.html" class="btn btn-neutral float-right" title="Custom Python Client Objects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bluesky Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>